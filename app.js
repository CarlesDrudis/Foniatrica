!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Pinia"),require("Vue"),require("VueRouter"),require("furaVue"),require("jspdf"),require("llescaVue"),require("pdfFonts"),require("pdfMake")):"function"==typeof define&&define.amd?define(["Pinia","Vue","VueRouter","furaVue","jspdf","llescaVue","pdfFonts","pdfMake"],t):"object"==typeof exports?exports.app=t(require("Pinia"),require("Vue"),require("VueRouter"),require("furaVue"),require("jspdf"),require("llescaVue"),require("pdfFonts"),require("pdfMake")):e.app=t(e.Pinia,e.Vue,e.VueRouter,e.furaVue,e.jspdf,e.llescaVue,e.pdfFonts,e.pdfMake)}(self,((e,t,a,n,l,i,o,r)=>(()=>{"use strict";var d={744:(e,t)=>{t.Z=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a}},713:t=>{t.exports=e},740:e=>{e.exports=t},88:e=>{e.exports=a},283:e=>{e.exports=n},676:e=>{e.exports=l},111:e=>{e.exports=i},732:e=>{e.exports=o},525:e=>{e.exports=r}},u={};function s(e){var t=u[e];if(void 0!==t)return t.exports;var a=u[e]={exports:{}};return d[e](a,a.exports,s),a.exports}s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};return(()=>{s.d(c,{default:()=>Ki});var e={};s.r(e),s.d(e,{getRoutes:()=>yn});var t={};s.r(t),s.d(t,{getRoutes:()=>Nl});var a={};s.r(a),s.d(a,{getRoutes:()=>El});var n=s(740),l=s(713),i=s(283),o=s(111),r=s(88);const d="foniatrica",u="Clínica Foniátrica",m="https://carlesdrudis-001-site1.jtempurl.com/",p="LLESCA_VIEW",f="ID",y="ENTITY",v="VIEWNAME",A="DEF_VIEW",I="DEFAULT_VIEW",g="/home";function T(e){const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(a)}function b(e){if("string"==typeof e&&e){const t=T(e),a=1e3*t.exp,n=1e3*t.iat,l=Date.now();return n<l&&l<a}return!1}const O=(0,l.defineStore)({id:"session",state(){const e=localStorage.getItem(`jwt/${d}`);return{jwt:b(e)?e:null}},getters:{data:e=>function(e){if("string"==typeof e&&e){const t=T(e);return{name:t.unique_name,role:t.role}}return{name:null,role:null}}(e.jwt)},actions:{setJwt(e){"string"==typeof e&&e&&b(e)?(localStorage.setItem(`jwt/${d}`,e),this.jwt=e):(localStorage.removeItem(`jwt/${d}`),this.jwt=null)}}}),C=(0,l.defineStore)({id:"config",state:()=>({NOM_CONSULTA:"Clínica Foniátrica",ADRECA:"",POBLACIO:"Barcelona",NIF:"",COLLEGIAT:"",TIPUSIRPF:15,ID_HORA_INICIO:1,ID_HORA_FINAL:10,ID_PLANTILLA:1,ID_FORMAPAGAMENT:1,MARGE_TOP:0,MARGE_LEFT:0,SOBRE_TOP:0,SOBRE_LEFT:0,FUNDA_TOP:0,FUNDA_LEFT:0,ENBLANC_TOP:0,ENBLANCO_LEFT:0,ADULT_TOP:0,ADULT_LEFT:0,INFANTIL_TOP:0,INFANTIL_LEFT:0,CONTINUACIO_TOP:0,CONTINUACIO_LEFT:0,LOGO:""}),actions:{saveConfig(e){this.NOM_CONSULTA=e.NOM_CONSULTA,this.ADRECA=e.ADRECA,this.POBLACIO=e.POBLACIO,this.NIF=e.NIF,this.COLLEGIAT=e.COLLEGIAT,this.EMAIL=e.EMAIL,this.WEB=e.WEB,this.TELEFON=e.TELEFON,this.TIPUSIRPF=e.TIPUSIRPF,this.ID_HORA_INICIO=e.ID_HORA_INICIO,this.ID_HORA_FINAL=e.ID_HORA_FINAL,this.ID_PLANTILLA=e.ID_PLANTILLA,this.ID_FORMAPAGAMENT=e.ID_FORMAPAGAMENT,this.MARGE_TOP=e.MARGE_TOP,this.MARGE_LEFT=e.MARGE_LEFT,this.SOBRE_TOP=e.SOBRE_TOP,this.SOBRE_LEFT=e.SOBRE_LEFT,this.FUNDA_TOP=e.FUNDA_TOP,this.FUNDA_LEFT=e.FUNDA_LEFT,this.FUNDA_HISTORIA=e.FUNDA_HISTORIA,this.FUNDA_INFERIOR=e.FUNDA_INFERIOR,this.ENBLANC_TOP=e.ENBLANC_TOP,this.ENBLANCO_LEFT=e.ENBLANCO_LEFT,this.ADULT_TOP=e.ADULT_TOP,this.ADULT_LEFT=e.ADULT_LEFT,this.INFANTIL_TOP=e.INFANTIL_TOP,this.INFANTIL_LEFT=e.INFANTIL_LEFT,this.CONTINUACIO_TOP=e.CONTINUACIO_TOP,this.CONTINUACIO_LEFT=e.CONTINUACIO_LEFT,this.COMPROVANT_TOP=e.COMPROVANT_TOP,this.COMPROVANT_LEFT=e.COMPROVANT_LEFT,this.LOGO=e.LOGO_300X125,this.COMPROVANT=e.COMPROVANT_300X80,this.LOGO_ADRECA=e.ADRECA_300X200}}}),N={class:"layoutBase-grid"},h={class:"layoutBase-logo"},_=["src"],E={class:"layoutBase-title"},P={class:"layoutBase-menu"},S={class:"layoutBase-content"},D={__name:"layout-base",props:{subtitle:{type:String,required:!0},hideMenu:{type:Boolean,default:!1}},setup(e){const t=O(),a=t.data.role,l=(0,r.useRouter)(),i=(0,r.useRoute)();function o(e,t){const a=Ba(t);if("list"===e)return{text:a.label,action:()=>l.push(`/${t}`)};if("dictionary"===e){const e=a.fields.find((e=>e.defaultField));return{text:a.label,action:()=>l.push({path:`/${t}`,query:{orderby:`${e.name} asc`}})}}}const s=[{text:"Inici",action:()=>l.push("/")},o("list","VISITA"),o("list","PACIENT"),o("list","MUTUA"),o("list","ESPECIALISTA"),{text:"Administració",disabled:"Administrador"!==a,children:[o("dictionary","ESPECIALITAT"),o("dictionary","PATOLOGIA"),{type:"divider"},o("dictionary","HORARI"),o("dictionary","FORMAPAGAMENT"),o("dictionary","TRACTAMENT"),o("dictionary","DOCTOR"),o("dictionary","TAG"),{type:"divider"},o("dictionary","PLANTILLA"),{type:"divider"},o("list","USUARI"),{text:"Paràmetres aplicació",icon:"Permissions",action:()=>l.push({path:"/configuracion",query:{return:i.fullPath}})}]},{text:t.data.name,icon:"SwitchUser",children:[{text:"Canviar la paraula clau",action:()=>l.push("/password-change")},{text:"Tancar sessió",action:()=>{t.setJwt(),l.push("/")}}]}];return(t,a)=>{const l=(0,n.resolveComponent)("fura-label"),i=(0,n.resolveComponent)("fura-command-bar");return(0,n.openBlock)(),(0,n.createElementBlock)("div",N,[(0,n.createElementVNode)("div",h,[(0,n.createElementVNode)("img",{src:`/${(0,n.unref)(d)}/images/logo.png`,width:"148"},null,8,_)]),(0,n.createElementVNode)("div",E,[(0,n.createVNode)(l,{class:"layoutBase-appTitle"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(u)),1)])),_:1}),(0,n.createVNode)(l,{class:"layoutBase-subtitle"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.subtitle),1)])),_:1})]),(0,n.createElementVNode)("div",P,[e.hideMenu?(0,n.createCommentVNode)("v-if",!0):((0,n.openBlock)(),(0,n.createBlock)(i,{key:0,"far-items":s}))]),(0,n.createElementVNode)("div",S,[(0,n.renderSlot)(t.$slots,"default")])])}}};var F=s(744);const V=(0,F.Z)(D,[["__scopeId","data-v-37fdbc8c"]]),M={key:0},x={class:"layoutListItem-actions"},R={__name:"layout-list-item",props:{tabs:{type:Array,default:void 0},currentTab:{type:String,default:void 0},hasSave:{type:Boolean,default:!1},hasSaveAndNew:{type:Boolean,default:!1},hasSaveAndEdit:{type:Boolean,default:!1},hasSaveAndClose:{type:Boolean,default:!1},hasGoBack:{type:Boolean,default:!1},hasClose:{type:Boolean,default:!1},hasReset:{type:Boolean,default:!1},hasRemove:{type:Boolean,default:!1},maxWidth:{type:String,default:null},selfAling:{type:String,default:"center",validator:e=>!e||["left","center","right"].includes(e)}},emits:["update:currentTab","save","saveAndNew","saveAndEdit","saveAndClose","goBack","close","reset","remove"],setup(e){const t=e;return(a,l)=>{const i=(0,n.resolveComponent)("fura-pivot"),o=(0,n.resolveComponent)("fura-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(`layoutListItem-container layoutListItem-${t.selfAling}`),style:(0,n.normalizeStyle)({maxWidth:e.maxWidth})},[(0,n.createElementVNode)("div",null,[(0,n.renderSlot)(a.$slots,"default")]),e.tabs?.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",M,[(0,n.createVNode)(i,{tabs:e.tabs,"model-value":e.currentTab,"onUpdate:modelValue":l[0]||(l[0]=e=>a.$emit("update:currentTab",e))},null,8,["tabs","model-value"]),(0,n.renderSlot)(a.$slots,"child")])):(0,n.createCommentVNode)("v-if",!0),(0,n.createElementVNode)("div",x,[e.hasSave?((0,n.openBlock)(),(0,n.createBlock)(o,{key:0,class:"layoutListItem-button",primary:"",text:"Guardar",icon:"Save",onClick:l[1]||(l[1]=e=>a.$emit("save"))})):(0,n.createCommentVNode)("v-if",!0),e.hasSaveAndNew?((0,n.openBlock)(),(0,n.createBlock)(o,{key:1,class:"layoutListItem-button",primary:"",text:"Guardar i nou",icon:"SaveAs",onClick:l[2]||(l[2]=e=>a.$emit("saveAndNew"))})):(0,n.createCommentVNode)("v-if",!0),e.hasSaveAndEdit?((0,n.openBlock)(),(0,n.createBlock)(o,{key:2,class:"layoutListItem-button",primary:"",text:"Guardar i continuar editant",icon:"SaveAs",onClick:l[3]||(l[3]=e=>a.$emit("saveAndEdit"))})):(0,n.createCommentVNode)("v-if",!0),e.hasSaveAndClose?((0,n.openBlock)(),(0,n.createBlock)(o,{key:3,class:"layoutListItem-button",primary:"",text:"Guardar i tancar",icon:"SaveAndClose",onClick:l[4]||(l[4]=e=>a.$emit("saveAndClose"))})):(0,n.createCommentVNode)("v-if",!0),e.hasGoBack?((0,n.openBlock)(),(0,n.createBlock)(o,{key:4,class:"layoutListItem-button",text:"Tornar",icon:"Back",onClick:l[5]||(l[5]=e=>a.$emit("goBack"))})):(0,n.createCommentVNode)("v-if",!0),e.hasClose?((0,n.openBlock)(),(0,n.createBlock)(o,{key:5,class:"layoutListItem-button",text:"Tancar",icon:"ChromeClose",onClick:l[6]||(l[6]=e=>a.$emit("close"))})):(0,n.createCommentVNode)("v-if",!0),e.hasReset?((0,n.openBlock)(),(0,n.createBlock)(o,{key:6,class:"layoutListItem-button",text:"Reiniciar",icon:"Refresh",onClick:l[7]||(l[7]=e=>a.$emit("reset"))})):(0,n.createCommentVNode)("v-if",!0),e.hasRemove?((0,n.openBlock)(),(0,n.createBlock)(o,{key:7,primary:"",class:"layoutListItem-button layoutListItem-alertButton",text:"Eliminar",icon:"Delete",onClick:l[8]||(l[8]=e=>a.$emit("remove"))})):(0,n.createCommentVNode)("v-if",!0)])],6)}}},w=(0,F.Z)(R,[["__scopeId","data-v-f73b1a8e"]]),B={__name:"details-cell-boolean",props:{field:{type:Object,default:void 0},row:{type:Object,default:void 0}},setup(e){const t=e,a=(0,n.computed)((()=>t.row[t.field.name]));return(e,t)=>{const l=(0,n.resolveComponent)("fura-icon");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[!0===a.value||1===a.value?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,class:"detailsCellBoolean-true",name:"CheckMark"})):((0,n.openBlock)(),(0,n.createBlock)(l,{key:1,class:"detailsCellBoolean-false",name:"Cancel"}))])}}},L=(0,F.Z)(B,[["__scopeId","data-v-3f173500"]]),k={__name:"form-field-boolean",props:{label:{type:String,default:void 0},boxSide:{type:String,default:void 0},disabled:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},nullable:{type:Boolean,default:void 0},align:{type:String,default:void 0,validator:e=>!e||["left","center","right"].includes(e)}},emits:["change"],setup(e,{emit:t}){const a=e,l=t;a.validations?.createField(a.name??a.field.name,(0,n.computed)((()=>a.entity[a.name??a.field.name])));const i=(0,n.computed)((()=>(a.nullable??a.field.nullable)&&null===a.entity[a.name??a.field.name])),o=(0,n.computed)((()=>{const e=a.align??a.field.align;return["left","center","right"].includes(e)?`formFieldBoolean-${e}`:null}));function r(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(0,n.watch)([()=>a.disabled,()=>a.field?.disabled],(([e,t])=>{if(null!=(e??t)&&(a.clearValueOnDisabled??a.field.clearValueOnDisabled)){const e=a.name??a.field.name;a.nullable??a.field.nullable?l("change",(t=>{t[e]=null})):l("change",(t=>{t[e]=!1}))}})),(t,a)=>{const l=(0,n.resolveComponent)("fura-checkbox");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(o.value)},[(0,n.createVNode)(l,{label:e.label??e.field.label,"box-side":e.boxSide??e.field.boxSide,disabled:e.disabled??e.field.disabled,readonly:e.readonly??e.field.readonly,indeterminate:i.value,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":r},null,8,["label","box-side","disabled","readonly","indeterminate","model-value"])],2)}}},$=(0,F.Z)(k,[["__scopeId","data-v-8d28af88"]]),U={__name:"grid-field-boolean",props:{boxSide:{type:String,default:void 0},disabled:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},nullable:{type:Boolean,default:void 0},alignGrid:{type:String,default:"center"}},emits:["change"],setup(e,{emit:t}){const a=e,l=t;return(t,i)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)($),(0,n.mergeProps)({...a,label:""},{align:e.alignGrid??e.field.alignGrid,class:"field",onChange:i[0]||(i[0]=e=>l("change",e))}),null,16,["align"]))}};function q(e,t){return t[e.name]?"Sí":!1===t[e.name]?"No":""}const G={detailsCell:L,formField:$,gridField:(0,F.Z)(U,[["__scopeId","data-v-1198e7f8"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition(e){if("eq"===e.operation)return`${e.name} eq @${e.name}`},getFilterInterface(e){if("eq"===e.operation)return{type:"checkbox",name:e.name,label:e.label}},getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):"boolean"==typeof e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:q,getCsvValueFromEntity:q},K={eq:40,ne:30,gt:70,ge:50,lt:80,le:60,and:20,or:10,add:100,sub:90,mul:130,div:120,mod:110,has:150,in:140},j=Object.keys(K),z=["cast","ceiling","concat","contains","date","day","endswith","fractionalseconds","floor","hassubsequence","hassubset","hour","indexof","isof","length","matchesPattern","maxdatetime","mindatetime","minute","month","now","replace","round","second","startswith","substring","substringof","time","tolower","totaloffsetminutes","totalseconds","toupper","trim","year"],H=["all","any"];class W extends Error{constructor(e,t,a){super(`${e}. Starting at position ${t} and ending at ${a}.`),this.displayMessage=e,this.indexStart=t,this.indexEnd=a}}const Y=new RegExp(`^(${j.join("|")})\\b`,"i"),Z=new RegExp(`^(${z.join("|")})\\b`,"i"),X=new RegExp(`^(${["not","true","false","null","NaN","INF"].join("|")})\\b`);function J(e){return function(t,a){const n=t.substring(a),[l]=n.match(e);return{value:l,newIndex:a+l.length}}}const Q=[{name:"EOS",test:(e,t)=>t>=e.length,reader:(e,t)=>({value:null,newIndex:e.length})},{name:"WHITESPACE",test:(e,t)=>/\s/.test(e[t]??""),reader:J(/^(\s+)/)},{name:"LITERAL",test:(e,t)=>"$"===e[t],reader:J(/^(\$[a-zA-Z]\w+)/)},{name:"ALIAS",test:(e,t)=>"@"===e[t],reader:J(/^(@[a-zA-Z]\w+)/)},{name:"GUID",test:(e,t)=>/^\d{8}-\d{4}-\d{4}-\d{4}-\d{12}/.test(e.substring(t)),reader:J(/^(\d{8}-\d{4}-\d{4}-\d{4}-\d{12})/)},{name:"DATE",test:(e,t)=>/^\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)/.test(e.substring(t)),reader:function(e,t){const a=J(/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z))/)(e,t);return a.value=new Date(a.value),a}},{name:"NUMBER",test:(e,t)=>/^-?\d/.test(e.substring(t)),reader:function(e,t){const a=J(/^(-?\d+(?:\.\d+)?(?:e-?\d+)?)/)(e,t);return a.value=Number(a.value),a}},{name:"PUNCTUATION",test:(e,t)=>["/","(",")","[","]",",",".",":","-"].includes(e[t]),reader:(e,t)=>({value:e[t],newIndex:t+1})},{name:"STRING",test:(e,t)=>"'"===e[t],reader:function(e,t){let a="",n=t+1,l=!0;for(;l;){if(n>=e.length)throw new W("Unclosed string",t,n);const i=e[n];n+=1,"'"===i?"'"===e[n]?(a+="'",n+=1):l=!1:a+=i}return{value:a,newIndex:n}}},{name:"OPERATOR",test:(e,t)=>Y.test(e.substring(t)),reader:J(Y)},{name:"FUNCTION",test:(e,t)=>Z.test(e.substring(t)),reader:J(Z)},{name:"KEYWORD",test:(e,t)=>X.test(e.substring(t)),reader:J(X)},{name:"NAME",test:(e,t)=>/[a-zA-Z]/.test(e[t]??""),reader:J(/^\w*/)}];function ee(e,t){for(const a of Q)if(a.test(e,t)){const{value:n,newIndex:l}=a.reader(e,t);return{type:a.name,value:n,indexStart:Math.min(t,e.length),indexEnd:l}}throw new W(`Unexpected character '${e[t]}'`,t,t+1)}function te(e,t){let a=ee(e,t);for(;"WHITESPACE"===a.type;)a=ee(e,a.indexEnd);return a}function ae(e){return ne(e)}function ne(e){if(e.check("PUNCTUATION","(")){e.advance("PUNCTUATION","(");const t=le(e);return e.advance("PUNCTUATION",")"),t}if(e.check("PUNCTUATION","[")){e.advance("PUNCTUATION","[");const t=le(e);return e.advance("PUNCTUATION","]"),t}if(e.check("KEYWORD",["true","false"]))return function(e){return{type:"boolean",value:e.advance("KEYWORD",["true","false"]).value}}(e);if(e.check("KEYWORD",["null","NaN","INF"]))return function(e){return{type:"constant",value:e.advance("KEYWORD",["null","NaN","INF"]).value}}(e);if(e.check("DATE"))return function(e){return{type:"date",value:e.advance("DATE").value}}(e);if(e.check("NUMBER"))return function(e){return{type:"number",value:e.advance("NUMBER").value}}(e);if(e.check("GUID"))return function(e){return{type:"guid",value:e.advance("GUID").value}}(e);if(e.check("STRING"))return function(e){return{type:"string",value:e.advance("STRING").value}}(e);if(e.check("ALIAS"))return function(e){return{type:"alias",value:e.advance("ALIAS").value}}(e);if(e.check("PUNCTUATION","-")||e.check("KEYWORD","not"))return function(e){return e.check("PUNCTUATION","-")?e.advance("PUNCTUATION","-"):e.check("KEYWORD","not")&&e.advance("KEYWORD","not"),{type:"negative",value:ne(e)}}(e);if(e.check("FUNCTION"))return function(e){const t=e.advance("FUNCTION"),a=function(e){const t=[];let a=!0;for(e.advance("PUNCTUATION","(");!e.check("EOS")&&!e.check("PUNCTUATION",")");)a?a=!1:e.advance("PUNCTUATION",","),t.push(ae(e));return e.advance("PUNCTUATION",")"),t}(e);return{type:"functionCall",name:t.value,parameters:a}}(e);if(e.check("NAME")||e.check("LITERAL"))return function(e){const t=[];for(;e.check(["NAME","LITERAL"])&&e.checkNext("PUNCTUATION","/");)t.push(e.advance(["NAME","LITERAL"]).value),e.advance("PUNCTUATION","/");if(H.some((t=>e.check("NAME",t)))&&e.checkNext("PUNCTUATION","(")){const a=e.advance("NAME").value;e.advance("PUNCTUATION","(");const n=e.advance("NAME").value;e.advance("PUNCTUATION",":");const l=oe(e);return e.advance("PUNCTUATION",")"),{type:"lambda",navigation:t.length>0?t:null,operation:a,name:n,expression:l}}if(e.check("NAME"))return{type:"property",navigation:t.length>0?t:null,value:e.advance("NAME").value};if(e.check("LITERAL"))return{type:"literal",navigation:t.length>0?t:null,value:e.advance("LITERAL").value};throw new W(`Unexpected token ${e.current.type}.`,e.current.indexStart,e.current.indexEnd)}(e);throw new W(`Unexpected token ${e.current.type}.`,e.current.indexStart,e.current.indexEnd)}function le(e){const t=[oe(e)];for(;e.check("PUNCTUATION",",");)e.advance("PUNCTUATION",","),t.push(oe(e));return{type:"collection",value:t}}function ie(e,t,a=0){if(e.check("OPERATOR")){const n=K[e.current.value];if(n>a){const l=e.advance("OPERATOR").value,i=ie(e,ne(e),n);return ie(e,{type:"binaryOp",operator:l,left:t,right:i},a)}}return t}function oe(e){if(e.check("PUNCTUATION","(")){e.advance("PUNCTUATION","(");const t=le(e);return e.advance("PUNCTUATION",")"),ie(e,t)}if(e.check("PUNCTUATION","[")){e.advance("PUNCTUATION","[");const t=le(e);return e.advance("PUNCTUATION","]"),ie(e,t)}return ie(e,ne(e))}const re={collection:e=>1===e.value.length?se(e.value[0]):e.value.map(se),boolean(e){if("true"===e.value)return!0;if("false"===e.value)return!1;throw new Error},constant(e){if("null"===e.value)return null;if("NaN"===e.value)return NaN;if("INF"===e.value)return Number.POSITIVE_INFINITY;throw new Error},date:e=>e.value,number:e=>e.value,string:e=>e.value,guid:e=>({guid:e.value}),alias:e=>({alias:e.value}),negative:e=>({not:de(e.value)}),functionCall:e=>({[e.name]:e.parameters.map(de)}),lambda:e=>({lambda:e.operation,path:e.navigation?.join("/"),name:e.name,expression:se(e.expression)}),property:e=>({property:Array.isArray(e.navigation)?[...e.navigation,e.value].join("/"):e.value}),literal:e=>({literal:Array.isArray(e.navigation)?[...e.navigation,e.value].join("/"):e.value})};function de(e){return Array.isArray(e)?e.map((e=>se(e))):e.type in re?re[e.type](e):void 0}function ue(e){if(["and","or","add","sub","mul","div"].includes(e.operator)){const t=[],a=a=>"binaryOp"===a.type&&a.operator===e.operator?t.push(...ue(a)[e.operator]):t.push(se(a));return a(e.left),a(e.right),{[e.operator]:t}}return{[e.operator]:[se(e.left),se(e.right)]}}function se(e){return"collection"===e.type?1===e.value.length&&["binaryOp","collection","lambda","functionCall"].includes(e.value[0].type)?se(e.value[0]):e.value.map(se):"binaryOp"===e.type?ue(e):de(e)}function ce(e){const t=function(e){let t=0,a=te(e,t),n=te(e,a.indexEnd);return t=n.indexEnd,{get current(){return a},get next(){return n},check(e,t){if(null!=e){if(Array.isArray(e))return e.includes(a.type);if(e!==a.type)return!1}if(null!=t){if(Array.isArray(t))return t.includes(a.value);if(t!==a.value)return!1}return!0},checkNext(e,t){if(null!=e){if(Array.isArray(e))return e.includes(n.type);if(e!==n.type)return!1}if(null!=t){if(Array.isArray(t))return t.includes(n.value);if(t!==n.value)return!1}return!0},advance(l,i){if(null!=l)if(Array.isArray(l)){if(!l.includes(a.type))throw new W(`Expected a token with a set of types, but found '${a.type}'`,a.indexStart,a.indexEnd)}else if(a.type!==l)throw new W(`Expected a token with type '${l}', but found '${a.type}'`,a.indexStart,a.indexEnd);if(null!=i)if(Array.isArray(i)){if(!i.includes(a.value))throw new W(`Expected a token with a set of values, but found '${a.value}'`,a.indexStart,a.indexEnd)}else if(a.value!==i)throw new W(`Expected a token with value '${i}', but found '${a.value}'`,a.indexStart,a.indexEnd);const o=a;return a=n,n=te(e,t),t=n.indexEnd,o},advanceIfExists(e,t){if(e&&a.type!==e)return null;if(null!=t)if(Array.isArray(t)){if(!t.includes(a.value))return null}else if(a.value!==t)return null;return this.advance(e,t)}}}(e);var a;return se(ie(a=t,oe(a)))}function me(e,t){if(void 0===e||"symbol"==typeof e)return;if(null===e)return"null";if(e===Number.POSITIVE_INFINITY)return"INF";if(e===isNaN)return"NaN";if(e instanceof Date)return e.toISOString();if("string"==typeof e)return e.includes("'")?`'${e.replace(/'/g,"''")}'`:`'${e}'`;if("number"==typeof e||"bigint"==typeof e||"boolean"==typeof e)return String(e);if(e.not)return"-"+me(e.not,t);if(Array.isArray(e))return`(${e.map((e=>me(e,t))).join()})`;if(e.lambda)return`${e.path}/${e.lambda}(${e.name}:${me(e.expression,t)})`;if(e.guid)return e.guid;if(e.alias){const a=e.alias.substring(1),n=Array.isArray(t)&&t.find((([e])=>e===a));return n?me(n[1],t):e.alias}if(e.property)return e.property;if(e.literal)return e.literal;const a=z.find((t=>t in e));if(a)return Array.isArray(e[a])?`${a}(${e[a].map((e=>me(e,t))).join()})`:`${a}(${me(e[a],t)})`;const n=j.find((t=>t in e));if(n)return`(${e[n].map((e=>me(e,t))).join(` ${n} `)})`;throw new Error("El filtro odata no se reconoce.")}const pe={collection(e,t,a,n){for(let l=0;l<e.length;l+=1)if(fe(e[l],t,a,[...n,l]))return!0},negative(e,t,a,n){if("pre"===a.order){if(t(e,n))return!0;if(fe(e.not,t,a,[...n,"not"]))return!0}else if("post"===a.order){if(fe(e.not,t,a,[...n,"not"]))return!0;if(t(e,n))return!0}},functionCall(e,t,a,n){const l=z.find((t=>t in e));if("pre"===a.order){if(t(e,n))return!0;if(pe.collection(e[l],t,a,[...n,l]))return!0}else if("post"===a.order){if(pe.collection(e[l],t,a,[...n,l]))return!0;if(t(e,n))return!0}},lambda(e,t,a,n){const l=`${e.path}/${e.lambda}`;if("pre"===a.order){if(t(e,n))return!0;if(fe(e.expression,t,a,[...n,l]))return!0}else if("post"===a.order){if(fe(e.expression,t,a,[...n,l]))return!0;if(t(e,n))return!0}},operators(e,t,a,n){const l=j.find((t=>t in e));if("pre"===a.order){if(t(e,n))return!0;if(pe.collection(e[l],t,a,[...n,l]))return!0}else if("post"===a.order){if(pe.collection(e[l],t,a,[...n,l]))return!0;if(t(e,n))return!0}}};function fe(e,t,a={order:"post"},n=[]){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null===e||e===isNaN||e===Number.POSITIVE_INFINITY||e instanceof Date||e.guid||e.alias||e.property||e.literal?t(e,n):Array.isArray(e)?pe.collection(e,t,a,n):e.not?pe.negative(e,t,a,n):z.some((t=>t in e))?pe.functionCall(e,t,a,n):e.lambda?pe.lambda(e,t,a,n):j.some((t=>t in e))?pe.operators(e,t,a,n):void 0}function ye(e,t,a){if(Array.isArray(a)&&"string"==typeof e?.alias&&1===Object.keys(e).length)return a.push([e.alias.substring(1),t]),!0;if(typeof e==typeof t){if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){const n=Array.isArray(a)?[]:null;let l=!0;for(let a=0;a<e.length;a+=1){const i=ye(e[a],t[a],n);if(!1===i)return!1;Array.isArray(i)&&(l=i)}return l&&n?.length>0&&a.push(...n),l}if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if("object"==typeof e){const n=Object.keys(e),l=Object.keys(t);if(n.length===l.length&&n.every((e=>l.includes(e)))){const l=Array.isArray(a)?[]:null;let i=!0;for(const a of n){const n=ye(e[a],t[a],l);if(!1===n)return!1;Array.isArray(n)&&(i=n)}return i&&l?.length>0&&a.push(...l),i}}return e===t}return!1}class ve{constructor(e,t=null){this.conditions=[];for(const t of e)if(t instanceof ve)this.conditions.push(t);else{if("string"!=typeof t)throw new Error;{const e=ce(t),a=[];fe(e,((e,t)=>{e.alias&&a.push({name:e.alias.substring(1),path:e.path})})),this.conditions.push({filter:t,structure:e,aliases:a})}}this.aggrupationOperation=t}getConditionValue(e){const t=[];for(const a of this.conditions)if(a instanceof ve){const n=a.getConditionValue(e);n.length>0&&t.push(...n)}else ye(a.structure,e,t);return t}readFilter(e){if(!this.aggrupationOperation)throw new Error;const t=[];if(e){const a=ce(e),n=Array.isArray(a[this.aggrupationOperation])?[a,...a[this.aggrupationOperation]]:[a];for(const e of n){const a=this.getConditionValue(e);a.length>0&&t.push(...a)}}return t}findValuesInFilter(e){const t=[];return fe(ce(e),(e=>{const a=this.getConditionValue(e);a.length>0&&t.push(...a)})),t}writeFilter(e){if(!this.aggrupationOperation)throw new Error;const t=[];for(const a of this.conditions)if(a instanceof ve){const n=a.writeFilter(e);n&&t.push(n)}else a.aliases.every((t=>e.some((([e])=>t.name===e))))&&t.push(me(a.structure,e));return t.length>0?`(${t.join(` ${this.aggrupationOperation} `)})`:""}}const Ae=["textContent"],Ie={__name:"details-cell-generic",props:{field:{type:Object,default:void 0},row:{type:Object,default:void 0}},setup(e){const t=e,a=(0,n.ref)("");return(0,n.watchEffect)((async()=>{if(t.field&&t.row){const e=wt[t.field.type];a.value="function"==typeof e?.getTextValueFromEntity?await e.getTextValueFromEntity(t.field,t.row):t.row[t.field.name]}else a.value=""})),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{textContent:(0,n.toDisplayString)(a.value)},null,8,Ae))}},ge=(0,F.Z)(Ie,[["__scopeId","data-v-29f5092a"]]);function Te(e,t){return t[e.navigationKey]?.["@odata.count"]??""}const be={detailsCell:ge,getDetailsODataQuery:e=>({$expand:`${e.navigationKey}($count=true;$top=0)`}),getOrderbySentence:e=>`${e.navigationKey}/$count`,getFilterCondition:e=>"eq"===e.operation?`${e.navigationKey}/$count eq @${e.name}`:"between"===e.operation?new ve([`${e.navigationKey}/$count gt @${e.name}_gt`,`${e.navigationKey}/$count lt @${e.name}_lt`],"and"):void 0,getFilterInterface:e=>"eq"===e.operation?{type:"number",name:e.name,label:e.label}:"between"===e.operation?[{type:"number",name:`${e.name}_gt`,label:`${e.label} Menor`},{type:"number",name:`${e.name}_lt`,label:`${e.label} Major`}]:void 0,getTextValueFromEntity:Te,getCsvValueFromEntity:Te},Oe={__name:"form-field-choice",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},options:{type:Array,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>(a.options||a.field.options).map((e=>"string"==typeof e?{value:e,text:e}:e))));function o(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(t,a)=>{const r=(0,n.resolveComponent)("llesca-field-dropdown");return(0,n.openBlock)(),(0,n.createBlock)(r,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,options:i.value,placeholder:e.placeholder??e.field.placeholder,readonly:e.readonly??e.field.readonly,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":o,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","options","placeholder","readonly","immediate-scroll","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","model-value"])}}};function Ce({focusHandler:e,blurHandler:t,$emit:a}={}){const l=(0,n.ref)(!1),i=(0,n.computed)((()=>!l.value));return{focus:l,borderless:i,handleFocus(t){l.value=!0,e?.(t),a?.("focus",t)},handleBlur(e){l.value=!1,t?.(e),a?.("blur",e)}}}const Ne={__name:"grid-field-choice",props:{invalid:{type:Boolean,default:void 0},options:{type:Array,default:void 0},placeholder:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Oe),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};function he(e,t){return t[e.name]??""}const _e={detailsCell:ge,formField:Oe,gridField:(0,F.Z)(Ne,[["__scopeId","data-v-ce6a5b82"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"in"===e.operation?`${e.name} in @${e.name}`:void 0,getFilterInterface(e){if(["eq","in"].includes(e.operation))return{type:"combo",name:e.name,label:e.label,multiple:"in"===e.operation}},loadCache:async e=>e.options.map((e=>"string"==typeof e?{value:e,text:e}:e)),getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):null!=e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:he,getCsvValueFromEntity:he},Ee={__name:"form-field-date",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},notWritable:{type:Boolean,default:void 0},days:{type:Array,default:void 0},months:{type:Array,default:void 0},goToday:{type:String,default:void 0},firstDayOfTheWeek:{type:Number,default:void 0},today:{type:Date,default:void 0},parse:{type:Function,default:void 0},stringifyFocus:{type:Function,default:void 0},createField:{type:Function,default:void 0},stringify:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},min:{type:Date,default:void 0},max:{type:Date,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t;function i(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(t,a)=>{const o=(0,n.resolveComponent)("llesca-field-date");return(0,n.openBlock)(),(0,n.createBlock)(o,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,placeholder:e.placeholder??e.field.placeholder,"not-writable":e.notWritable??e.field.notWritable,days:e.days??e.field.days,months:e.months??e.field.months,"go-today":e.goToday??e.field.goToday,"first-day-of-the-week":e.firstDayOfTheWeek??e.field.firstDayOfTheWeek,today:e.today??e.field.today,parse:e.parse??e.field.parse,"stringify-focus":e.stringifyFocus??e.field.stringifyFocus,stringify:e.stringify??e.field.stringify,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,min:e.min??e.field.min,max:e.max??e.field.max,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,name:e.name??e.field.name,"create-field":e.validations?.createField,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":i,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","placeholder","not-writable","days","months","go-today","first-day-of-the-week","today","parse","stringify-focus","stringify","required","disabled","min","max","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","name","create-field","model-value"])}}},Pe={__name:"grid-field-date",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},notWritable:{type:Boolean,default:void 0},days:{type:Array,default:void 0},months:{type:Array,default:void 0},goToday:{type:String,default:void 0},firstDayOfTheWeek:{type:Number,default:void 0},today:{type:Date,default:void 0},parse:{type:Function,default:void 0},stringifyFocus:{type:Function,default:void 0},createField:{type:Function,default:void 0},stringify:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},min:{type:Date,default:void 0},max:{type:Date,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Ee),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};function Se(e,t=2){return e.toString().padStart(t,"0")}function De(e,t){if(!t[e.name])return"";const a=new Date(t[e.name]);return a?`${Se(a.getDate())}/${Se(a.getMonth()+1)}/${Se(a.getFullYear(),4)}`:void 0}const Fe={detailsCell:ge,formField:Ee,gridField:(0,F.Z)(Pe,[["__scopeId","data-v-1980b3b4"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"between"===e.operation?new ve([`${e.name} gt @${e.name}_gt`,`${e.name} lt @${e.name}_lt`],"and"):void 0,getFilterInterface:e=>"eq"===e.operation?{type:"date",name:e.name,label:e.label}:"between"===e.operation?[{type:"date",name:`${e.name}_gt`,label:`${e.label} Menor`},{type:"date",name:`${e.name}_lt`,label:`${e.label} Major`}]:void 0,getPropertyDefinition:(e,t)=>({keys:[e.name],dateKeys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):e.defaultValue instanceof Date&&(t[e.name]=new Date(e.defaultValue.getTime())))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:De,getCsvValueFromEntity:De},Ve=(0,l.defineStore)({id:"dialog",state:()=>({loading:new Set,alertList:[],confirmList:[]}),actions:{loadStart(e){this.loading.add(e)},loadEnd(e){this.loading.delete(e)},alert(e){this.alertList.push(e)},alertClose(){const e=this.alertList.shift();if("function"==typeof e?.close)return e.close()},confirm(e){this.confirmList.push(e)},confirmAccept(){const e=this.confirmList.shift();if("function"==typeof e?.accept)return e.accept()},confirmCancel(){const e=this.confirmList.shift();if("function"==typeof e?.cancel)return e.cancel()}}});async function Me(e,t,a){const n=Ve();a||n.loadStart(e);try{const a=await t();return n.loadEnd(e),a}catch(t){throw n.loadEnd(e),t}}function xe(e,t,a={},{withoutDialog:n=!1}={}){return Me(Symbol("requestGet"),(()=>o.odata.requestGet([m,e].flat(),t,{Authorization:O().jwt,...a})),n)}function Re(e,t,a={},{withoutDialog:n=!1}={}){return Me(Symbol("requestDelete"),(()=>o.odata.requestDelete([m,e].flat(),t,{Authorization:O().jwt,...a})),n)}function we(e){const t=[],a=[];for(const n of e){const l=wt[n.type];if(l){const i=l.getDetailsODataQuery(n,e);i.$select&&!t.includes(i.$select)&&t.push(i.$select),!i.$expand||a.includes(i.$expand)||a.some((e=>e.startsWith(i.$expand)||i.$expand.startsWith(e)))||a.push(i.$expand)}}return{$select:t.length>0?t:void 0,$expand:a.length>0?a:void 0}}function Be(e){return wt[e.type]?.getOrderbySentence(e)}function Le(e,t,{notOverwrite:a}={}){for(const n of e.fields){const e=wt[n.type];e.setDetaultValueToEntity?.(n,t,{notOverwrite:a})}}function ke(e,t){const a=t?.split(","),n=wt[e.type];if(n.readAggregationField)return a.find((t=>n.readAggregationField(t)===e.name))}function $e(e){return Object.fromEntries(Ba().filter((e=>"dictionary"===e.type)).map((t=>[t.name,"function"==typeof e?e():e])))}const Ue=(0,l.defineStore)({id:"dictionary",state:()=>({data:$e(null),loading:$e((()=>({state:!1,callbacks:null})))}),actions:{loadDictionary(e,{force:t=!1}={}){const a=(0,n.unref)(e);if(Ba(a)&&"dictionary"===Ba(a).type){if(this.loading[a].state)return new Promise((e=>{this.loading[a].callbacks.push(e)}));if(!this.data[a]||t)return new Promise((e=>{const t=Ve();this.loading[a].state=!0,this.loading[a].callbacks=[],t.loadStart(`dictionary/${a}/load`),xe(a,{...we(Ba(a).fields)}).then((n=>{this.data[a]=n.value,t.loadEnd(`dictionary/${a}/load`);const l=[e,...this.loading[a].callbacks];this.loading[a].state=!1,this.loading[a].callbacks=null,l.forEach((e=>e()))}))}))}return Promise.resolve()}}});function qe(e,t){const a=(0,n.shallowRef)([]);return(0,n.watchEffect)((()=>{const l=e.filter??e.field?.filter,i=e.useFilter??e.field?.useFilter;a.value="function"==typeof l?(0,n.unref)(t).filter(l):"function"==typeof i?(0,n.unref)(t).filter(i(e.entity)):(0,n.unref)(t)})),{filteredData:a}}const Ge={__name:"form-field-dictionary",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},entityName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=Ue(),o=(0,n.computed)((()=>a.entityName??a.field.entityName)),r=(0,n.shallowRef)([]);(0,n.watch)(o,(async e=>{await i.loadDictionary(e),r.value=i.data[e]}),{immediate:!0});const{filteredData:d}=qe(a,r),u=(0,n.computed)((()=>Ba(o.value))),s=(0,n.computed)((()=>u.value.fields.find((e=>e.primary)).name)),c=(0,n.computed)((()=>u.value.fields.find((e=>e.defaultField)).name)),m=(0,n.computed)((()=>d.value.map((e=>({value:e[s.value],text:e[c.value]})))));function p(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,options:m.value,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":p,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","options","model-value"])}}},Ke={__name:"grid-field-dictionary",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},entityName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Ge),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};async function je(e,t){const a=Ue();await a.loadDictionary(e.entityName);const n=Ba(e.entityName),l=n.fields.find((e=>e.primary)).name,i=n.fields.find((e=>e.defaultField)).name,o=t[e.name],r=a.data[e.entityName]?.find((e=>e[l]===o));return r?.[i]??""}const ze={detailsCell:ge,formField:Ge,gridField:(0,F.Z)(Ke,[["__scopeId","data-v-3c8d511f"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>`${e.navigationKey||e.entityName}/${Ba(e.entityName).fields.find((e=>e.defaultField)).name}`,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"in"===e.operation?`${e.name} in @${e.name}`:"contains"===e.operation?`contains(${e.navigationKey||e.entityName}/${Ba(e.entityName).fields.find((e=>e.defaultField)).name}, @${e.name})`:void 0,getFilterInterface(e){if("eq"===e.operation){const t=Ba(e.entityName);return{type:"combo",name:e.name,label:e.label,valueKey:t.fields.find((e=>e.primary)).name,textKey:t.fields.find((e=>e.defaultField)).name}}if("in"===e.operation){const t=Ba(e.entityName);return{type:"combo",name:e.name,label:e.label,multiple:!0,valueKey:t.fields.find((e=>e.primary)).name,textKey:t.fields.find((e=>e.defaultField)).name}}if("contains"===e.operation)return{type:"text",name:e.name,label:e.label}},async loadCache(e){const t=Ue();return await t.loadDictionary(e.entityName),t.data[e.entityName]},getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):null!=e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:je,getCsvValueFromEntity:je,getAggregations:e=>[{name:"Count distinct",getExpression:()=>`${e.name} with countdistinct as ${e.name}`}],readAggregationField(e){const t=e?.match(/^(\w+) with countdistinct as \1$/);if(t)return t[1]}},He={__name:"form-field-dictionary-multi",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},entityName:{type:String,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionDictionaryKey:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=Ue(),o=(0,n.computed)((()=>a.entityName??a.field.entityName)),r=(0,n.shallowRef)([]);(0,n.watch)(o,(async e=>{await i.loadDictionary(e),r.value=i.data[e]}),{immediate:!0});const{filteredData:d}=qe(a,r),u=(0,n.computed)((()=>Ba(o.value))),s=(0,n.computed)((()=>u.value.fields.find((e=>e.primary)).name)),c=(0,n.computed)((()=>u.value.fields.find((e=>e.defaultField)).name)),m=(0,n.computed)((()=>d.value.map((e=>({value:e[s.value],text:e[c.value]}))))),p=(0,n.computed)((()=>{const e=a.junctionNavigationKey??a.field.junction.navigationKey,t=a.junctionEntityName??a.field.junction.name;return e||t})),f=(0,n.computed)({get(){const e=a.junctionDictionaryKey??a.field.junction.dictionaryKey;return a.entity[p.value].map((t=>t[e]))},set(e){const t=a.junctionDictionaryKey??a.field.junction.dictionaryKey;l("change",(a=>{const n=a[p.value];for(let a=n.length-1;a>=0;a-=1)e.includes(n[a][t])||n.delete(a);for(const a of e){const e=n.some((e=>e[t]===a));e||n.add({[t]:a})}}))}});return(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(i,{multiple:"",label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"max-selected-options":e.maxSelectedOptions??e.field.maxSelectedOptions,options:m.value,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),onFocus:a[1]||(a[1]=e=>l("focus",e)),onBlur:a[2]||(a[2]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","max-selected-options","options","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","modelValue"])}}},We={__name:"grid-field-dictionary-multi",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},entityName:{type:String,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionDictionaryKey:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(He),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};async function Ye(e,t){const a=Ue();await a.loadDictionary(e.entityName);const n=Ba(e.entityName),l=n.fields.find((e=>e.primary)).name,i=n.fields.find((e=>e.defaultField)).name,o=e.junction.navigationKey||e.junction.name,r=a.data[e.entityName];return t[o]?.map((t=>r?.find((a=>a[l]===t[e.junction.dictionaryKey]))?.[i])).filter((e=>e)).join(", ")||""}const Ze={detailsCell:ge,formField:He,gridField:(0,F.Z)(We,[["__scopeId","data-v-e6e02e5c"]]),getDetailsODataQuery:e=>({$expand:`${e.junction.navigationKey||e.junction.name}($select=${e.junction.primaryKey},${e.junction.dictionaryKey})`}),getOrderbySentence:e=>null,getFilterCondition(e){const t=e.junction.navigationKey||e.junction.name;return"in"===e.operation?`${t}/any(o: o/${e.junction.dictionaryKey} in @${e.name})`:"contains"===e.operation?`contains(${t}/${Ba(e.entityName).fields.find((e=>e.defaultField)).name}, @${e.name})`:void 0},getFilterInterface(e){if("in"===e.operation){const t=Ba(e.entityName);return{type:"combo",name:e.name,label:e.label,multiple:"in"===e.operation,valueKey:t.fields.find((e=>e.primary)).name,textKey:t.fields.find((e=>e.defaultField)).name}}if("contains"===e.operation)return{type:"text",name:e.name,label:e.label}},async loadCache(e){const t=Ue();return await t.loadDictionary(e.entityName),t.data[e.entityName]},getPropertyDefinition(e,t){const{navigationKey:a,name:n,primaryKey:l,ownerKey:i,dictionaryKey:o}=e.junction;return{children:[{navigationKey:a,entityName:n,primaryKey:l,foreingKey:i,keys:[l,i,o]}]}},getEntityValue(e,t){const a=e.junction.navigationKey||e.junction.name,n=e.junction.dictionaryKey;return t[a].map((e=>e[n]))},getTextValueFromEntity:Ye,getCsvValueFromEntity:Ye};function Xe(e){const t=et(e,e.form);return(0,o.useEntity)(t)}function Je(e){const t=O();return(0,o.entitySave)(e,m,{Authorization:t.jwt})}function Qe(e){const t=O();return(0,o.entityDelete)(e,m,{Authorization:t.jwt})}function et(e,{navigationKey:t=null,children:a=[],foreingKey:n=null,detailFields:l=[]}){const i={navigationKey:t,entityName:e.name||e.entityName,primaryKey:e.fields.find((e=>e.primary)).name,foreingKey:n,keys:null,dateKeys:null,children:null,details:null};for(const e of a){const t=Ba(e.listName);i.children=nt(i.children,[et(t,e)])}for(const t of e.fields){const{getPropertyDefinition:e}=wt[t.type]||{};if("function"==typeof e){const a=e(t,!0===l||l?.includes(t.name));i.keys=at(i.keys,a.keys),i.ignoredKeys=at(i.ignoredKeys,a.ignoredKeys),i.dateKeys=at(i.dateKeys,a.dateKeys),i.children=nt(i.children,a.children),i.details=nt(i.details,a.details)}}return i}function tt(e,...t){for(const a of t)at(e.keys,a.keys),at(e.dateKeys,a.dateKeys),nt(e.children,a.children),nt(e.details,a.details);return e}function at(e,t){if(lt(e)&&lt(t))for(const a of t)e.includes(a)||e.push(a);else if(!lt(e)&&lt(t))return t;return e}function nt(e,t){if(lt(e)&&lt(t)){const a=[...t];for(const t of e){const e=a.findIndex((e=>t.navigationKey==e.navigationKey&&t.entityName===e.entityName&&t.primaryKey===e.primaryKey&&t.foreingKey===e.foreingKey));if(e>=0){const[n]=a.splice(e,1);tt(t,n)}}e.push(...a)}else if(!lt(e)&&lt(t))return t;return e}function lt(e){return Array.isArray(e)&&e.length>0}function it(e,t){const{navigationKey:a,name:n,nameKey:l}=e.entity,i=a||n;return t[i]?.map((e=>e[l])).join()??""}const ot={detailsCell:ge,formField:{__name:"form-field-file-multi",props:{label:{type:String,default:void 0},disabled:{type:Boolean,default:void 0},required:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},maxFiles:{type:Number,default:void 0},modelValue:{type:Array,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},entityName:{type:String,default:void 0},navigationKey:{type:String,default:void 0},primaryKey:{type:String,default:void 0},foreingKey:{type:String,default:void 0},nameKey:{type:String,default:void 0},contentKey:{type:String,default:void 0},typeKey:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=Ve();function r(e){const t=new FileReader;t.addEventListener("load",(t=>{const n=a.entityName??a.field.entity?.name,l=a.navigationKey??a.field.entity?.navigationKey,i=a.nameKey??a.field.entity?.nameKey,o=a.contentKey??a.field.entity?.contentKey,r=a.typeKey??a.field.entity?.typeKey;a.entity[l??n].add({[i]:e.name,[r]:e.type,[o]:t.target.result.replace(/^.+,/,"")})})),t.addEventListener("error",(()=>i.alert({title:"Error",message:"Error al llegir el arxiu."}))),t.readAsDataURL(e)}function d(e){const t=a.entityName??a.field.entity?.name,n=a.navigationKey??a.field.entity?.navigationKey;a.entity[n??t].delete(e)}const u=(0,n.computed)((()=>{const e=a.entityName??a.field.entity?.name,t=a.navigationKey??a.field.entity?.navigationKey,n=a.primaryKey??a.field.entity?.primaryKey,l=a.nameKey??a.field.entity?.nameKey,i=a.contentKey??a.field.entity?.contentKey,r=a.typeKey??a.field.entity?.typeKey;return(0,o.entityData)(a.entity[t??e]).map((t=>[t[l],async()=>{if(!t[i]){const a=await xe(`${e}(${t[n]})`,{$select:i});t[i]=a[i]}return`data:application/octet-stream;base64,${t[i]}`},t[r]]))}));return(t,a)=>{const i=(0,n.resolveComponent)("fura-file-multi");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.label??e.field.label,disabled:e.disabled??e.field.disabled,required:e.required??e.field.required,readonly:e.readonly??e.field.readonly,"max-files":e.maxFiles??e.field.maxFiles,"model-value":u.value,onLoad:r,onDelete:d,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","disabled","required","readonly","max-files","model-value"])}}},getDetailsODataQuery(e){const{name:t,navigationKey:a,primaryKey:n,foreingKey:l,nameKey:i,contentKey:o,typeKey:r}=e.entity;return{$expand:`${a||t}($select=${n},${l},${i},${o},${r})`}},getOrderbySentence:e=>null,getFilterCondition(e){if("has"===e.operation)return`(${e.entity.navigationKey||e.entity.name}/$count ne 0) eq @${e.name}`},getFilterInterface(e){if("has"===e.operation)return{type:"checkbox",name:e.name,label:e.label}},getPropertyDefinition(e,t){const{name:a,navigationKey:n,primaryKey:l,foreingKey:i,nameKey:o,contentKey:r,typeKey:d}=e.entity;return{children:[{navigationKey:n,entityName:a,primaryKey:l,foreingKey:i,keys:[l,i,o,r,d],ignoredKeys:[r]}]}},getTextValueFromEntity:it,getCsvValueFromEntity:it},rt=["value"];function dt(e,t){return t[e.name]??""}const ut={detailsCell:ge,formField:{__name:"form-field-hidden",props:{name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","focus","blur"],setup(e){const t=e,a=t.name||t.field.name,l=(0,n.computed)((()=>t.entity[a]));return t.validations.createField(a,l),(e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("input",{type:"hidden",value:String(l.value)},null,8,rt))}},getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition(e){},getFilterInterface(e){},getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):"string"==typeof e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:dt,getCsvValueFromEntity:dt},st={__name:"form-field-lookup",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},navigationKey:{type:String,default:void 0},entityName:{type:String,default:void 0},primaryKey:{type:String,default:void 0},targetKey:{type:String,default:void 0},filter:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=O(),r=Ve(),d=(0,n.computed)((()=>a.entityName??a.field.entity.name)),u=(0,n.computed)((()=>a.primaryKey??a.field.entity.primaryKey)),s=(0,n.computed)((()=>a.targetKey??a.field.entity.targetKey)),{options:c,isLoading:p}=(0,o.useOptionsLoader)(m,d,u,s,{$filter:(0,n.computed)((()=>a.filter??a.field.filter))},{Authorization:i.jwt});function f(e){const t=a.name??a.field.name,n=(a.navigationKey??a.field.entity.navigationKey)||d.value,i=c.value.find((t=>t.value===e))?.text;l("change",(a=>{a[t]=e,a[n]={[s.value]:i}}))}return(0,n.watch)(p,(e=>e&&d.value?r.loadStart(`list/${d.value}/load`):r.loadEnd(`list/${d.value}/load`)),{immediate:!0}),(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,options:(0,n.unref)(c),"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":f,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","options","model-value"])}}},ct={__name:"grid-field-lookup",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},navigationKey:{type:String,default:void 0},entityName:{type:String,default:void 0},primaryKey:{type:String,default:void 0},targetKey:{type:String,default:void 0},filter:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(st),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}},mt=(0,F.Z)(ct,[["__scopeId","data-v-543d71e4"]]);function pt(e,t){const{navigationKey:a,name:n,targetKey:l}=e.entity,i=a||n;return t[i]?.[l]??""}const ft={detailsCell:ge,formField:st,gridField:mt,getDetailsODataQuery(e){const t=e.entity.navigationKey||e.entity.name;return{$select:e.name,$expand:`${t}($select=${e.entity.targetKey})`}},getOrderbySentence:e=>`${e.entity.navigationKey||e.entity.name}/${e.entity.targetKey}`,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"in"===e.operation?`${e.name} in @${e.name}`:"contains"===e.operation?`contains(${e.entity.navigationKey||e.entity.name}/${e.entity.targetKey}, @${e.name})`:void 0,getFilterInterface:e=>"eq"===e.operation?{type:"combo",name:e.name,label:e.label,valueKey:e.entity.primaryKey,textKey:e.entity.targetKey}:"in"===e.operation?{type:"combo",name:e.name,label:e.label,multiple:!0,valueKey:e.entity.primaryKey,textKey:e.entity.targetKey}:"contains"===e.operation?{type:"text",name:e.name,label:e.label}:void 0,getPropertyDefinition:(e,t=!1)=>({keys:[e.name],details:t?[{navigationKey:e.entity.navigationKey,entityName:e.entity.name,keys:[e.entity.targetKey]}]:null}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):null!=e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:pt,getCsvValueFromEntity:pt,getAggregations:e=>[{name:"Count distinct",getExpression:()=>`${e.name} with countdistinct as ${e.name}`}],readAggregationField(e){const t=e?.match(/^(\w+) with countdistinct as \1$/);if(t)return t[1]}};function yt(e,t){const{navigationKey:a,name:n,targetKey:l}=e.entity,i=a||n;return t[i]?.[l]??""}const vt={detailsCell:ge,formField:{__name:"form-field-lookup-async",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},getOptions:{type:Object,default:void 0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},navigationKey:{type:String,default:void 0},entityName:{type:String,default:void 0},primaryKey:{type:String,default:void 0},targetKey:{type:String,default:void 0},filter:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>a.entityName??a.field.entity.name)),o=(0,n.computed)((()=>a.targetKey??a.field.entity.targetKey)),r=(0,n.computed)((()=>{const e=(a.navigationKey??a.field.entity.navigationKey)||i.value||a.field.name;return{value:a.entity[a.field.name],text:a.entity[e]?.[o.value]}}));function d(e){const t=a.name??a.field.name,n=(a.navigationKey??a.field.entity.navigationKey)||i.value;l("change",(a=>{a[t]=e?.value,a[n]={[o.value]:e?.text}}))}return(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo-async");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":!0,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,"get-options":e.field.getOptions,"get-options-wait":e.field.getOptionsWait||800,"model-value":r.value,"onUpdate:modelValue":d,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","auto-complete","accent-insensitive","placeholder","immediate-scroll","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","get-options","get-options-wait","model-value"])}}},gridField:mt,getDetailsODataQuery(e){const t=e.entity.navigationKey||e.entity.name;return{$select:e.name,$expand:`${t}($select=${e.entity.targetKey})`}},getOrderbySentence:e=>`${e.entity.navigationKey||e.entity.name}/${e.entity.targetKey}`,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"in"===e.operation?`${e.name} in @${e.name}`:"contains"===e.operation?`contains(${e.entity.navigationKey||e.entity.name}/${e.entity.targetKey}, @${e.name})`:void 0,getFilterInterface:e=>"eq"===e.operation?{type:"combo",name:e.name,label:e.label,valueKey:e.entity.primaryKey,textKey:e.entity.targetKey}:"in"===e.operation?{type:"combo",name:e.name,label:e.label,multiple:!0,valueKey:e.entity.primaryKey,textKey:e.entity.targetKey}:"contains"===e.operation?{type:"text",name:e.name,label:e.label}:void 0,getPropertyDefinition:(e,t=!1)=>({keys:[e.name],details:t?[{navigationKey:e.entity.navigationKey,entityName:e.entity.name,keys:[e.entity.targetKey]}]:null}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):null!=e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:yt,getCsvValueFromEntity:yt,getAggregations:e=>[{name:"Count distinct",getExpression:()=>`${e.name} with countdistinct as ${e.name}`}],readAggregationField(e){const t=e?.match(/^(\w+) with countdistinct as \1$/);if(t)return t[1]}},At=(0,l.defineStore)({id:"listCache",state:()=>({contextName:null,data:{}}),actions:{setContextName(e){const t=(0,n.toRaw)(e);this.contextName!==t&&(this.contextName=t,this.data={})},async load(e,{force:t=!1}={}){const a=(0,n.toRaw)(e);if(t||!(a in this.data)){const e=Ba(a);if(e){this.data[a]={};const t=[];for(const a of e.fields)wt[a.type]?.loadCache&&t.push({name:a.name,promise:wt[a.type].loadCache(a,e.fields)});const n=await Promise.all(t.map((e=>e.promise)));for(let e=0;e<n.length;e+=1){const l=t[e].name;this.data[a][l]=n[e]}}}},async reloadField(e,t){const a=(0,n.toRaw)(e);if(this.data[a]){const e=Ba(a);if(e){const l=e.fields.find((e=>e.name===(0,n.toRaw)(t)));if(l){const t=wt[l.type];t&&t.loadCache&&(this.data[a][l.name]=await t.loadCache(l,e.fields))}}}},setData(e,t){this.data[e]=t}}}),It={__name:"form-field-lookup-cache",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},cacheName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=At(),o=(0,n.computed)((()=>i.data[a.cacheName]?.[a.field.name]||[])),{filteredData:r}=qe(a,o),d=(0,n.computed)((()=>a.field.entity.primaryKey)),u=(0,n.computed)((()=>a.field.entity.targetKey)),s=(0,n.computed)((()=>r.value.map((e=>({value:e[d.value],text:e[u.value]})))));function c(e){const t=a.name??a.field.name,n=a.field.entity.navigationKey||a.field.entity.name,i=s.value.find((t=>t.value===e))?.text;l("change",(a=>{a[t]=e,a[n]={[u.value]:i}}))}return(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,options:s.value,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":c,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","options","model-value"])}}},gt={__name:"grid-field-lookup-cache",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},createField:{type:Function,default:void 0},modelValue:{type:void 0,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},cacheName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(It),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}},Tt=(0,F.Z)(gt,[["__scopeId","data-v-bccf8768"]]),bt={...ft,formField:It,gridField:Tt,loadCache:async e=>(await xe(e.entity.name,{$select:[e.entity.primaryKey,e.entity.targetKey,...e.entity.cache||[]],$orderby:e.entity.targetKey})).value},Ot={__name:"form-field-lookup-multi",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionTargetKey:{type:String,default:void 0},dataEntityName:{type:String,default:void 0},dataPrimaryKey:{type:String,default:void 0},dataTargetKey:{type:String,default:void 0},filter:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.shallowRef)([]);(0,n.watchEffect)((async()=>{const e=a.dataEntityName??a.field.data?.name,t=a.dataPrimaryKey??a.field.data?.primaryKey,n=a.dataTargetKey??a.field.data?.targetKey,l=a.filter??a.field.data.filter,o=await xe(e,{$select:`${t},${n}`,$filter:l||void 0,$orderby:`${n} asc`});i.value=o.value.map((e=>({value:e[t],text:e[n]})))}));const r=(0,n.computed)((()=>{const e=a.junctionNavigationKey??a.field.junction.navigationKey,t=a.junctionEntityName??a.field.junction.name;return e||t})),d=(0,n.computed)({get(){const e=a.junctionTargetKey??a.field.junction.targetKey;return(0,o.entityData)(a.entity[r.value]).map((t=>t[e]))},set(e){const t=a.junctionTargetKey??a.field.junction.targetKey;l("change",(a=>{const n=a[r.value];for(let a=n.length-1;a>=0;a-=1)e.includes(n[a][t])||n.delete(a);for(const a of e){const e=n.some((e=>e[t]===a));e||n.add({[t]:a})}}))}});return(t,a)=>{const o=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(o,{multiple:"",label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"max-selected-options":e.maxSelectedOptions??e.field.maxSelectedOptions,options:i.value,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),onFocus:a[1]||(a[1]=e=>l("focus",e)),onBlur:a[2]||(a[2]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","max-selected-options","options","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","modelValue"])}}},Ct={__name:"grid-field-lookup-multi",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionTargetKey:{type:String,default:void 0},dataEntityName:{type:String,default:void 0},dataPrimaryKey:{type:String,default:void 0},dataTargetKey:{type:String,default:void 0},filter:{type:String,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Ot),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};function Nt(e,t){const a=e.junction.navigationKey||e.junction.name,n=e.data.navigationKey||e.data.name,l=e.data.targetKey;return t[a]?.map((e=>e[n][l])).join(", ")??""}const ht={detailsCell:ge,formField:Ot,gridField:(0,F.Z)(Ct,[["__scopeId","data-v-683903ff"]]),getDetailsODataQuery:e=>({$expand:`${e.junction.navigationKey||e.junction.name}($expand=${e.data.navigationKey||e.data.name}($select=${e.data.primaryKey},${e.data.targetKey};$orderby=${e.data.targetKey}))`}),getOrderbySentence:e=>null,getFilterCondition(e){const t=e.junction.navigationKey||e.junction.name;return"in"===e.operation?`${t}/any(o: o/${e.junction.targetKey} in @${e.name})`:"contains"===e.operation?`contains(${t}/${e.junction.targetKey}, @${e.name})`:void 0},getFilterInterface:e=>"in"===e.operation?{type:"combo",name:e.name,label:e.label,multiple:"in"===e.operation,valueKey:e.data.primaryKey,textKey:e.data.targetKey}:"contains"===e.operation?{type:"text",name:e.name,label:e.label}:void 0,getPropertyDefinition(e,t){const{navigationKey:a,name:n,primaryKey:l,ownerKey:i,targetKey:o}=e.junction;return{children:[{navigationKey:a,entityName:n,primaryKey:l,foreingKey:i,keys:[l,i,o]}]}},getEntityValue(e,t){const a=e.junction.navigationKey||e.junction.name,n=e.junction.targetKey;return t[a].map((e=>e[n]))},getTextValueFromEntity:Nt,getCsvValueFromEntity:Nt},_t={__name:"form-field-lookup-multi-cache",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionTargetKey:{type:String,default:void 0},dataEntityName:{type:String,default:void 0},dataPrimaryKey:{type:String,default:void 0},dataTargetKey:{type:String,default:void 0},cacheName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=At(),r=(0,n.computed)((()=>i.data[a.cacheName]?.[a.field.name]||[])),{filteredData:d}=qe(a,r),u=(0,n.computed)((()=>a.field.data.primaryKey)),s=(0,n.computed)((()=>a.field.data.targetKey)),c=(0,n.computed)((()=>d.value.map((e=>({value:e[u.value],text:e[s.value]}))))),m=(0,n.computed)((()=>{const e=a.junctionNavigationKey??a.field.junction.navigationKey,t=a.junctionEntityName??a.field.junction.name;return e||t})),p=(0,n.computed)({get(){const e=a.junctionTargetKey??a.field.junction.targetKey;return(0,o.entityData)(a.entity[m.value]).map((t=>t[e]))},set(e){const t=a.junctionTargetKey??a.field.junction.targetKey;l("change",(a=>{const n=a[m.value];for(let a=n.length-1;a>=0;a-=1)e.includes(n[a][t])||n.delete(a);for(const a of e){const e=n.some((e=>e[t]===a));e||n.add({[t]:a})}}))}});return(t,a)=>{const i=(0,n.resolveComponent)("llesca-field-combo");return(0,n.openBlock)(),(0,n.createBlock)(i,{multiple:"",label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,readonly:e.readonly??e.field.readonly,"allow-freeform":e.allowFreeform??e.field.allowFreeform,"auto-complete":e.autoComplete??e.field.autoComplete,"accent-insensitive":e.accentInsensitive??e.field.accentInsensitive,placeholder:e.placeholder??e.field.placeholder,"immediate-scroll":e.immediateScroll??e.field.immediateScroll,"max-selected-options":e.maxSelectedOptions??e.field.maxSelectedOptions,options:c.value,"create-field":e.validations?.createField,name:e.name??e.field.name,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),onFocus:a[1]||(a[1]=e=>l("focus",e)),onBlur:a[2]||(a[2]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","readonly","allow-freeform","auto-complete","accent-insensitive","placeholder","immediate-scroll","max-selected-options","options","create-field","name","required","disabled","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","modelValue"])}}},Et={__name:"grid-field-lookup-multi-cache",props:{invalid:{type:Boolean,default:void 0},readonly:{type:Boolean,default:void 0},multiple:{type:Boolean,default:void 0},allowFreeform:{type:Boolean,default:void 0},autoComplete:{type:Boolean,default:void 0},accentInsensitive:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},immediateScroll:{type:Boolean,default:void 0},maxSelectedOptions:{type:Number,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0},junctionEntityName:{type:String,default:void 0},junctionNavigationKey:{type:String,default:void 0},junctionOwnerKey:{type:String,default:void 0},junctionTargetKey:{type:String,default:void 0},dataEntityName:{type:String,default:void 0},dataPrimaryKey:{type:String,default:void 0},dataTargetKey:{type:String,default:void 0},cacheName:{type:String,default:void 0},filter:{type:Function,default:void 0},useFilter:{type:Function,default:void 0}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(_t),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}},Pt=(0,F.Z)(Et,[["__scopeId","data-v-754a3117"]]),St={...ht,formField:_t,gridField:Pt,loadCache:async e=>(await xe(e.data.name,{$select:[e.data.primaryKey,e.data.targetKey,...e.data.cache||[]],$orderby:e.data.targetKey})).value},Dt={__name:"form-field-number",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},prefix:{type:String,default:void 0},suffix:{type:String,default:void 0},multiline:{type:Boolean,default:void 0},icon:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},maxlength:{type:Number,default:void 0},unresizable:{type:Boolean,default:void 0},autoAdjustHeight:{type:Boolean,default:void 0},formatStyle:{type:String,default:void 0},useGrouping:{type:Boolean,default:void 0},minimumIntegerDigits:{type:Number,default:void 0},minimumFractionDigits:{type:Number,default:void 0},maximumFractionDigits:{type:Number,default:void 0},minimumSignificantDigits:{type:Number,default:void 0},maximumSignificantDigits:{type:Number,default:void 0},parse:{type:Function,default:void 0},stringify:{type:Function,default:void 0},stringifyFocus:{type:Function,default:void 0},align:{type:String,default:void 0},alignFocus:{type:String,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},min:{type:Number,default:void 0},max:{type:Number,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","click","focus","blur"],setup(e,{emit:t}){const a=e,l=t;function i(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(t,a)=>{const o=(0,n.resolveComponent)("llesca-field-number");return(0,n.openBlock)(),(0,n.createBlock)(o,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,placeholder:e.placeholder??e.field.placeholder,prefix:e.prefix??e.field.prefix,suffix:e.suffix??e.field.suffix,multiline:e.multiline??e.field.multiline,icon:e.icon??e.field.icon,readonly:e.readonly??e.field.readonly,maxlength:e.maxlength??e.field.maxlength,unresizable:e.unresizable??e.field.unresizable,"auto-adjust-height":e.autoAdjustHeight??e.field.autoAdjustHeight,"format-style":e.formatStyle??e.field.formatStyle,"use-grouping":e.useGrouping??e.field.useGrouping,"minimum-integer-digits":e.minimumIntegerDigits??e.field.minimumIntegerDigits,"minimum-fraction-digits":e.minimumFractionDigits??e.field.minimumFractionDigits,"maximum-fraction-digits":e.maximumFractionDigits??e.field.maximumFractionDigits,"minimum-significant-digits":e.minimumSignificantDigits??e.field.minimumSignificantDigits,"maximum-significant-digits":e.maximumSignificantDigits??e.field.maximumSignificantDigits,parse:e.parse??e.field.parse,stringify:e.stringify??e.field.stringify,"stringify-focus":e.stringifyFocus??e.field.stringifyFocus,align:e.align??e.field.align,"align-focus":e.alignFocus??e.field.alignFocus,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,min:e.min??e.field.min,max:e.max??e.field.max,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,name:e.name??e.field.name,"create-field":e.validations?.createField,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":i,onFocus:a[0]||(a[0]=e=>l("focus",e)),onBlur:a[1]||(a[1]=e=>l("blur",e))},null,8,["label","description","invalid","borderless","underlined","placeholder","prefix","suffix","multiline","icon","readonly","maxlength","unresizable","auto-adjust-height","format-style","use-grouping","minimum-integer-digits","minimum-fraction-digits","maximum-fraction-digits","minimum-significant-digits","maximum-significant-digits","parse","stringify","stringify-focus","align","align-focus","required","disabled","min","max","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","name","create-field","model-value"])}}},Ft={__name:"grid-field-number",props:{invalid:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},prefix:{type:String,default:void 0},suffix:{type:String,default:void 0},multiline:{type:Boolean,default:void 0},icon:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},maxlength:{type:Number,default:void 0},unresizable:{type:Boolean,default:void 0},autoAdjustHeight:{type:Boolean,default:void 0},formatStyle:{type:String,default:void 0},useGrouping:{type:Boolean,default:void 0},minimumIntegerDigits:{type:Number,default:void 0},minimumFractionDigits:{type:Number,default:void 0},maximumFractionDigits:{type:Number,default:void 0},minimumSignificantDigits:{type:Number,default:void 0},maximumSignificantDigits:{type:Number,default:void 0},parse:{type:Function,default:void 0},stringify:{type:Function,default:void 0},stringifyFocus:{type:Function,default:void 0},align:{type:String,default:void 0},alignFocus:{type:String,default:void 0},createField:{type:Function,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},min:{type:Number,default:void 0},max:{type:Number,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","click","focus","blur"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Dt),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onClick:t[1]||(t[1]=e=>l("click",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r)}),null,16,["borderless","onFocus","onBlur"]))}};function Vt(e,t){const a=t[e.name];if(null==a||isNaN(a))return"";const n={style:e.formatStyle,currency:"EUR",useGrouping:e.useGrouping,minimumIntegerDigits:e.minimumIntegerDigits,minimumFractionDigits:e.minimumFractionDigits,maximumFractionDigits:e.maximumFractionDigits};return e.minimumSignificantDigits>0&&e.minimumSignificantDigits<22&&(n.minimumSignificantDigits=e.minimumSignificantDigits),e.maximumSignificantDigits>0&&e.maximumSignificantDigits<22&&(n.maximumSignificantDigits=e.maximumSignificantDigits),("percent"===e.formatStyle?a/100:a).toLocaleString("ca-ES",n)}const Mt={__name:"form-field-string",props:{label:{type:String,default:void 0},description:{type:String,default:void 0},invalid:{type:Boolean,default:void 0},borderless:{type:Boolean,default:void 0},underlined:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},prefix:{type:String,default:void 0},suffix:{type:String,default:void 0},multiline:{type:Boolean,default:void 0},icon:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},unresizable:{type:Boolean,default:void 0},autoAdjustHeight:{type:Boolean,default:void 0},password:{type:Boolean,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},maxlength:{type:Number,default:void 0},pattern:{type:RegExp,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","click","focus","blur","keydown"],setup(e,{emit:t}){const a=e,l=t;function i(e){const t=a.name??a.field.name;l("change",(a=>{a[t]=e}))}return(t,a)=>{const o=(0,n.resolveComponent)("llesca-field-text");return(0,n.openBlock)(),(0,n.createBlock)(o,{label:e.label??e.field.label,description:e.description??e.field.description,invalid:e.invalid??e.field.invalid,borderless:e.borderless??e.field.borderless,underlined:e.underlined??e.field.underlined,placeholder:e.placeholder??e.field.placeholder,prefix:e.prefix??e.field.prefix,suffix:e.suffix??e.field.suffix,multiline:e.multiline??e.field.multiline,icon:e.icon??e.field.icon,readonly:e.readonly??e.field.readonly,unresizable:e.unresizable??e.field.unresizable,"auto-adjust-height":e.autoAdjustHeight??e.field.autoAdjustHeight,password:e.password??e.field.password,required:e.required??e.field.required,disabled:e.disabled??e.field.disabled,maxlength:e.maxlength??e.field.maxlength,pattern:e.pattern??e.field.pattern,rules:e.rules??e.field.rules,"auto-validate":e.autoValidate??e.field.autoValidate,"auto-validate-wait":e.autoValidateWait??e.field.autoValidateWait,"clear-value-on-disabled":e.clearValueOnDisabled??e.field.clearValueOnDisabled,name:e.name??e.field.name,"create-field":e.validations?.createField,"model-value":e.entity[e.name??e.field.name],"onUpdate:modelValue":i,onClick:a[0]||(a[0]=e=>l("click")),onFocus:a[1]||(a[1]=e=>l("focus",e)),onBlur:a[2]||(a[2]=e=>l("blur",e)),onKeydown:a[3]||(a[3]=e=>l("keydown",e))},null,8,["label","description","invalid","borderless","underlined","placeholder","prefix","suffix","multiline","icon","readonly","unresizable","auto-adjust-height","password","required","disabled","maxlength","pattern","rules","auto-validate","auto-validate-wait","clear-value-on-disabled","name","create-field","model-value"])}}},xt={__name:"grid-field-string",props:{invalid:{type:Boolean,default:void 0},placeholder:{type:String,default:void 0},prefix:{type:String,default:void 0},suffix:{type:String,default:void 0},multiline:{type:Boolean,default:void 0},icon:{type:String,default:void 0},readonly:{type:Boolean,default:void 0},unresizable:{type:Boolean,default:void 0},autoAdjustHeight:{type:Boolean,default:void 0},password:{type:Boolean,default:void 0},required:{type:Boolean,default:void 0},disabled:{type:Boolean,default:void 0},maxlength:{type:Number,default:void 0},pattern:{type:RegExp,default:void 0},rules:{type:Array,default:void 0},autoValidate:{type:String,default:void 0},autoValidateWait:{type:Number,default:void 0},clearValueOnDisabled:{type:Boolean,default:void 0},name:{type:String,default:void 0},entity:{type:Object,required:!0},field:{type:Object,default:void 0},validations:{type:Object,default:void 0}},emits:["change","click","focus","blur","keydown"],setup(e,{emit:t}){const a=e,l=t,{borderless:i,handleFocus:o,handleBlur:r}=Ce({$emit:l});return(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Mt),(0,n.mergeProps)(a,{class:"field",label:"",borderless:(0,n.unref)(i),description:null,underlined:!1,onChange:t[0]||(t[0]=e=>l("change",e)),onClick:t[1]||(t[1]=e=>l("click",e)),onFocus:(0,n.unref)(o),onBlur:(0,n.unref)(r),onKeydown:t[2]||(t[2]=e=>l("keydown",e))}),null,16,["borderless","onFocus","onBlur"]))}};function Rt(e,t){return t[e.name]??""}const wt={boolean:G,childCount:be,choice:_e,date:Fe,dictionary:ze,dictionaryMulti:Ze,fileMulti:ot,lookup:ft,hidden:ut,lookupAsync:vt,lookupCache:bt,lookupMulti:ht,lookupMultiCache:St,number:{detailsCell:ge,formField:Dt,gridField:(0,F.Z)(Ft,[["__scopeId","data-v-794c5b06"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"between"===e.operation?new ve([`${e.name} gt @${e.name}_gt`,`${e.name} lt @${e.name}_lt`],"and"):void 0,getFilterInterface:e=>"eq"===e.operation?{type:"number",name:e.name,label:e.label}:"between"===e.operation?[{type:"number",name:`${e.name}_gt`,label:`${e.label} Menor`},{type:"number",name:`${e.name}_lt`,label:`${e.label} Major`}]:void 0,getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):"number"==typeof e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:Vt,getTotalsTextValueFromEntity:Vt,getCsvValueFromEntity(e,t){const a=t[e.name];return null==a||isNaN(a)?"":a.toLocaleString("IN")},getAggregations:e=>[{name:"Average",getExpression:()=>`${e.name} with average as ${e.name}`},{name:"Sum",getExpression:()=>`${e.name} with sum as ${e.name}`},{name:"Minimum",getExpression:()=>`${e.name} with min as ${e.name}`}],readAggregationField(e){const t=e?.match(/^(\w+) with (\w+) as \1$/);if(t&&["average","sum","min"].includes(t[2]))return t[1]}},string:{detailsCell:ge,formField:Mt,gridField:(0,F.Z)(xt,[["__scopeId","data-v-1878bbd0"]]),getDetailsODataQuery:e=>({$select:e.name}),getOrderbySentence:e=>e.name,getFilterCondition:e=>"eq"===e.operation?`${e.name} eq @${e.name}`:"contains"===e.operation?`contains(${e.name}, @${e.name})`:"in"===e.operation?`${e.name} in @${e.name}`:void 0,getFilterInterface:e=>["eq","contains"].includes(e.operation)?{type:"text",name:e.name,label:e.label}:"in"===e.operation?{type:"csv",name:e.name,label:e.label}:void 0,getPropertyDefinition:(e,t)=>({keys:[e.name]}),setDetaultValueToEntity(e,t,{notOverwrite:a}={}){void 0===e.defaultValue||a&&null!=t[e.name]||("function"==typeof e.defaultValue?t[e.name]=e.defaultValue(t):"string"==typeof e.defaultValue&&(t[e.name]=e.defaultValue))},getEntityValue:(e,t)=>t[e.name],getTextValueFromEntity:Rt,getCsvValueFromEntity:Rt}},Bt={class:"CONFIG-editItem-layout"},Lt={__name:"form-config",setup(e){const t=O(),a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=[],o=(0,n.reactive)({}),d=Ba("CONFIG"),u=(0,n.computed)((()=>La(d,["NOM_CONSULTA","NIF","ADRECA","COLLEGIAT","POBLACIO","TIPUSIRPF","ID_PLANTILLA","ID_FORMAPAGAMENT","MARGE_TOP","MARGE_LEFT","FUNDA_TOP","FUNDA_LEFT","FUNDA_HISTORIA","FUNDA_INFERIOR","ENBLANC_TOP","ENBLANC_LEFT","ADULT_TOP","ADULT_LEFT","INFANTIL_TOP","INFANTIL_LEFT","CONTINUACIO_TOP","CONTINUACIO_LEFT","COMPROVANT_TOP","COMPROVANT_LEFT"])));async function s(){(await fetch(`${m}/CONFIG(1)`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:t.jwt},body:JSON.stringify(o)})).status<=400?(C().saveConfig(o),l.push(a.query.return),l.push("/"),setTimeout((function(){location.reload()}),500)):alert("Error de comuncació amb el servidor")}function c(){l.push(a.query.return)}return(0,n.onMounted)((async()=>{const e=await xe("CONFIG(1)");u.value.forEach((function(t){o[t.name]=e[t.name]}))})),(e,t)=>{const a=(0,n.resolveComponent)("fura-label");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"itemListEdit-container",subtitle:(0,n.unref)(d).label},{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(w),{"max-width":"1140px","has-save":"","has-close":"",onSave:s,onClose:c},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Bt,[(0,n.createVNode)(a,{style:{"grid-area":"MARGES","margin-top":"16px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Marges ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"SUPERIOR","margin-top":"16px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Superior(m.m.) ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"ESQUERRA","margin-top":"16px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Esquerra(m.m.) ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"HISTORIA","margin-top":"16px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Historia(m.m.) ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"INFERIOR","margin-top":"16px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Inferior(m.m.) ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"MARGE","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" General ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"FUNDA","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Funda ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"ENBLANC","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Funda en blanc ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"ADULT","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Fitxa adult ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"INFANTIL","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Fitxa infantil ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"CONTINUACIO","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Continuació ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"COMPROVANT","margin-top":"16px","font-weight":"600"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Comprovant ")])),_:1}),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(u.value,(e=>((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[e.type].formField),{key:e.name,entity:o,field:e,validations:i,style:(0,n.normalizeStyle)(`grid-area: ${e.name}`),"cache-name":"CONFIG",modelValue:o[e.name],"onUpdate:modelValue":t=>o[e.name]=t},null,8,["entity","field","style","modelValue","onUpdate:modelValue"])))),128))])])),_:1})])),_:1},8,["subtitle"])}}},kt=(0,F.Z)(Lt,[["__scopeId","data-v-3d9f2e85"]]),$t={name:"CONFIG",type:"listSplitted",label:"Configuració de la consulta",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_CONSULTA",label:"Nom consulta",type:"string",required:!0,maxlength:80},{name:"ADRECA",label:"Adreça",type:"string",required:!0,maxlength:80},{name:"POBLACIO",label:"Població",type:"string",required:!0,maxlength:80},{name:"NIF",label:"NIF",type:"string",required:!0,maxlength:80},{name:"COLLEGIAT",label:"Nº col·legiat",type:"string",maxlength:80,useGrouping:!0},{name:"TIPUSIRPF",label:"% IRPF",type:"number",decimals:2,align:"right",min:0,max:100},{name:"ID_FORMAPAGAMENT",label:"Pagament x defecte",type:"dictionary",entityName:"FORMAPAGAMENT",required:!0},{name:"ID_PLANTILLA",label:"Plantilla x defecte",type:"lookup",entity:{name:"PLANTILLA",primaryKey:"ID",targetKey:"NOM_PLANTILLA",cache:["CONCEPTE1","IMPORT1_1VISITA","IMPORT1_2VISITA","CONCEPTE2","IMPORT2_1VISITA","IMPORT2_2VISITA","CONCEPTE3","IMPORT3_1VISITA","IMPORT3_2VISITA","CONCEPTE4","IMPORT4_1VISITA","IMPORT4_2VISITA","CONCEPTE5","IMPORT5_1VISITA","IMPORT5_2VISITA"]},required:!0},{name:"MARGE_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"MARGE_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"ENBLANC_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"ENBLANC_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"FUNDA_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"FUNDA_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"FUNDA_HISTORIA",label:" ",type:"number",decimals:0,align:"right"},{name:"FUNDA_INFERIOR",label:" ",type:"number",decimals:0,align:"right"},{name:"ADULT_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"ADULT_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"INFANTIL_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"INFANTIL_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"CONTINUACIO_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"CONTINUACIO_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"COMPROVANT_LEFT",label:" ",type:"number",decimals:0,align:"right"},{name:"COMPROVANT_TOP",label:" ",type:"number",decimals:0,align:"right"},{name:"LOGO_300X125",label:"Logo 300x125px (Base 64)",type:"string",multiline:!0},{name:"COMPROVANT_300X80",label:"Compmprovant 300x80px (Base 64)",type:"string",multiline:!0},{name:"ADRECA_300X200",label:"Logo i Adreça 300x200px (Base 64)",type:"string",multiline:!0},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0}],form:{component:(0,n.markRaw)(kt),maxWidth:"1140px"},permissionDenied:e=>({create:!0,edit:!1,delete:!0,export:!0})};async function Ut(e,t,a,n){const l=Ba(e),i=La(l,a),o=a.map((function(e){const a=["string","choice"].includes(i.find((t=>t.name===e)).type)?"'":"";return e+" eq "+a+(t[e]||[]).toString().replace(/'/g,"''")+a})).join(" "+n+" "),{"@odata.count":r}=await xe(e,{$filter:"number"==typeof t.ID?`ID ne ${t.ID} and (${o})`:o,$count:!0,$top:0});if(r>0)return`Hi ha ${l.label} amb valors duplicats`}const qt={name:"ESPECIALITAT",type:"dictionary",label:"Especialitats",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_ESPECIALITAT",label:"Especialitat",type:"string",defaultField:!0,required:!0,maxlength:80}],rules:[async e=>await Ut("ESPECIALITAT",e,["NOM_ESPECIALITAT"],"and")]},Gt={name:"ESPECIALISTA",type:"listSplitted",label:"Especialistes",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_TRACTAMENT",label:"Tractament",type:"dictionary",entityName:"TRACTAMENT",required:!0},{name:"COGNOMS",label:"Cognoms",type:"string",required:!0,maxlength:80},{name:"NOM",label:"Nom",type:"string",required:!0,maxlength:80},{name:"TIPUS",label:"Tipus",type:"choice",options:["Doctor","Logopeda","Professor de cant","Altres"],required:!0,maxlength:24},{name:"COLLEGIAT",label:"Nº col·legiat",type:"number",decimals:0,useGrouping:!0,align:"right"},{name:"ADRECA",label:"Adreça",type:"string",maxlength:80},{name:"CODIPOSTAL",label:"C.Postal",type:"string",maxlength:5},{name:"POBLACIO",label:"Població",type:"string",maxlength:80},{name:"PAIS",label:"País",type:"string",maxlength:80},{name:"TELEFON1",label:"Telèfon",type:"string",maxlength:13},{name:"TELEFON2",label:"2º telèfon",type:"string",maxlength:13},{name:"FAX",label:"FAX",type:"string",maxlength:13},{name:"NIF",label:"NIF",type:"string",maxlength:16},{name:"EMAIL",label:"eMail",type:"string",maxlength:80},{name:"EMAIL2",label:"2ª eMail",type:"string",maxlength:80},{name:"ID_ESPECIALITAT",label:"Especialitat",type:"dictionary",entityName:"ESPECIALITAT"},{name:"SUBESPECIALITAT",label:"SubEspecialitat",type:"string",maxlength:80},{name:"OBSERVACIONS",label:"Observacions",type:"string",maxlength:8e3,multiline:!0},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0},{name:"COGNOMSINOM",label:"Cognoms i nom",type:"string",readonly:!0},{name:"PACIENT_ESPECIALISTA/odata.count",type:"childCount",navigationKey:"PACIENT_ESPECIALISTA",loadAlwaysInView:!0},{name:"PACIENT_OPERATPER/odata.count",type:"childCount",navigationKey:"PACIENT_OPERATPER",loadAlwaysInView:!0}],filter:[{name:"TIPUS",operation:"in"},{name:"ID_ESPECIALITAT",operation:"in"},{name:"COGNOMS",label:"Cognoms especialista contienen",operation:"contains"},{name:"POBLACIO",label:"Població especialista contiene",operation:"contains"}],form:{component:"auto",class:"ESPECIALISTA-editItem-layout",maxWidth:"1110px",fields:e=>["ID_TRACTAMENT","NOM","COGNOMS","TIPUS","COLLEGIAT","ADRECA","TELEFON1","TELEFON2","FAX","NIF","CODIPOSTAL","POBLACIO","EMAIL","ID_ESPECIALITAT","PAIS","EMAIL2","SUBESPECIALITAT","OBSERVACIONS"],rules:[async e=>await Ut("ESPECIALISTA",e,["NOM","COGNOMS"],"and")]}},Kt={name:"MUTUA",type:"listSplitted",label:"Mútues",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM",label:"Nom Mútua",type:"string",required:!0,maxlength:120},{name:"NOM2",label:"2ª línia nom",type:"string",maxlength:120},{name:"ADRECA",label:"Adreça",type:"string",required:!0,maxlength:120},{name:"CODIPOSTAL",label:"C.Postal",type:"string",required:!0,maxlength:5},{name:"POBLACIO",label:"Població",type:"string",required:!0,maxlength:120},{name:"NIF",label:"Nif",type:"string",required:!0,maxlength:16},{name:"TELEFON1",label:"1r telèfon",type:"string",maxlength:12},{name:"TELEFON2",label:"2º telèfon",type:"string",maxlength:12},{name:"FAX",label:"Fax",type:"string",maxlength:16},{name:"CONTACTE",label:"Persona de contacte",type:"string",maxlength:80},{name:"EMAIL",label:"eMail",type:"string",maxlength:120},{name:"CONCEPTE1",label:"Concepte 1a línia",type:"string",required:!0,maxlength:120},{name:"IMPORT1_1VISITA",label:"Import 1a visita",type:"number",decimals:2,align:"right",useGrouping:!0,required:!0,maxlength:10,clearValueOnDisabled:!0},{name:"IMPORT1_2VISITA",label:"Import 2a visita",type:"number",decimals:2,align:"right",useGrouping:!0,required:!0,maxlength:10,clearValueOnDisabled:!0},{name:"CONCEPTE2",label:"Concepte 2a línia",type:"string",maxlength:120},{name:"IMPORT2_1VISITA",label:"Import 1a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"IMPORT2_2VISITA",label:"Import 2a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"CONCEPTE3",label:"Concepte 3a línia",type:"string",maxlength:120},{name:"IMPORT3_1VISITA",label:"Import 1a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"IMPORT3_2VISITA",label:"Import 2a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"CONCEPTE4",label:"Concepte 4a línia",type:"string",maxlength:120},{name:"IMPORT4_1VISITA",label:"Import 1a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"IMPORT4_2VISITA",label:"Import 2a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"CONCEPTE5",label:"Concepte 5a línia",type:"string",maxlength:120},{name:"IMPORT5_1VISITA",label:"Import 1a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"IMPORT5_2VISITA",label:"Import 2a visita",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10,clearValueOnDisabled:!0},{name:"CATALA",label:"Factura en català",type:"boolean"},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0},{name:"PACIENT/odata.count",type:"childCount",navigationKey:"PACIENT",loadAlwaysInView:!0},{name:"VISITA/odata.count",type:"childCount",navigationKey:"VISITA",loadAlwaysInView:!0}],form:{component:"auto",class:"MUTUA-editItem-layout",maxWidth:"900px",fields:e=>["NOM","TELEFON1","NIF","NOM2","TELEFON2","FAX","ADRECA","CODIPOSTAL","POBLACIO","CATALA","CONTACTE","EMAIL","CONCEPTE1","IMPORT1_1VISITA","IMPORT1_2VISITA","CONCEPTE2",{name:"IMPORT2_1VISITA",disabled:!e.CONCEPTE2},{name:"IMPORT2_2VISITA",disabled:!e.CONCEPTE2},"CONCEPTE3",{name:"IMPORT3_1VISITA",disabled:!e.CONCEPTE3},{name:"IMPORT3_2VISITA",disabled:!e.CONCEPTE3},"CONCEPTE4",{name:"IMPORT4_1VISITA",disabled:!e.CONCEPTE4},{name:"IMPORT4_2VISITA",disabled:!e.CONCEPTE4},"CONCEPTE5",{name:"IMPORT5_1VISITA",disabled:!e.CONCEPTE5},{name:"IMPORT5_2VISITA",disabled:!e.CONCEPTE5}],rules:[async e=>await Ut("MUTUA",e,["NOM"],"or")]},permissionDenied:e=>({create:!1,edit:!1,delete:e&&e["PACIENT@odata.count"]+e["VISITA@odata.count"]!==0,export:!1})},jt={class:"PACIENT-editItem-layout",component:"auto",maxWidth:"900px",async onItemLoaded(e){if(!e.ID){const t=await xe("PACIENT",{$select:"HISTORIA",$orderby:"HISTORIA desc",$top:1});e.HISTORIA=t.value[0].HISTORIA+1}},fields:e=>["ID_TRACTAMENT","NOM","COGNOMS","TELEFON1","ID_DOCTOR","ADRECA","PROFESSIO","CODIPOSTAL","POBLACIO","TELEFON2","NIF","PAIS","EMAIL","EMAIL2","ID_MUTUA","SEXE","NAIXEMENT","TIPUSENVIAT","ENVIATPER","ID_PLANTILLA","HISTORIA","ID_FORMAPAGAMENT","MICROCIRUGIA","COMPORTVOCAL","MDVP","CURS","CATALA"],children:[{listName:"PACIENT_PATOLOGIA",foreingKey:"ID_PACIENT",detailFields:["ID_PATOLOGIA"]},{listName:"PACIENT_ESPECIALISTA",foreingKey:"ID_PACIENT",detailFields:["ID_ESPECIALISTA"]},{listName:"PACIENT_OPERATPER",foreingKey:"ID_PACIENT",detailFields:["ID_ESPECIALISTA"]},{listName:"VISITA",foreingKey:"ID_PACIENT",detailFields:["ID_DOCTOR","ID_MUTUA","ID_INICI","ID_FINAL"]}],tabs:[{name:"OBSERVACIONS",title:"Observacions",component:"auto",fields:e=>[{name:"OBSERVACIONS",label:" "}]},{name:"PACIENT_PATOLOGIA",title:"Patologías",type:"child",listName:"PACIENT_PATOLOGIA",fields:["DATA","ID_PATOLOGIA","OBSERVACIONS"],form:{component:"auto",maxWidth:"900px",fields:e=>["DATA","ID_PATOLOGIA","OBSERVACIONS"]}},{name:"PACIENT_ESPECIALISTA",title:"Especialistas",type:"child",listName:"PACIENT_ESPECIALISTA",fields:["DATA","TIPUS","ID_ESPECIALISTA","OBSERVACIONS"],form:{component:"auto",maxWidth:"1080px",fields:e=>["DATA","TIPUS","ID_ESPECIALISTA","OBSERVACIONS"]}},{name:"PACIENT_OPERATPER",title:"Operaciones",type:"child",listName:"PACIENT_OPERATPER",fields:["DATA","ID_ESPECIALISTA","OBSERVACIONS"],form:{component:"auto",maxWidth:"1080px",fields:e=>["DATA","ID_ESPECIALISTA","OBSERVACIONS"]}},{name:"VISITA",title:"Visites",type:"child",listName:"VISITA",fields:["DATA","ID_DOCTOR","ID_MUTUA","ID_INICI","ID_FINAL"]}],rules:[async e=>await Ut("PACIENT",e,["NOM","COGNOMS"],"and")]};var zt=s(676);async function Ht(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOM,COGNOMS,COGNOMSINOM,NIF,HISTORIA,ADRECA,CODIPOSTAL,POBLACIO,TELEFON1,TELEFON2,EMAIL,NAIXEMENT",$expand:"VISITA($select=DATA;$top=1;$orderby=DATA desc)"}),n=a.VISITA.length>0?new Date(a.VISITA[0].DATA).toLocaleDateString():"",l=(a.HISTORIA||0).toLocaleString("ca-ES"),i=a.NAIXEMENT?new Date(a.NAIXEMENT).toLocaleDateString():"",o=new zt.jsPDF("landscape","mm",[230,195]);o.getFontList(),o.setFontSize(10),o.setFont("helvetica");const r=(t.MARGE_LEFT||0)+(t.FUNDA_LEFT||0),d=(t.MARGE_TOP||0)+(t.FUNDA_TOP||0);Wt(o,r+t.FUNDA_HISTORIA,d+55,l),Wt(o,r+40,d+78,a.Title||""),Wt(o,r+40,d+89,a.NOM||""),Wt(o,r+30,d+100,a.NIF||""),Wt(o,r+60,d+111,i),Wt(o,r+40,d+t.FUNDA_INFERIOR+128,a.ADRECA||""),Wt(o,r+40,d+t.FUNDA_INFERIOR+139,a.EMAIL||""),Wt(o,r+40,d+t.FUNDA_INFERIOR+150,a.TELEFON1||""),Wt(o,r+64,d+t.FUNDA_INFERIOR+150,a.TELEFON2||""),Wt(o,r+40,d+t.FUNDA_INFERIOR+161,(a.CODIPOSTAL||"")+" "+(a.POBLACIO||"")),Wt(o,r+40,d+t.FUNDA_INFERIOR+172,n),o.save(`${a.COGNOMSINOM}.pdf`)}function Wt(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n)}async function Yt(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOMICOGNOMS,COGNOMSINOM,NIF,HISTORIA,ADRECA,CODIPOSTAL,POBLACIO,TELEFON1,TELEFON2,EMAIL,NAIXEMENT,PROFESSIO",$expand:"VISITA($select=DATA;$top=1;$orderby=DATA desc),PACIENT_ESPECIALISTA($select=TIPUS;$expand=ESPECIALISTA($select=COGNOMSINOM);$orderby=ESPECIALISTA/COGNOMSINOM),PACIENT_OPERATPER($select=ID;$expand=ESPECIALISTA($select=COGNOMSINOM);$orderby=ESPECIALISTA/COGNOMSINOM)"}),n=a.VISITA.length>0?new Date(a.VISITA[0].DATA).toLocaleDateString():"",l=a.NAIXEMENT?new Date(a.NAIXEMENT).toLocaleDateString():"",i=a.PACIENT_ESPECIALISTA.filter((e=>"Doctor"===e.TIPUS)).map((e=>e.ESPECIALISTA.COGNOMSINOM)).join(", "),o=a.PACIENT_ESPECIALISTA.filter((e=>"Logopeda"===e.TIPUS)).map((e=>e.ESPECIALISTA.COGNOMSINOM)).join(", "),r=(a.HISTORIA||0).toLocaleString("ca-ES"),d=new zt.jsPDF("portrait","mm","a4");d.getFontList(),d.setFontSize(10),d.setFont("helvetica");const u=(t.MARGE_LEFT||0)+(t.ADULT_LEFT||0),s=(t.MARGE_TOP||0)+(t.ADULT_TOP||0);console.log(s,u,t.MARGE_LEFT,t.ADULT_LEFT),Zt(d,u,s,a.NOMICOGNOMS||""),Zt(d,u+120,s,r),Zt(d,u,s+8,function(e){if(e){const t=new Date,a=new Date(e);return t.getMonth()===a.getMonth()+1?(t.getFullYear()-a.getFullYear()).toString()+" años y un mes":t.getMonth()>a.getMonth()?(t.getFullYear()-a.getFullYear()).toString()+" años y "+(t.getMonth()-a.getMonth()).toString()+" meses":t.getMonth()==a.getMonth()?(t.getFullYear()-a.getFullYear()).toString()+" años":(t.getFullYear()-a.getFullYear()-1).toString()+" años y "+(a.getMonth()-t.getMonth()).toString()+" meses"}return""}(a.NAIXEMENT||"")),Zt(d,u,s+16-1,a.PROFESSIO||""),Zt(d,u,s+24-2,o),Zt(d,u-5,s+32-2,i),Zt(d,u+20,s+40-4,n),a.NAIXEMENT&&Zt(d,u+30,s+48-5,l),d.save(`${a.COGNOMSINOM}.pdf`)}function Zt(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n)}async function Xt(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOMICOGNOMS,COGNOMSINOM,NIF,HISTORIA,ADRECA,CODIPOSTAL,POBLACIO,TELEFON1,TELEFON2,EMAIL,NAIXEMENT,PROFESSIO",$expand:"VISITA($select=DATA;$top=1;$orderby=DATA desc),PACIENT_ESPECIALISTA($select=TIPUS;$expand=ESPECIALISTA($select=COGNOMSINOM);$orderby=ESPECIALISTA/COGNOMSINOM),PACIENT_OPERATPER($select=ID;$expand=ESPECIALISTA($select=COGNOMSINOM);$orderby=ESPECIALISTA/COGNOMSINOM)"}),n=a.VISITA.length>0?new Date(a.VISITA[0].DATA).toLocaleDateString():"",l=a.NAIXEMENT?new Date(a.NAIXEMENT).toLocaleDateString():"",i=a.PACIENT_ESPECIALISTA.filter((e=>"Doctor"===e.TIPUS)).map((e=>e.ESPECIALISTA.COGNOMSINOM)).join(", "),o=a.PACIENT_ESPECIALISTA.filter((e=>"Logopeda"===e.TIPUS)).map((e=>e.ESPECIALISTA.COGNOMSINOM)).join(", "),r=(a.HISTORIA||0).toLocaleString("ca-ES"),d=new zt.jsPDF("portrait","mm","a4");d.getFontList(),d.setFontSize(10),d.setFont("helvetica");const u=(t.MARGE_LEFT||0)+(t.INFANTIL_LEFT||0),s=(t.MARGE_TOP||0)+(t.INFANTIL_TOP||0);Jt(d,u,s,a.NOMICOGNOMS),Jt(d,u+120,s,r),a.NAIXEMENT&&(Jt(d,u,s+8,function(e){if(e){const t=new Date,a=new Date(e);return t.getMonth()===a.getMonth()+1?(t.getFullYear()-a.getFullYear()).toString()+" años y un mes":t.getMonth()>a.getMonth()?(t.getFullYear()-a.getFullYear()).toString()+" años y "+(t.getMonth()-a.getMonth()).toString()+" meses":t.getMonth()===a.getMonth()?(t.getFullYear()-a.getFullYear()).toString()+" años":(t.getFullYear()-a.getFullYear()-1).toString()+" años y "+(a.getMonth()-t.getMonth()).toString()+" meses"}return""}(a.NAIXEMENT)),Jt(d,u+30,s+16,l)),Jt(d,u+2,s+24-1,o),Jt(d,u-3,s+32-2,i),Jt(d,u+20,s+40-3,n,"normal"),d.save(`${a.COGNOMSINOM}.pdf`)}function Jt(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n||"")}async function Qt(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOMICOGNOMS,COGNOMSINOM"}),n=new zt.jsPDF("portrait","mm","a4");n.getFontList(),n.setFontSize(10),n.setFont("helvetica"),function(e,t,a,n,l){e.text(t,a,n||"")}(n,(t.MARGE_LEFT||0)+(t.CONTINUACIO_LEFT||0),(t.MARGE_TOP||0)+(t.CONTINUACIO_TOP||0),a.NOMICOGNOMS),n.save(`${a.COGNOMSINOM}.pdf`)}async function ea(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOM,COGNOMS,EMAIL,COGNOMSINOM,NIF,HISTORIA,ADRECA,CODIPOSTAL,POBLACIO,TELEFON1,TELEFON2,EMAIL,NAIXEMENT,PROFESSIO",$expand:"VISITA($select=DATA;$top=1;$orderby=DATA desc)"}),n=a.VISITA.length>0?new Date(a.VISITA[0].DATA).toLocaleDateString():"",l=a.NAIXEMENT?new Date(a.NAIXEMENT).toLocaleDateString():"",i=(a.HISTORIA||0).toLocaleString("ca-ES"),o=new zt.jsPDF("landscape","mm","a4");o.getFontList(),o.setFontSize(10),o.setFont("helvetica");const r=(t.MARGE_LEFT||0)+(t.ENBLANCO_LEFT||0),d=(t.MARGE_TOP||0)+(t.ENBLANC_TOP||0);o.addImage(t.LOGO_ADRECA,"JPEG",190,115,70,35),o.setDrawColor(r+234,d+111,74),o.setTextColor(r+234,d+111,74),ta(o,r+34,d+25,"Buena mtra. de _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+203,d+25,"Pág. _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+34,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+203,d+34,"PROT. _ _ _ _ _ _ _  _ _ _ _ _"),ta(o,r+203,d+42,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+225,d+50,"Nº  _ _  _ _ _ _"),ta(o,r+34,d+60,"COGNOMS"),ta(o,r+62,d+60,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+71,"NOM"),ta(o,r+62,d+71,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+81,"DNI"),ta(o,r+62,d+81,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+94,"DATA NAIXEMENT _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+115,"DIRECCION"),ta(o,r+62,d+115,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+125,"E-MAIL"),ta(o,r+62,d+125,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+137,"TEL"),ta(o,r+62,d+137,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+148,"CIUDAD"),ta(o,r+62,d+148,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),ta(o,r+34,d+158,"DATA"),ta(o,r+62,d+158,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),o.rect(r+30,d+18,r+235,d+160),o.setTextColor(0,0,0),ta(o,r+235,d+50,i,"normal"),ta(o,r+62,d+60,a.COGNOMS),ta(o,r+62,d+71,a.NOM),ta(o,r+62,d+81,a.NIF),ta(o,r+76,d+94,l),ta(o,r+62,d+115,a.ADRECA),ta(o,r+62,d+125,a.EMAIL),ta(o,r+62,d+137,a.TELEFON1),ta(o,r+88,d+137,a.TELEFON2),ta(o,r+62,d+148,a.CODIPOSTAL+" "+a.POBLACIO),ta(o,r+62,d+158,n),o.save(`${a.COGNOMSINOM}.pdf`)}function ta(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n||"")}async function aa(e){const t=C(),a=await xe(`PACIENT(${e})`,{$select:"NOM,COGNOMS,EMAIL,COGNOMSINOM,NIF,HISTORIA,ADRECA,CODIPOSTAL,POBLACIO,TELEFON1,TELEFON2,EMAIL,NAIXEMENT,PROFESSIO",$expand:"VISITA($select=DATA;$top=1;$orderby=DATA desc)"}),n=a.VISITA.length>0?new Date(a.VISITA[0].DATA).toLocaleDateString():"",l=a.NAIXEMENT?new Date(a.NAIXEMENT).toLocaleDateString():"",i=(a.HISTORIA||0).toLocaleString("ca-ES"),o=new zt.jsPDF("landscape","mm","a4");o.getFontList(),o.setFontSize(10),o.setFont("helvetica");const r=(t.MARGE_LEFT||0)+(t.ENBLANCO_LEFT||0),d=(t.MARGE_TOP||0)+(t.ENBLANC_TOP||0);o.setDrawColor(r+234,d+111,74),o.setTextColor(r+234,d+111,74),na(o,r+34,d+25,"Buena mtra. de _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+203,d+25,"Pág. _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+34,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+203,d+34,"PROT. _ _ _ _ _ _ _  _ _ _ _ _"),na(o,r+203,d+42,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+225,d+50,"Nº  _ _  _ _ _ _"),na(o,r+34,d+60,"COGNOMS"),na(o,r+62,d+60,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+71,"NOM"),na(o,r+62,d+71,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+81,"DNI"),na(o,r+62,d+81,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+94,"DATA NAIXEMENT _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+115,"DIRECCION"),na(o,r+62,d+115,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+125,"DE-MAIL"),na(o,r+62,d+125,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+137,"TEL"),na(o,r+62,d+137,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+148,"CIUDAD"),na(o,r+62,d+148,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),na(o,r+34,d+158,"DATA"),na(o,r+62,d+158,"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _"),o.setTextColor(0,0,0),na(o,r+235,d+50,i,"normal"),na(o,r+62,d+60,a.COGNOMS),na(o,r+62,d+71,a.NOM),na(o,r+62,d+81,a.NIF),na(o,r+76,d+94,l),na(o,r+62,d+115,a.ADRECA),na(o,r+62,d+125,a.EMAIL),na(o,r+62,d+137,a.TELEFON1),na(o,r+88,d+137,a.TELEFON2),na(o,r+62,d+148,a.CODIPOSTAL+" "+a.POBLACIO),na(o,r+62,d+158,n),o.save(`${a.COGNOMSINOM}.pdf`)}function na(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n||"")}const la={name:"PACIENT",type:"listSplitted",label:"Pacients",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_TRACTAMENT",label:"Tractament",type:"dictionary",entityName:"TRACTAMENT",required:!0},{name:"NOM",label:"Nom",type:"string",required:!0,maxlength:80},{name:"COGNOMS",label:"Cognoms",type:"string",required:!0,maxlength:80},{name:"HISTORIA",label:"Nº Història",type:"number",decimals:0,align:"right",useGrouping:!0},{name:"NIF",label:"NIF",type:"string",maxlength:16},{name:"ADRECA",label:"Adreça",type:"string",required:!0,maxlength:80},{name:"CODIPOSTAL",label:"C.Postal",type:"string",required:!0,maxlength:5},{name:"POBLACIO",label:"Població",type:"string",required:!0,maxlength:80},{name:"PAIS",label:"País",type:"string",required:!0,maxlength:80},{name:"TELEFON1",label:"Telèfon",type:"string",required:!0,maxlength:12},{name:"TELEFON2",label:"2º telèfon",type:"string",maxlength:12},{name:"PROFESSIO",label:"Professió",type:"string",maxlength:80},{name:"EMAIL",label:"eMail",type:"string",maxlength:80},{name:"EMAIL2",label:"2ª eMail",type:"string",maxlength:80},{name:"ID_DOCTOR",label:"Doctor",type:"dictionary",entityName:"DOCTOR",required:!0},{name:"ID_MUTUA",label:"Mútua",type:"lookupCache",entity:{name:"MUTUA",primaryKey:"ID",targetKey:"NOM"}},{name:"NAIXEMENT",label:"D.Naixement",type:"date"},{name:"SEXE",label:"Sexe",type:"choice",options:["Home","Dona"],default:"Dona"},{name:"TIPUSENVIAT",label:"Enviat per",type:"choice",options:["Doctor","Logopeda","Professor de cant","Altres"],maxlength:24},{name:"ENVIATPER",label:"Enviat per",type:"string",maxlength:80},{name:"ID_FORMAPAGAMENT",label:"F. pagament",type:"dictionary",entityName:"FORMAPAGAMENT"},{name:"ID_PLANTILLA",label:"Plantilla visita",required:!0,type:"lookupCache",entity:{name:"PLANTILLA",primaryKey:"ID",targetKey:"NOM_PLANTILLA"}},{name:"OBSERVACIONS",label:"Observacions",type:"string",maxlength:8e3,multiline:!0},{name:"COGNOMSINOM",label:"Cognoms i nom",type:"string",readonly:!0},{name:"MDVP",label:"MDVP",type:"boolean"},{name:"CURS",label:"Curs",type:"boolean"},{name:"COMPORTVOCAL",label:"Comp. Vocal",type:"boolean"},{name:"MICROCIRUGIA",label:"Microcirugia",type:"boolean"},{name:"CATALA",label:"Factura en català",type:"boolean"},{name:"PATOLOGIA1",label:"Patologíes",type:"lookupMultiCache",readonly:!0,junction:{name:"PACIENT_PATOLOGIA",primaryKey:"ID",ownerKey:"ID_PACIENT",targetKey:"ID_PATOLOGIA"},data:{name:"PATOLOGIA",primaryKey:"ID",targetKey:"NOM_PATOLOGIA"}},{name:"PATOLOGIA2",label:"Patologíes",type:"lookupMultiCache",readonly:!0,junction:{name:"PACIENT_PATOLOGIA",navigationKey:"PACIENT_PATOLOGIA1",primaryKey:"ID",ownerKey:"ID_PACIENT",targetKey:"ID_PATOLOGIA"},data:{name:"PATOLOGIA",primaryKey:"ID",targetKey:"NOM_PATOLOGIA"}},{name:"PATOLOGIA3",label:"Patologíes",type:"lookupMultiCache",readonly:!0,junction:{name:"PACIENT_PATOLOGIA",navigationKey:"PACIENT_PATOLOGIA2",primaryKey:"ID",ownerKey:"ID_PACIENT",targetKey:"ID_PATOLOGIA"},data:{name:"PATOLOGIA",primaryKey:"ID",targetKey:"NOM_PATOLOGIA"}},{name:"ESPECIALISTA",label:"Especialista",type:"lookupMultiCache",readonly:!0,junction:{name:"PACIENT_ESPECIALISTA",primaryKey:"ID",ownerKey:"ID_PACIENT",targetKey:"ID_ESPECIALISTA"},data:{name:"ESPECIALISTA",primaryKey:"ID",targetKey:"COGNOMSINOM"}},{name:"OPERATPER",label:"Operat per",type:"lookupMultiCache",readonly:!0,junction:{name:"PACIENT_OPERATPER",primaryKey:"ID",ownerKey:"ID_PACIENT",targetKey:"ID_ESPECIALISTA"},data:{name:"ESPECIALISTA",primaryKey:"ID",targetKey:"COGNOMSINOM"}},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0},{name:"VISITA/odata.count",type:"childCount",navigationKey:"VISITA",loadAlwaysInView:!0}],filter:[{name:"HISTORIA",operation:"eq"},{name:"COGNOMS",label:"Cognoms contém",operation:"contains"},{name:"NOM",label:"Nom conté",operation:"contains"},{name:"TELEFON1",label:"2n Telèfon conté",operation:"contains"},{name:"TELEFON2",label:"Telèfon conté",operation:"contains"},{name:"ID_DOCTOR",operation:"in"},{name:"ID_MUTUA",operation:"in"},{name:"PATOLOGIA1",label:"Patología es igual a",operation:"in"},{name:"PATOLOGIA2",label:"i a la vegada Patología és igual a",operation:"in"},{name:"PATOLOGIA3",label:"i a la vegada Patología és igual a",operation:"in"},{name:"ESPECIALISTA",operation:"in"},{name:"OPERATPER",operation:"in"}],form:jt,menuUpdater:function(e,t){const a=t?[{text:"Fitxes",icon:"PDF",children:[{text:"Fixta adult",icon:"Contact",action:()=>Yt(t.ID)},{text:"Infantil",icon:"Balloons",action:()=>Xt(t.ID)},{text:"Continuació",icon:"FollowUser",action:()=>Qt(t.ID)},{text:"Funda",icon:"Mail",action:()=>Ht(t.ID)},{text:"Funda en blanc",icon:"MailAttached",action:()=>ea(t.ID)},{text:"Funda en blanc sense logo",icon:"MailAttached",action:()=>aa(t.ID)}]}]:[];return e.concat(a)},permissionDenied:e=>({create:!1,edit:!1,delete:e&&0!==e["VISITA@odata.count"],export:!1})},ia={name:"PACIENT_ESPECIALISTA",label:"Especialistes del pacient",type:"listSplitted",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_PACIENT",label:"Pacient",type:"string",defaultField:!0,required:!0,maxlength:40},{name:"TIPUS",label:"Tipus",type:"choice",options:["Doctor","Logopeda","Professor de cant","Altres"],required:!0,maxlength:24},{name:"ID_ESPECIALISTA",label:"Especialista",type:"lookupCache",entity:{name:"ESPECIALISTA",primaryKey:"ID",targetKey:"COGNOMSINOM",cache:["TIPUS"]},useFilter:e=>t=>t.TIPUS===e.TIPUS,required:!0},{name:"DATA",label:"Data",type:"date",max:new Date,defaultValue:new Date,required:!0},{name:"OBSERVACIONS",label:"Observacions",type:"string",maxlength:80}]},oa={name:"PACIENT_OPERATPER",label:"Operacions del pacient",type:"listSplitted",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_PACIENT",label:"Pacient",type:"string",defaultField:!0,required:!0,maxlength:40},{name:"ID_ESPECIALISTA",label:"Operat per",type:"lookupCache",entity:{name:"ESPECIALISTA",primaryKey:"ID",targetKey:"COGNOMSINOM"},useFilter:e=>e=>"Doctor"===e.TIPUS,required:!0},{name:"DATA",label:"Data",type:"date",max:new Date,defaultValue:new Date,required:!0},{name:"OBSERVACIONS",label:"Observacions",type:"string",maxlength:80}]},ra={name:"PACIENT_PATOLOGIA",label:"Patologíes del pacient",type:"listSplitted",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_PACIENT",label:"Pacient",type:"string",defaultField:!0,required:!0,maxlength:40},{name:"ID_PATOLOGIA",label:"Patología",type:"dictionary",entityName:"PATOLOGIA",required:!0},{name:"DATA",label:"Data",type:"date",max:new Date,defaultValue:new Date,required:!0},{name:"OBSERVACIONS",label:"Observacions",type:"string",maxlength:80}]},da={name:"PATOLOGIA",type:"dictionary",label:"Patologíes",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_PATOLOGIA",label:"Patología",type:"string",defaultField:!0,required:!0,maxlength:80}],rules:[async e=>await Ut("PATOLOGIA",e,["NOM_PATOLOGIA"],"and")]},ua={name:"PLANTILLA",type:"listSplitted",label:"Plantilles",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_PLANTILLA",label:"Plantilla",type:"string",defaultField:!0,required:!0,maxlength:16},{name:"CONCEPTE1",type:"string",required:!0,maxlength:80},{name:"IMPORT1_1VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,required:!0,maxlength:10},{name:"IMPORT1_2VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,required:!0,maxlength:10},{name:"CONCEPTE2",type:"string",maxlength:80},{name:"IMPORT2_1VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"IMPORT2_2VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"CONCEPTE3",type:"string",maxlength:80},{name:"IMPORT3_1VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"IMPORT3_2VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"CONCEPTE4",type:"string",maxlength:80},{name:"IMPORT4_1VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"IMPORT4_2VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"CONCEPTE5",type:"string",maxlength:80},{name:"IMPORT5_1VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10},{name:"IMPORT5_2VISITA",type:"number",decimals:2,align:"right",useGrouping:!0,maxlength:10}],form:{component:"auto",class:"PLANTILLA-editItem-layout",maxWidth:"1140px",fields:e=>["NOM_PLANTILLA",{name:"CONCEPTE1",label:"Concepte 1a línia"},{name:"IMPORT1_1VISITA",label:"Imp. 1a visita"},{name:"IMPORT1_2VISITA",label:"Imp. 2a visita"},{name:"CONCEPTE2",label:"Concepte 2a línia"},{name:"IMPORT2_1VISITA",label:"Imp. 1a visita"},{name:"IMPORT2_2VISITA",label:"Imp. 2a visita"},{name:"CONCEPTE3",label:"Concepte 3a línia"},{name:"IMPORT3_1VISITA",label:"Imp. 1a visita"},{name:"IMPORT3_2VISITA",label:"Imp. 2a visita"},{name:"CONCEPTE4",label:"Concepte 4a línia"},{name:"IMPORT4_1VISITA",label:"Imp. 1a visita"},{name:"IMPORT4_2VISITA",label:"Imp. 2a visita"},{name:"CONCEPTE5",label:"Concepte 5a línia"},{name:"IMPORT5_1VISITA",label:"Imp. 1a visita"},{name:"IMPORT5_2VISITA",label:"Imp. 2a visita"}],rules:[async e=>await Ut("PLANTILLA",e,["NOM_PLANTILLA"],"or")]}},sa={name:"TAG",type:"dictionary",label:"Etiquetes visites",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_TAG",label:"Etiqueta",type:"string",defaultField:!0,required:!0,maxlength:24}],rules:[async e=>await Ut("TAG",e,["NOM_TAG"],"and")]},ca={name:"USUARI",type:"listSplitted",label:"Usuaris del sistema",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"LOGIN_USUARI",label:"Usuari",type:"string",required:!0,maxlength:16},{name:"COGNOMSINOM_USUARI",label:"Cognoms i nom",type:"string",required:!0,maxlength:80},{name:"EMAIL_USUARI",label:"Email usuario",type:"string",pattern:/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/,required:!0,maxlength:80},{name:"ROL",label:"Rol",type:"choice",options:["Administrador","Usuari"],dataType:"string",required:!0,defaultValue:"Usuari"},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0}],form:{component:"auto",class:"USUARI-editItem-layout",maxWidth:"900px",fields:e=>["LOGIN_USUARI","COGNOMSINOM_USUARI","ROL","EMAIL_USUARI"],rules:[async e=>await Ut("USUARI",e,["LOGIN_USUARI","COGNOMSINOM_USUARI","EMAIL_USUARI"],"or")]}},ma=[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"DATA",label:"Data",type:"date",required:!0,detailsColumn:{align:"center"},loadAlwaysInView:!0},{name:"ID_INICI",label:"Inici",type:"dictionary",entityName:"HORARI",defaultvalue:1,detailsColumn:{align:"center"},required:!0},{name:"ID_FINAL",label:"Final",type:"dictionary",entityName:"HORARI",defaultvalue:2,navigationKey:"HORARI1",detailsColumn:{align:"center"},required:!0},{name:"ID_PACIENT",label:"Pacient",type:"lookupAsync",loadAlwaysInView:!0,accentInsensitive:!0,autoComplete:!0,immediateScroll:!0,allowFreeform:!0,clearValueOnDisabled:!0,entity:{name:"PACIENT",primaryKey:"ID",targetKey:"COGNOMSINOM"},getOptions:async function(e){return(await xe("PACIENT",{$select:"ID,COGNOMSINOM",$filter:`startswith(COGNOMSINOM,'${e}')`,$orderby:"COGNOMSINOM",$top:16})).value.map((e=>({value:e.ID,text:e.COGNOMSINOM})))}},{name:"MOBIL",label:"Tel. mòbil pacient",type:"string",maxlength:12,clearValueOnDisabled:!0},{name:"NOTA",label:"Nota",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"ID_DOCTOR",label:"Doctor",type:"dictionary",entityName:"DOCTOR"},{name:"TIPUSVISITA",label:"T. visita",type:"choice",options:["1","2"],detailsColumn:{align:"center"},clearValueOnDisabled:!0,defaultValue:"2"},{name:"ID_MUTUA",label:"Mútua",type:"lookupCache",loadAlwaysInView:!0,clearValueOnDisabled:!0,entity:{name:"MUTUA",primaryKey:"ID",targetKey:"NOM",cache:["NOM","NOM2","ADRECA","CODIPOSTAL","POBLACIO","NIF","CATALA","CONCEPTE1","IMPORT1_1VISITA","IMPORT1_2VISITA","CONCEPTE2","IMPORT2_1VISITA","IMPORT2_2VISITA","CONCEPTE3","IMPORT3_1VISITA","IMPORT3_2VISITA","CONCEPTE4","IMPORT4_1VISITA","IMPORT4_2VISITA","CONCEPTE5","IMPORT5_1VISITA","IMPORT5_2VISITA"]}},{name:"FACTURA",label:"Nº Factura",type:"number",decimals:2,align:"right",useGrouping:!0,disabled:!0,detailsColumn:{align:"right"},loadAlwaysInView:!0},{name:"DATA_FACTURA",label:"D.Factura",type:"date",detailsColumn:{align:"center"},disabled:!0},{name:"ID_PLANTILLA",label:"Plantilla",type:"lookupCache",clearValueOnDisabled:!0,entity:{name:"PLANTILLA",primaryKey:"ID",targetKey:"NOM_PLANTILLA",cache:["CONCEPTE1","IMPORT1_1VISITA","IMPORT1_2VISITA","CONCEPTE2","IMPORT2_1VISITA","IMPORT2_2VISITA","CONCEPTE3","IMPORT3_1VISITA","IMPORT3_2VISITA","CONCEPTE4","IMPORT4_1VISITA","IMPORT4_2VISITA","CONCEPTE5","IMPORT5_1VISITA","IMPORT5_2VISITA"]}},{name:"CONCEPTE1",label:"Concepte",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"IMPORT1",label:"Import 1",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"CONCEPTE2",label:"Concepte",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"IMPORT2",label:"Import 2",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"CONCEPTE3",label:"Concepte",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"IMPORT3",label:"Import 3",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"CONCEPTE4",label:"Concepte",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"IMPORT4",label:"Import 4",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"CONCEPTE5",label:"Concepte",type:"string",maxlength:120,clearValueOnDisabled:!0},{name:"IMPORT5",label:"Import 5",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"IMPORT",label:"Total",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,loadAlwaysInView:!0,detailsColumn:{align:"right"},disabled:!0},{name:"TIPUSIRPF",label:"% IRPF",type:"number",decimals:2,align:"right",detailsColumn:{align:"right"},disabled:!0,useGrouping:!0,clearValueOnDisabled:!0},{name:"IRPF",label:"IRPF",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},disabled:!0},{name:"NET",label:"Net",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,detailsColumn:{align:"right"},disabled:!0},{name:"ID_FORMAPAGAMENT1",label:"Forma pag.",type:"dictionary",entityName:"FORMAPAGAMENT",clearValueOnDisabled:!0},{name:"PAGAT1",label:"Pagat",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,loadAlwaysInView:!0,detailsColumn:{align:"right"},clearValueOnDisabled:!0},{name:"ID_FORMAPAGAMENT2",label:"Forma pag. 2",type:"dictionary",entityName:"FORMAPAGAMENT",clearValueOnDisabled:!0},{name:"PAGAT2",label:"Pagat",type:"number",decimals:2,minimumFractionDigits:2,maximumFractionDigits:2,align:"right",useGrouping:!0,loadAlwaysInView:!0,detailsColumn:{align:"right"},disabled:!0},{name:"TIPUSENVIAT",label:"Enviat per",type:"choice",options:["Doctor","Logopeda","Professor de cant","Altres"],maxlength:24,clearValueOnDisabled:!0},{name:"ENVIATPER",label:"Enviat per",type:"string",maxlength:80,clearValueOnDisabled:!0},{name:"KDS",label:"KDS",type:"string",maxlength:80,clearValueOnDisabled:!0},{name:"ARXIU",label:"Arxiu",type:"string",maxlength:80,clearValueOnDisabled:!0},{name:"KAYSTROBE",label:"Kay Strobe",type:"number",align:"right",decimals:0,useGrouping:!0,clearValueOnDisabled:!0},{name:"OBSERVACIONS",label:"Observacions",type:"string",multiline:!0,maxlength:8e3},{name:"NOFACTURAR",label:"No facturar",type:"boolean",clearValueOnDisabled:!0,loadAlwaysInView:!0},{name:"AMBFACTURA",label:"Amb Nº de factura",type:"boolean",clearValueOnDisabled:!0,readonly:"true"},{name:"AUTORITZACIO",label:"Autortzació",type:"string",clearValueOnDisabled:!0,maxlength:16},{name:"NOM_FACTURA",label:"Nom factura",type:"string",clearValueOnDisabled:!0,maxlength:80},{name:"NOM2_FACTURA",label:"2on nom factura",clearValueOnDisabled:!0,type:"string",maxlength:80},{name:"ADRECA_FACTURA",label:"Adreça factura",clearValueOnDisabled:!0,type:"string",maxlength:80},{name:"CODIPOSTAL_FACTURA",label:"C.P.",clearValueOnDisabled:!0,type:"string",maxlength:5},{name:"POBLACIO_FACTURA",label:"Població factura",clearValueOnDisabled:!0,type:"string",maxlength:80},{name:"NIF_FACTURA",label:"NIF",type:"string",clearValueOnDisabled:!0,maxlength:16},{name:"ID_PERIODE",label:"Període de visites",type:"dictionary",entityName:"PERIODE",readonly:!0},{name:"CATALA",label:"Factura en català",type:"boolean",clearValueOnDisabled:!0},{name:"ID_TAG",label:"Etiquetes visita",type:"dictionaryMulti",entityName:"TAG",junction:{name:"VISITA_TAG",primaryKey:"ID",ownerKey:"ID_VISITA",dictionaryKey:"ID_TAG"}},{name:"CREATED",label:"Data creació",type:"date",readonly:!0},{name:"CREATEDBY",label:"Usuari creació",type:"string",maxlength:64,readonly:!0},{name:"MODIFIED",label:"Últ. modificació",type:"date",readonly:!0},{name:"MODIFIEDBY",label:"Usuari modificació",type:"string",maxlength:64,readonly:!0}],pa={key:0,class:"cela fura-center"},fa={key:1,class:"cela fura-center"},ya={__name:"form-dispo",props:{entity:{type:Object,required:!0},validations:{type:Object,required:!0}},setup(e){const t=e,a=[{key:"HORA",title:"Hora/Dia"},{key:"D01",title:"01"},{key:"D02",title:"02"},{key:"D03",title:"03"},{key:"D04",title:"04"},{key:"D05",title:"05"},{key:"D06",title:"06"},{key:"D07",title:"07"},{key:"D08",title:"08"},{key:"D09",title:"09"},{key:"D10",title:"10"},{key:"D11",title:"11"},{key:"D12",title:"12"},{key:"D13",title:"13"},{key:"D14",title:"14"},{key:"D15",title:"15"},{key:"D16",title:"16"},{key:"D17",title:"17"},{key:"D18",title:"18"},{key:"D19",title:"19"},{key:"D20",title:"20"},{key:"D21",title:"21"},{key:"D22",title:"22"},{key:"D23",title:"23"},{key:"D24",title:"24"},{key:"D25",title:"25"},{key:"D26",title:"26"},{key:"D27",title:"27"},{key:"D28",title:"28"},{key:"D29",title:"29"},{key:"D30",title:"30"},{key:"D31",title:"31"}];return(e,l)=>{const i=(0,n.resolveComponent)("fura-icon"),o=(0,n.resolveComponent)("fura-details-list");return(0,n.openBlock)(),(0,n.createBlock)(o,{compact:"",columns:a,data:t.entity.disponibilitat||[],"auto-layout":"auto"},{default:(0,n.withCtx)((e=>["HORA"!==e.column.key?((0,n.openBlock)(),(0,n.createElementBlock)("div",pa,[(0,n.createVNode)(i,{name:e.content?"CheckboxComposite":"Checkbox",style:(0,n.normalizeStyle)(e.content?"color:red; font-weight: bold;":"color:white;")},null,8,["name","style"])])):((0,n.openBlock)(),(0,n.createElementBlock)("div",fa,(0,n.toDisplayString)(e.content),1))])),_:1},8,["data"])}}};async function va(e){if(e.ID_PACIENT){const t=C(),a=await xe(`PACIENT(${e.ID_PACIENT})`,{$select:"ID,NOM,COGNOMS,ADRECA,CODIPOSTAL,POBLACIO,NIF,ID_DOCTOR,ID_MUTUA,ID_FORMAPAGAMENT,ID_PLANTILLA,TELEFON1,CATALA",$expand:"VISITA($count=true;$top=0),MUTUA($select=NOM,NOM2,ADRECA,CODIPOSTAL,POBLACIO,NIF,CATALA)"}),{CONCEPTE1:n,IMPORT1:l,CONCEPTE2:i,IMPORT2:o,CONCEPTE3:r,IMPORT3:d,CONCEPTE4:u,IMPORT4:s,CONCEPTE5:c,IMPORT5:m,TIPUSIRPF:p}=Oa(a.ID_MUTUA,a["VISITA@odata.count"]?"2":"1",a.ID_PLANTILLA),{SUMA:f,IRPF:y,NET:v}=Ca(l,o,d,0,m,p);return e=>{e.TIPUSVISITA=a["VISITA@odata.count"]?"2":"1",e.ID_DOCTOR=a.ID_DOCTOR,e.ID_MUTUA=a.ID_MUTUA,e.ID_PLANTILLA=a.ID_MUTUA?null:a.ID_PLANTILLA,e.MOBIL=a.TELEFON1,e.NOM_FACTURA=a.ID_MUTUA?a.MUTUA.NOM:a.NOM+" "+a.COGNOMS,e.NOM2_FACTURA=a.ID_MUTUA?a.MUTUA.NOM2:null,e.ADRECA_FACTURA=a.ID_MUTUA?a.MUTUA.ADRECA:a.ADRECA,e.CODIPOSTAL_FACTURA=a.ID_MUTUA?a.MUTUA.CODIPOSTAL:a.CODIPOSTAL,e.POBLACIO_FACTURA=a.ID_MUTUA?a.MUTUA.POBLACIO:a.POBLACIO,e.NIF_FACTURA=a.ID_MUTUA?a.MUTUA.NIF:a.NIF,e.ID_FORMAPAGAMENT1=a.ID_FORMAPAGAMENT||t.ID_FORMAPAGAMENT,e.CATALA=a.ID_MUTUA?a.MUTUA.CATALA:a.CATALA,e.CONCEPTE1=n,e.IMPORT1=l,e.CONCEPTE2=i,e.IMPORT2=o,e.CONCEPTE3=r,e.IMPORT3=d,e.CONCEPTE4=u,e.IMPORT4=s,e.CONCEPTE5=c,e.IMPORT5=m,e.IMPORT=f,e.TIPUSIRPF=p,e.IRPF=y,e.NET=v,e.ID_FORMAPAGAMENT1=a.ID_MUTUA?2:a.ID_FORMAPAGAMENT||t.ID_FORMAPAGAMENT,e.PAGAT1=v,e.ID_FORMAPAGAMENT2=null,e.PAGAT2=0,e.pacientActual=a}}return e=>{e.ID_PACIENT=null,e.TIPUSVISITA=null,e.ID_PLANTILLA=null,e.IMPORT1=null,e.IMPORT2=null,e.IMPORT3=null,e.IMPORT4=null,e.IMPORT5=null,e.IMPORT=null,e.TIPUSIRPF=null,e.IRPF=null,e.NET=null,e.pacientActual=null,e.NOM_FACTURA=null,e.NOM2_FACTURA=null,e.ADRECA_FACTURA=null,e.CODIPOSTAL_FACTURA=null,e.POBLACIO_FACTURA=null,e.NIF_FACTURA=null,e.PAGAT1=null,e.ID_FORMAPAGAMENT1=null,e.ID_FORMAPAGAMENT2=null,e.PAGAT1=null}}async function Aa(e){if(e.DATA&&e.ID_DOCTOR){const t=(await xe("VISITA",{$select:"ID_INICI, ID_FINAL",$filter:`ID ne ${e.ID||0} and DATA eq ${e.DATA.toISOString()} and ID_DOCTOR eq ${e.ID_DOCTOR}`})).value.flatMap((e=>Array.from({length:e.ID_FINAL-e.ID_INICI},((t,a)=>a+e.ID_INICI)))),a=Ue(),n=await ba(e);return e=>{e.ID_INICI=null,e.ID_FINAL=null,e.hores=a.data.HORARI.map((e=>({value:e.ID,text:e.HORA,disabled:t.includes(e.ID)}))),e.disponibilitat=n}}}function Ia(e){const{CONCEPTE1:t,IMPORT1:a,CONCEPTE2:n,IMPORT2:l,CONCEPTE3:i,IMPORT3:o,CONCEPTE4:r,IMPORT4:d,CONCEPTE5:u,IMPORT5:s,TIPUSIRPF:c}=Oa(e.ID_MUTUA,e.TIPUSVISITA,e.ID_MUTUA?null:e.pacientActual?.ID_PLANTILLA),{SUMA:m,IRPF:p,NET:f}=Ca(a,l,o,0,s,c),y=C(),v=At().data.VISITA.ID_MUTUA.filter((t=>t.ID===e.ID_MUTUA))[0];return e=>{e.ID_PLANTILLA=e.ID_MUTUA?null:e.pacientActual?.ID_PLANTILLA||1,e.NOM_FACTURA=e.ID_MUTUA?v.NOM:e.pacientActual?e.pacientActual.NOM+" "+e.pacientActual.COGNOMS:null,e.NOM2_FACTURA=e.ID_MUTUA?v.NOM2||"":null,e.ADRECA_FACTURA=e.ID_MUTUA?v.ADRECA:e.pacientActual?.ADRECA,e.CODIPOSTAL_FACTURA=e.ID_MUTUA?v.CODIPOSTAL:e.pacientActual?.CODIPOSTAL,e.POBLACIO_FACTURA=e.ID_MUTUA?v.POBLACIO:e.pacientActual?.POBLACIO,e.NIF_FACTURA=e.ID_MUTUA?v.NIF:e.pacientActual?.NIF,e.CATALA=e.ID_MUTUA?v.CATALA:e.pacientActual?.CATALA,e.CONCEPTE1=t,e.IMPORT1=a,e.CONCEPTE2=n,e.IMPORT2=l,e.CONCEPTE3=i,e.IMPORT3=o,e.CONCEPTE4=r,e.IMPORT4=d,e.CONCEPTE5=u,e.IMPORT5=s,e.IMPORT=m,e.TIPUSIRPF=c,e.IRPF=p,e.NET=f,e.ID_FORMAPAGAMENT1=e.ID_MUTUA?2:e.pacientActual?.ID_FORMAPAGAMENT||y.ID_FORMAPAGAMENT,e.PAGAT1=m,e.ID_FORMAPAGAMENT2=null,e.PAGAT2=null}}function ga(e){const t=e.ID_MUTUA||!e.ID_PACIENT?null:e.ID_PLANTILLA||e.pacientActual?.ID_PLANTILLA,{CONCEPTE1:a,IMPORT1:n,CONCEPTE2:l,IMPORT2:i,CONCEPTE3:o,IMPORT3:r,CONCEPTE4:d,IMPORT4:u,CONCEPTE5:s,IMPORT5:c,TIPUSIRPF:m}=Oa(e.ID_MUTUA,e.TIPUSVISITA,t),{SUMA:p,IRPF:f,NET:y}=Ca(n,i,r,0,c,m);return e=>{e.ID_PLANTILLA=e.ID_MUTUA?null:e.ID_PLANTILLA,e.CONCEPTE1=a,e.IMPORT1=n,e.CONCEPTE2=l,e.IMPORT2=i,e.CONCEPTE3=o,e.IMPORT3=r,e.CONCEPTE4=d,e.IMPORT4=u,e.CONCEPTE5=s,e.IMPORT5=c,e.IMPORT=p,e.TIPUSIRPF=m,e.IRPF=f,e.NET=y,e.PAGAT1=y,e.ID_FORMAPAGAMENT2=null,e.PAGAT2=null}}function Ta(e){const{SUMA:t,IRPF:a,NET:n}=Ca(e.IMPORT1,e.IMPORT2,e.IMPORT3,e.IMPORT4,e.IMPORT5,e.TIPUSIRPF);return e=>{e.IMPORT=t,e.IRPF=a,e.NET=n,e.ID_FORMAPAGAMENT2=null,e.PAGAT1=n,e.ID_FORMAPAGAMENT2=null,e.PAGAT2=0}}async function ba(e){if(e.DATA&&e.ID_DOCTOR){const t=O(),a=await fetch(`${m}/Stored/st_DISPONIBILITAT`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/plain",Authorization:t.jwt},body:JSON.stringify({id_doctor:e.ID_DOCTOR,any:e.DATA.getFullYear(),mes:e.DATA.getMonth()+1})});if(200===a.status){const e=await a.json();return JSON.parse(e)}return Ve().alert({title:"Càlcul disponibilitat",message:"Error inesperat."}),[]}return[]}function Oa(e,t,a){const n=At();if(e){const a=C(),l=n.data.VISITA.ID_MUTUA.filter((t=>t.ID===e))[0];return{CONCEPTE1:l.CONCEPTE1,IMPORT1:"2"===t?l.IMPORT1_2VISITA:l.IMPORT1_1VISITA,CONCEPTE2:l.CONCEPTE2,IMPORT2:"2"===t?l.IMPORT2_2VISITA:l.IMPORT2_1VISITA,CONCEPTE3:l.CONCEPTE3,IMPORT3:"2"===t?l.IMPORT3_2VISITA:l.IMPORT3_1VISITA,CONCEPTE4:l.CONCEPTE4,IMPORT4:"2"===t?l.IMPORT4_2VISITA:l.IMPORT4_1VISITA,CONCEPTE5:l.CONCEPTE5,IMPORT5:"2"===t?l.IMPORT5_2VISITA:l.IMPORT5_1VISITA,TIPUSIRPF:a.TIPUSIRPF}}if(a){const e=n.data.VISITA.ID_PLANTILLA.filter((e=>e.ID===(a||1)))[0];return{CONCEPTE1:e.CONCEPTE1,IMPORT1:"2"===t?e.IMPORT1_2VISITA:e.IMPORT1_1VISITA,CONCEPTE2:e.CONCEPTE2,IMPORT2:"2"===t?e.IMPORT2_2VISITA:e.IMPORT2_1VISITA,CONCEPTE3:e.CONCEPTE3,IMPORT3:"2"===t?e.IMPORT3_2VISITA:e.IMPORT3_1VISITA,CONCEPTE4:e.CONCEPTE4,IMPORT4:"2"===t?e.IMPORT4_2VISITA:e.IMPORT4_1VISITA,CONCEPTE5:e.CONCEPTE5,IMPORT5:"2"===t?e.IMPORT5_2VISITA:e.IMPORT5_1VISITA,TIPUSIRPF:null}}return{CONCEPTE1:null,IMPORT1:null,CONCEPTE2:null,IMPORT2:null,CONCEPTE3:null,IMPORT3:null,CONCEPTE4:null,IMPORT4:null,CONCEPTE5:null,IMPORT5:null,TIPUSIRPF:null}}function Ca(e,t,a,n,l,i){const o=(e||0)+(t||0)+(a||0)+(l||0)+(l||0),r=Math.round(o*(i||0)/100,2);return{SUMA:o,IRPF:r,NET:o-r}}const Na={class:"VISITA-editItem-layout",component:"auto",maxWidth:"1050px",async onItemLoaded(e){const t=Ue();if(await t.loadDictionary("HORARI"),e.hores=t.data.HORARI.map((e=>({value:e.ID,text:e.HORA}))),e.pacientActual=null,e.disponibilitat=[],e.ID){if(e.ID_PACIENT){const t=await xe(`PACIENT(${e.ID_PACIENT})`,{$select:"ID,NOM,COGNOMS,ADRECA,CODIPOSTAL,POBLACIO,NIF,ID_DOCTOR,ID_MUTUA,ID_FORMAPAGAMENT,ID_PLANTILLA,TELEFON1,CATALA",$expand:"VISITA($count=true;$top=0),MUTUA($select=NOM,NOM2,ADRECA,CODIPOSTAL,POBLACIO,NIF,CATALA)"});e.pacientActual=t}const t=(await xe("VISITA",{$select:"ID_INICI, ID_FINAL",$filter:`ID ne ${e.ID||0} and DATA eq ${e.DATA.toISOString()} and ID_DOCTOR eq ${e.ID_DOCTOR}`})).value.flatMap((e=>Array.from({length:e.ID_FINAL-e.ID_INICI},((t,a)=>a+e.ID_INICI)))),a=Ue();e.hores=a.data.HORARI.map((e=>({value:e.ID,text:e.HORA,disabled:t.includes(e.ID)}))),e.disponibilitat=await ba(e)}},fields:e=>[{name:"ID_PACIENT",onChange:va,required:!e.NOTA},{name:"NOTA",required:!e.ID_PACIENT,disabled:!!e.ID_PACIENT||!!e.FACTURA},{name:"DATA",onChange:Aa,defaultValue:new Date},{name:"ID_DOCTOR",onChange:Aa,required:!!e.ID_PACIENTE},{name:"ID_INICI",type:"choice",dataType:"number",options:e.hores||[],disabled:!e.DATA||!e.ID_DOCTOR,onChange:e=>e=>{e.ID_FINAL=e.ID_INICI+1}},{name:"ID_FINAL",disabled:!e.DATA||!e.ID_DOCTOR||!e.ID_INICI,useFilter:e=>t=>t.ID>(e.ID_INICI||0)},{name:"ID_MUTUA",disabled:!e.ID_PACIENT,onChange:Ia},{name:"AUTORITZACIO",disabled:!e.ID_MUTUA},{name:"TIPUSVISITA",disabled:!e.ID_PACIENT,onChange:ga},{name:"ID_PLANTILLA",disabled:!e.ID_PACIENT||!!e.ID_MUTUA,required:!e.NOTA&&!e.ID_MUTUA,onChange:ga},"ID_TAG",{name:"CONCEPTE1",disabled:!e.ID_PACIENT,required:!e.NOTA},{name:"IMPORT1",disabled:!e.ID_PACIENT||!!e.NOTA,required:!!e.ID_PACIENT&&!e.NOTA,onChange:Ta},{name:"CONCEPTE2",disabled:!e.ID_PACIENT||!!e.NOTA},{name:"IMPORT2",disabled:!e.CONCEPTE2,onChange:Ta},{name:"CONCEPTE3",disabled:!e.ID_PACIENT||!!e.NOTA},{name:"IMPORT3",disabled:!e.CONCEPTE3,onChange:Ta},{name:"CONCEPTE4",disabled:!e.ID_PACIENT||!!e.NOTA},{name:"IMPORT4",disabled:!e.CONCEPTE4,onChange:Ta},{name:"CONCEPTE5",disabled:!e.ID_PACIENT||!!e.NOTA},{name:"IMPORT5",disabled:!e.CONCEPTE5,onChange:Ta},"IMPORT",{name:"TIPUSENVIAT",disabled:!e.ID_PACIENT},{name:"ENVIATPER",disabled:!e.ID_PACIENT},{name:"MOBIL",disabled:!e.ID_PACIENT},"TIPUSIRPF","IRPF","NET",{name:"KAYSTROBE",disabled:!e.ID_PACIENT},{name:"KDS",disabled:!e.ID_PACIENT},{name:"ARXIU",disabled:!e.ID_PACIENT},{name:"ID_FORMAPAGAMENT1",required:!!e.ID_PACIENT,disabled:!e.ID_PACIENT},{name:"PAGAT1",disabled:!e.ID_PACIENT||!e.IMPORT,onChange:e=>e=>{e.PAGAT2=e.NET-e.PAGAT1}},{name:"NOFACTURAR",disabled:!e.ID_PACIENT||!!e.FACTURA},{name:"CATALA",label:"Factura i justificant en català",disabled:!e.ID_PACIENT},{name:"ID_FORMAPAGAMENT2",disabled:!e.ID_PACIENT||!e.IMPORT||0===!e.IMPORT||e.NET===e.PAGAT1,required:e.NET!==e.PAGAT1},"PAGAT2"],detailFields:["ID_PACIENT"],rules:[function(e){return e.ID_PACIENT.value||e.NOTA?"":"Cal informar un pacient o una nota informativa"}],tabs:[{name:"DISPONBILITAT",title:"Ocupació",component:(0,n.markRaw)(ya)},{name:"OBSERVACIONS",title:"Observacions",component:"auto",fields:e=>[{name:"OBSERVACIONS",label:" "}]},{name:"DADESFACTURA",title:"Dades factura",component:"auto",class:"VISITA-FACTURA-editItem-layout",fields:e=>[{name:"NOM_FACTURA",disabled:!e.ID_PACIENT,required:!e.NOTA},{name:"NOM2_FACTURA",disabled:!e.ID_PACIENT},"FACTURA","DATA_FACTURA",{name:"ADRECA_FACTURA",disabled:!e.ID_PACIENT,required:!e.NOTA},{name:"CODIPOSTAL_FACTURA",disabled:!e.ID_PACIENT,required:!e.NOTA},{name:"POBLACIO_FACTURA",disabled:!e.ID_PACIENT,required:!e.NOTA},{name:"NIF_FACTURA",disabled:!e.ID_PACIENT,required:!e.NOTA}]}]};function ha(){const e=(0,n.ref)(window.opener),t=(0,n.ref)(!!window.opener),a=[];function l(e){for(const t of a)t(e.detail)}return(0,n.onScopeDispose)((()=>{window.removeEventListener("message",l)})),(0,n.readonly)({isChildWindow:t,parentWindow:e,close:function(){window.close()},onMessage:function(e){a.push(e)},sendMessage:function(t){const a=new CustomEvent("message",{detail:t});e.value?.dispatchEvent(a)}})}function _a(e,t,a,n,l){l&&e.setFont("helvetica",l),e.text(t,a,n||"")}async function Ea(e){const t=C(),a=await xe(`VISITA(${e})`,{$expand:"FORMAPAGAMENT($select=NOM_FORMAPAGAMENT),FORMAPAGAMENT1($select=NOM_FORMAPAGAMENT),MUTUA($select=NOM,NOM2),PACIENT($select=NOMICOGNOMS,NIF),DOCTOR($select=NOM_COMPLET,COLEGIAT)"}),n=new zt.jsPDF;let l=0;n.setFontSize(12),Pa(n,56,104,a.NOM_FACTURA,"bold"),Pa(n,62,104,a.NOM2_FACTURA,"bold"),Pa(n,68,104,a.ADRECA_FACTURA,"normal"),Pa(n,74,104,a.CODIPOSTAL_FACTURA,"normal"),Pa(n,74,120,a.POBLACIO_FACTURA,"normal"),Pa(n,80,104,"Nif: "+(a.NIF_FACTURA||"")),Pa(n,84,20,"Factura:","normal"),Sa(n,84,60,a.FACTURA,0,"bold"),Pa(n,90,20,a.CATALA?"Data:":"Fecha:","normal"),Sa(n,90,60,new Date(a.DATA_FACTURA).toLocaleDateString(),0,"bold"),Pa(n,100,20,a.CATALA?"Concepte":"Concepto","bold"),Sa(n,100,189,a.CATALA?"Import":"Importe",0,"bold"),n.line(20,101,190,101),n.setFontSize(10),Pa(n,110,20,a.CONCEPTE1,"normal"),Pa(n,116,20,a.CONCEPTE2,"normal"),Pa(n,122,20,a.CONCEPTE3,"normal"),Pa(n,128,20,a.CONCEPTE4,"normal"),Pa(n,134,20,a.CONCEPTE5,"normal"),0===a.IMPORT2&&0===a.IMPORT3&&0===a.IMPORT4&&0===a.IMPORT5||(Sa(n,110,189,a.IMPORT1,2,"bold"),a.IMPORT2&&Sa(n,116,189,a.IMPORT2,2,"bold"),a.IMPORT3&&Sa(n,122,189,a.IMPORT3,2,"bold"),a.IMPORT4&&Sa(n,128,189,a.IMPORT3,2,"bold"),a.IMPORT5&&Sa(n,134,189,a.IMPORT3,2,"bold")),a.MUTUA&&(Pa(n,144,20,a.CATALA?"Pacient:":"Paciente:","bold"),Pa(n,144,60,a.PACIENT.NIF?`${a.PACIENT.NOMICOGNOMS} (DNI: ${a.PACIENT.NIF})`:a.PACIENT.NOMICOGNOMS,"normal"),a.ENVIATPER&&(Pa(n,150,20,a.CATALA?"Prova sol·licitada per: ":"Prueba solicitada por: ","bold"),Pa(n,150,60,a.ENVIATPER,"normal"),l=6),a.AUTORITZACIO&&(Pa(n,156+l,20,a.CATALA?"Autorització:":"Autorización:","bold"),Pa(n,156+l,60,a.AUTORITZACIO,"normal"))),n.setFontSize(12),n.line(20,230,190,230),Pa(n,236,20,t.NOM_CONSULTA,"bold"),Pa(n,242,20,t.ADRECA,"normal"),Pa(n,248,20,t.POBLACIO),Pa(n,254,20,`NIF: ${t.NIF}`),a.IRPF?(Pa(n,236,140,"Base","normal"),Sa(n,236,189,a.IMPORT,2,"bold"),Pa(n,242,140,"IRPF "+a.TIPUSIRPF.toLocaleString("IT",{minimumFractionDigits:0})+" %","normal"),Sa(n,242,189,a.IRPF,2,"bold"),Pa(n,248,140,a.CATALA?"Net":"Neto","normal"),Sa(n,248,189,a.NET,2,"bold")):(Pa(n,236,140,a.CATALA?"Import":"Importe","normal"),Sa(n,236,189,a.IMPORT,2,"bold")),Pa(n,260,20,"Otorrinolaringologia","bold"),n.setFontSize(8),Pa(n,266,20,a.CATALA?"Col·legiat No: 21.744":"Colegiado Nº: 21.744","normal"),2!==a.ID_FORMAPAGAMENT1&&(a.ID_FORMAPAGAMENT2?(Pa(n,256,140,a.FORMAPAGAMENT.NOM_FORMAPAGAMENT,0),Sa(n,256,189,a.PAGAT1,2,"normal"),Pa(n,260,140,a.FORMAPAGAMENT1.NOM_FORMAPAGAMENT,"normal"),Sa(n,260,189,a.PAGAT2,2,"normal")):(Pa(n,256,140,a.CATALA?"Forma de pagament:":"Forma de pago:","normal"),Sa(n,256,189,a.FORMAPAGAMENT.NOM_FORMAPAGAMENT,0,"normal"))),n.save(`Factura.${a.FACTURA.toString()}.pdf`)}function Pa(e,t,a,n,l){n&&(l&&e.setFont("helvetica",l),e.text(a,t,n))}function Sa(e,t,a,n,l,i){if(n){i&&e.setFont("helvetica",i);const o=n.toLocaleString("IT",{minimumFractionDigits:l||0,maximumFractionDigits:l||0});e.text(o,a,t,{align:"right"})}}var Da=s(525),Fa=s(732);async function Va(e,t){const a=[];for(const n of t){const t=[];for(const a of e)if("function"==typeof wt[a.type]?.getCsvValueFromEntity){const e=Ma(await wt[a.type].getCsvValueFromEntity(a,n));t.push(e)}else t.push("");a.push(t)}return a}function Ma(e){const t=String(e??"");return t.includes('"')||t.includes(";")||t.includes("\n")?`"${t.replaceAll('"','""')}"`:t}async function xa(e){const t=O(),a=await fetch(`${m}/Stored/st_RESUMPAGAMENTS`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/plain",Authorization:t.jwt},body:JSON.stringify({opciomes:e})});if(200===a.status){const e=await a.json();!async function(e,t,a){const n=[t.map((e=>Ma(e.label))),...await Va(t,a)].map((e=>e.join(";"))).join("\n"),l=document.createElement("a");l.setAttribute("href",encodeURI("data:text/csv;charset=utf-8,\ufeff"+n)),l.setAttribute("download","resumFormesPagament.csv"),l.style.display="none",document.body.appendChild(l),l.click(),l.remove()}(0,[{name:"NOM_FORMAPAGAMENT",label:"F. Pagament",type:"string"},{name:"FACTURA",label:"Factura",type:"number"},{name:"DATA_FACTURA",label:"D. factura",type:"string"},{name:"PAGAMENT",label:"Pagament",type:"number"},{name:"COGNOMSINOM",label:"Nom pacient",type:"string"},{name:"NOM_DOCTOR",label:"Nom doctor",type:"string"},{name:"NOM_MUTUA",label:"Mútua",type:"string"},{name:"NET",label:"Total Fact.",type:"number",decimals:2},{name:"PAGAT",label:"Pagat",type:"number",decimals:2},{name:"ETIQUETES",label:"Etiquetes",type:"string"}],JSON.parse(e||[]))}else Ve().alert({title:"Resum per formes de pagament",message:"Error inesperat."})}const Ra={name:"VISITA",type:"listSplitted",label:"Visites",fields:ma,filter:[{name:"ID_PERIODE",operation:"in"},{name:"ID_DOCTOR",operation:"in"},{name:"ID_MUTUA",operation:"in"},{name:"ID_PACIENT",label:"Cognoms i nom pacient contenen",operation:"contains"},{name:"MOBIL",label:"Telèfon conté",operation:"contains"},{name:"ID_TAG",operation:"in"},{name:"DATA",operation:"between"},{name:"AMBFACTURA",operation:"eq"},{name:"CATALA",operation:"eq"}],form:Na,menuUpdater:function(e,t,{$router:a,$route:n}){const l=t?[{text:"Dietari",icon:"Clock",action:()=>async function(e){Fa?.pdfMake&&(Da.vfs=Fa.pdfMake.vfs);const t=Ue(),a=new Date(e),n=new Date(a.getFullYear(),a.getMonth(),a.getDate()),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()+1),i=["diumenge","dilluns","dimarts","dimecres","dijous","divendres","dissabte"][n.getDay()],o=await xe("VISITA",{$select:"DATA,DOCTOR,TIPUSVISITA,ID_INICI,ID_FINAL,NOTA",$expand:"PACIENT($select=NOMICOGNOMS),HORARI($select=HORA),HORARI1($select=HORA),DOCTOR($select=NOM)",$filter:`NOTA eq null and DATA ge ${n.toISOString()} and DATA lt ${l.toISOString()}`}),r=t.data.HORARI.map((e=>({hora:e.HORA,cites:""})));for(let e=0;e<o.value.length;e++){const t=o.value[e].NOTA||o.value[e].PACIENT?.NOMICOGNOMS+" ("+(o.value[e].DOCTOR?.NOM||"")+") "+(o.value[e].TIPUSVISITA||"");r[o.value[e].ID_INICI-1].cites+=(""!==r[o.value[e].ID_INICI].cites?". ":"")+t}const d={pageMargins:[30,50,30,20],header:{text:"Agenda: "+i.toUpperCase()+" "+n.toLocaleDateString(),style:"header"},content:[{text:" ",fontSize:18},{table:{headerRows:1,border:"none",widths:[60,"*"],body:[[{text:"Hora",bold:"true",alignment:"center",margin:[0,10,0,10]},{text:"Pacient",bold:"true",margin:[0,10,0,10]}]]}}],styles:{header:{fontSize:16,alignment:"center",bold:!0,margin:[0,30,0,0]},tableHeader:{bold:!0}},defaultStyle:{fontSize:11}};for(let e=0;e<r.length;e++)d.content[1].table.body.push([{text:r[e].hora,bold:"true",alignment:"center"},r[e].cites+(e>2&&e<22?"\n\n":"\n")]);Da.createPdf(d).download("Diario.pdf")}(t.DATA)},{text:"Facturar",icon:"Invoice",disabled:t.NOFACTURAR||!!t.FACTURA||!!t.NOTA||!t.IMPORT||new Date(t.DATA)>new Date,action:()=>{a.push({path:"/facturar",query:{id:t.ID,return:n.fullPath}})}},{text:"Imprimir factura",icon:"Print",disabled:!t.FACTURA,action:()=>Ea(t.ID)},{text:"Fitxes",disabled:!t.ID_PACIENT,icon:"PDF",children:[{text:"Sobre",icon:"Mail",action:()=>async function(e){const t=new Image;t.onError=function(){alert("Cannot load image")},t.onload=function(){!async function(e,t){const a=C(),n=await xe(`PACIENT(${e})`,{$select:"NOMICOGNOMS,COGNOMSINOM,ADRECA,CODIPOSTAL,POBLACIO,PAIS",$expand:"TRACTAMENT($select=NOM_TRACTAMENT)"}),l=new zt.jsPDF("landscape","mm","a4");l.getFontList(),l.setFontSize(10),l.setFont("helvetica");const i=85+a.SOBRE_LEFT,o=50+a.SOBRE_TOP;_a(l,i,o,`${n.TRACTAMENT?.NOM_TRACTAMENT} ${n.NOMICOGNOMS}`,"bold"),_a(l,i,o+5,n.ADRECA,"normal"),_a(l,i,o+10,n.CODIPOSTAL),_a(l,i+12,o+10,n.POBLACIO),_a(l,i+12,o+15,n.PAIS),l.save(`${n.COGNOMSINOM}.pdf`)}(e)},t.src=`/${d}/images/ClinicaAdreca.jpg`}(t.ID_PACIENT)},{text:"Fitxa adult",icon:"Contact",action:()=>Yt(t.ID_PACIENT)},{text:"Infantil",icon:"Balloons",action:()=>Xt(t.ID_PACIENT)},{text:"Continuació",icon:"FollowUser",action:()=>Qt(t.ID_PACIENT)},{text:"Funda",icon:"Mail",action:()=>Ht(t.ID_PACIENT)},{text:"Funda en blanc",icon:"MailAttached",action:()=>ea(t.ID_PACIENT)},{text:"Funda en blanc sense logo",icon:"MailAttached",action:()=>aa(t.ID_PACIENT)},{text:"Justificant",icon:"AccountActivity",action:()=>async function(e){const t=C(),a=(t.MARGE_LEFT||0)+(t.COMPROVANT_LEFT||0),n=(t.MARGE_TOP||0)+(t.COMPROVANT_TOP||0),l=await xe(`VISITA(${e})`,{$select:"DATA,ID_DOCTOR,CATALA",$expand:"PACIENT($select=NOM,COGNOMS,SEXE,COGNOMSINOM),HORARI($select=HORA),HORARI1($select=HORA),DOCTOR($select=NOM_COMPLET,COLEGIAT,EMAIL,SIGNATURA)"}),i=new zt.jsPDF;i.setFontSize(12),i.addImage(t.COMPROVANT,"PNG",a+10,n+24,44,16),u(i,n+54,a+148,"Barcelona, "+(new Date).toLocaleDateString("en-GB")),u(i,n+68,a+10,l.CATALA?"      S'ha practicat":"Se ha practicado"),u(i,n+68,a+43,l.CATALA?"visita médica, pruebas funcionales de la voz y vídeolaringoestroboscopia":"visita mèdica, proves funcionals de la veu i vídeolaringoestroboscòpia","bold");const o=l.PACIENT.SEXE||"Hombre",r=(l.PACIENT.NOM||"")+" "+(l.PACIENT.COGNOMS||"");let d=("Hombre"===o?"al paciente ":"a la paciente ")+r+("Hombre"===o?" citado hoy a las ":" citada hoy a las ")+l.HORARI.HORA+" horas en mi consulta.";if(l.CATALA&&(d=("Hombre"===o?"al pacient ":"a la pacient ")+r+("Hombre"===o?" citat avui a les ":" citada avui a les ")+l.HORARI.HORA+" horas a la meva consulta."),d.length<91)u(i,n+74,a+10,d,"normal");else{const e=d.substr(0,89).lastIndexOf(" ");u(i,n+74,a+10,d.substr(0,e)),u(i,n+80,a+10,d.substr(e+1))}function u(e,t,a,n,l){n&&(l&&e.setFont("helvetica",l),e.text(a,t,n))}i.addImage(l.DOCTOR.SIGNATURA,"PNG",a+84,n+78,80,40),u(i,n+116,a+104,l.DOCTOR.NOM_COMPLET),u(i,n+120,a+104,"Nº Col. "+l.DOCTOR.COLEGIAT),i.setDrawColor(234,111,74),i.setFontSize(9),i.rect(a+10,n+128,180,0),u(i,n+132,a+10,l.DOCTOR.NOM_COMPLET),u(i,n+132,a+74,t.ADRECA),u(i,n+132,a+136,t.TELEFON),u(i,n+136,a+74,t.POBLACIO),u(i,n+136,a+136,l.DOCTOR.EMAIL),u(i,n+140,a+136,t.WEB),i.save("Comprovant_"+(l.PACIENT.COGNOMSINOM||"").replace(/ /g,"_")+".pdf")}(t.ID)}]},{text:"Modificar pacient",icon:"EditContact",disabled:!t.ID_PACIENT,action:()=>a.push({path:`/PACIENT/edit/${t.ID_PACIENT}`,query:{return:n.fullPath}})}]:[{text:"Nou pacient",icon:"PeopleAdd",action:()=>a.push({path:"/PACIENT/create",query:{return:n.fullPath}})},{text:"Resumen Mútua",icon:"Print",action:()=>a.push({path:"/resumMutua",query:{return:n.fullPath}})},{text:"Resumen Formes pagament",icon:"Print",children:[{text:"Mes actual",action:()=>xa(0)},{text:"Mes anterior",action:()=>xa(1)}]}];return e.concat(l)},permissionDenied:e=>({create:!1,edit:!1,delete:!1,export:!1})},wa=[$t,{name:"DOCTOR",type:"dictionary",label:"Doctors",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM",label:"Doctor",type:"string",defaultField:!0,required:!0,maxlength:16},{name:"NOM_COMPLET",label:"Nom complet",type:"string",defaultField:!0,required:!0,maxlength:40},{name:"SIGNATURA",label:"Signatura (Base 64)",type:"string",multiline:!0}]},qt,Gt,{name:"FORMAPAGAMENT",type:"dictionary",label:"Formes de pagament",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_FORMAPAGAMENT",label:"Forma pagament",type:"string",defaultField:!0,required:!0,maxlength:16}]},{name:"HORARI",type:"dictionary",label:"Horaris consulta",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"HORA",label:"Hora",type:"string",defaultField:!0,required:!0,maxlength:5},{name:"VIGENT",label:"Vigent",type:"boolean"}]},Kt,la,ia,oa,ra,da,{name:"PERIODE",type:"dictionary",label:"Períodes de dates",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_PERIODE",label:"Període",type:"string",defaultField:!0,required:!0,maxlength:24}]},ua,sa,{name:"TRACTAMENT",type:"dictionary",label:"Tractaments",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"NOM_TRACTAMENT",label:"Tractament",type:"string",defaultField:!0,required:!0,maxlength:12}]},ca,Ra,{name:"VISITA_TAG",label:"Etiquestes visita",type:"listSplitted",fields:[{name:"ID",type:"number",primary:!0,readonly:!0},{name:"ID_VISITA",label:"Visita",type:"string",defaultField:!0,required:!0},{name:"ID_TAG",label:"Etiqueta",type:"dictionary",entityName:"TAG",required:!0}]}];function Ba(e){return void 0===e?Array.from(wa):wa.find((t=>t.name===e))}function La(e,t){return t.map((t=>{if("string"==typeof t){const a=e.fields.find((e=>e.name===t));return Object.assign({},a)}{const a=e.fields.find((e=>e.name===t.name));return Object.assign({},a,t)}}))}function ka(e,t=null){return"asc"===(e?.direction??t)?"SortUp":"desc"===(e?.direction??t)?"SortDown":null}function $a(e){return"string"==typeof e&&e?e.split(",").map((e=>{const[t,a]=e.trim().replace(/\s+/," ").split(" ");return{sentence:t,direction:a||"asc"}})):[]}function Ua(e){return e.filter((e=>["asc","desc"].includes(e.direction))).map((e=>`${e.sentence} ${e.direction}`)).join(",")||void 0}const qa={__name:"details-view-select",props:{fields:{type:Array,default:()=>[]},data:{type:Array,required:!0},orderby:{type:Array,default:()=>[]},forcedOrder:{type:Boolean,default:!1},selectedItemId:{type:[Number,String],default:null},autoLayout:{type:String,default:null},compact:{type:Boolean,default:!1},selection:{type:String,default:""},stickyHeader:{type:Boolean,default:!1},stickyHeaderOffset:{type:[String,Number],default:null},pageSize:{type:Number,default:null},firstItem:{type:Number,default:1},dataCount:{type:Number,default:null},paginationPosition:{type:String,default:"bottomCenter"}},emits:["update:selectedItemId","update:orderby","clickCell","update:firstItem","contextmenuRow","contextmenuCell"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>a.fields.find((e=>e.primary))?.name)),o=(0,n.computed)((()=>{const e=a.data.findIndex((e=>e[i.value]===a.selectedItemId));return e>-1?[e]:[]})),r=(0,n.computed)((()=>Math.min(a.firstItem+(a.pageSize-1),a.dataCount))),d=(0,n.computed)((()=>`${a.firstItem} - ${r.value}`));function u(e){if(1===e.length){const t=a.data[e[0]];l("update:selectedItemId",t[i.value])}else l("update:selectedItemId",null)}function s(e){const t=a.data[e.row];l("update:selectedItemId",t[i.value])}const c=(0,n.computed)((()=>a.fields.map(((e,t)=>{if(e.primary)return null;{const n=Be(e),l=a.orderby.find((e=>e.sentence===n));return{index:t,type:e.type,title:e.label,icon:ka(l),width:e.detailsColumn?.width,align:e.detailsColumn?.align}}})).filter((e=>e)))),m=(0,n.computed)((()=>{const{pageSize:e,dataCount:t}=a;return"number"==typeof e&&"number"==typeof t}));function p(e){m.value&&e>0&&e<a.dataCount&&l("update:firstItem",e)}function f(e){p((Math.ceil(a.dataCount/a.pageSize)-1)*a.pageSize)}function y(e){const t=Number(e);!isNaN(t)&&t>0&&t<a.dataCount&&p(t)}const v=(0,n.computed)((()=>{switch(a.paginationPosition){case"topLeft":case"topCenter":case"topRight":return"detailsViewSelect-navTop";case"bottomLeft":case"bottomCenter":case"bottomRight":return"detailsViewSelect-navBottom";default:return}})),A=(0,n.computed)((()=>{switch(a.paginationPosition){case"topLeft":case"bottomLeft":return"detailsViewSelect-left";case"topCenter":case"bottomCenter":return"detailsViewSelect-center";case"topRight":case"bottomRight":return"detailsViewSelect-right";default:return}}));function I(e){const{index:t}=c.value[e],n=Be(a.fields[t]);if(n){const t=a.orderby.map((e=>({...e}))),i=t.findIndex((e=>e.sentence===n));if(i>-1){const e=t[i];"asc"===e.direction?e.direction="desc":"desc"===e.direction?a.forcedOrder?e.direction="asc":t.splice(i,1):"none"===e.direction&&(e.direction="asc")}else{const l=t.map((e=>a.fields.findIndex((t=>Be(t)===e.sentence))));if(l.every((e=>-1===e)))t.push({sentence:n,direction:"asc"});else{const a=[...l.entries()].filter((e=>e[1]>-1)).reduce(((t,a)=>!t||Math.abs(e-a[1])<Math.abs(e-t[1])?a:t),null),i=a[1]<e?a[0]+1:a[0];t.splice(i,0,{sentence:n,direction:"asc"})}}l("update:orderby",t)}}function g({row:e,event:t}){const n=a.data[e][i.value];l("contextmenuCell",{row:e,primary:n,event:t})}function T({row:e,column:t,event:n}){const o=a.data[e][i.value];l("contextmenuCell",{row:e,column:t,primary:o,event:n})}return(t,a)=>{const l=(0,n.resolveComponent)("fura-details-list"),i=(0,n.resolveComponent)("fura-spin-nav");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(v.value)},[(0,n.createVNode)(l,{columns:c.value,data:e.data,"selected-indices":o.value,"auto-layout":e.autoLayout,compact:e.compact,selection:e.selection,"sticky-header":e.stickyHeader,"sticky-header-offset":e.stickyHeaderOffset,"onUpdate:selectedIndices":u,onClickHeader:I,onClickCell:s,onContextmenuRow:g,onContextmenuCell:T},{default:(0,n.withCtx)((a=>[(0,n.renderSlot)(t.$slots,"default",{rowIndex:a.rowIndex,row:e.data[a.rowIndex],fieldIndex:a.column.index,field:e.fields[a.column.index],content:a.content},(()=>[((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[a.column.type].detailsCell),{field:e.fields[a.column.index],row:e.data[a.rowIndex]},null,8,["field","row"]))]))])),header:(0,n.withCtx)((e=>[(0,n.renderSlot)(t.$slots,"header",{column:e.column,index:e.index})])),group:(0,n.withCtx)((e=>[(0,n.renderSlot)(t.$slots,"group",{group:e.group,index:e.index,isCollapsed:e.isCollapsed})])),bodyHeader:(0,n.withCtx)((e=>[(0,n.renderSlot)(t.$slots,"bodyHeader",{groupIndex:e?.groupIndex,group:e?.group,columnIndex:e?.columnIndex,column:e?.column,data:e?.data})])),bodyFooter:(0,n.withCtx)((e=>[(0,n.renderSlot)(t.$slots,"bodyFooter",{groupIndex:e?.groupIndex,group:e?.group,columnIndex:e?.columnIndex,column:e?.column,data:e?.data})])),_:3},8,["columns","data","selected-indices","auto-layout","compact","selection","sticky-header","sticky-header-offset"]),m.value&&v.value&&A.value&&e.data.length>0?((0,n.openBlock)(),(0,n.createBlock)(i,{key:0,class:(0,n.normalizeClass)(["detailsViewSelect-navigation",A.value]),current:d.value,"current-focus":e.firstItem,total:e.dataCount,"end-button":"","start-button":"",editable:"","disable-prev":e.firstItem<=1,"disable-next":r.value>=e.dataCount,"disable-start":e.firstItem<=1,"disable-end":e.firstItem+e.pageSize>=e.dataCount,onPrev:a[0]||(a[0]=t=>p(e.firstItem-e.pageSize)),onNext:a[1]||(a[1]=t=>p(e.firstItem+e.pageSize)),onStart:a[2]||(a[2]=e=>p(1)),onEnd:f,onGoTo:y},null,8,["class","current","current-focus","total","disable-prev","disable-next","disable-start","disable-end"])):(0,n.createCommentVNode)("v-if",!0)],2)}}},Ga=(0,F.Z)(qa,[["__scopeId","data-v-4facc968"]]),Ka={__name:"menu-contextual",props:{items:{type:Array,default:null},positionX:{type:Number,required:!0},positionY:{type:Number,required:!0}},emits:["close"],setup(e,{expose:t,emit:a}){const l=a,i=(0,n.ref)(),o=(0,n.ref)(!1);function r(e){i.value.$el.contains(e.target)||i.value.$el===e.target||(e.preventDefault(),l("close"))}return(0,n.onMounted)((()=>window.addEventListener("click",r,!0))),(0,n.onUnmounted)((()=>window.removeEventListener("click",r,!0))),t({checkOverload:function(){o.value=i.value.checkOverload()}}),(t,a)=>{const l=(0,n.resolveComponent)("fura-block-menu");return e.items?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,ref_key:"element",ref:i,class:(0,n.normalizeClass)(["menuContextual",{overloaded:o.value}]),style:(0,n.normalizeStyle)({top:`${e.positionY}px`,left:`${e.positionX}px`}),items:e.items,onOverload:a[0]||(a[0]=e=>o.value=!0)},null,8,["class","style","items"])):(0,n.createCommentVNode)("v-if",!0)}}},ja=(0,F.Z)(Ka,[["__scopeId","data-v-138761e4"]]),za={class:"layoutDetails-totals"},Ha={__name:"layout-list-details",props:{menuItem:{type:Array,default:void 0},menuView:{type:Array,default:void 0},menuContextual:{type:Array,default:void 0},menuContextualOpen:{type:Boolean,default:!1},fields:{type:Array,default:()=>[]},data:{type:Array,required:!0},totals:{type:Object,default:void 0},orderby:{type:Array,default:()=>[]},forcedOrder:{type:Boolean,default:!1},selectedItemId:{type:[Number,String],default:null},selection:{type:String,default:""},pageSize:{type:Number,default:null},firstItem:{type:Number,default:1},dataCount:{type:Number,default:null},paginationPosition:{type:String,default:"bottomCenter"}},emits:["menuContextualOpen","menuContextualClose","update:selectedItemId","update:orderby","clickCell","update:firstItem"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.ref)(!0);function o(e){if(e.column){const t=a.fields[e.column.index];if(t){const e=wt[t.type];return"function"==typeof e?.getTotalsTextValueFromEntity?e.getTotalsTextValueFromEntity(t,a.totals):a.totals[t.name]}}return""}(0,n.watch)((()=>a.totals),((e,t)=>{(e&&!t||!e&&t)&&(i.value=!1,(0,n.nextTick)((()=>{i.value=!0})))}));const r=(0,n.ref)(),d=(0,n.ref)({});function u({primary:e,event:t}){t.preventDefault(),d.value={x:t.clientX,y:t.clientY},l("menuContextualOpen",e),(0,n.nextTick)((()=>r.value?.checkOverload()))}function s(e){a.menuContextualOpen&&l("menuContextualClose")}return(0,n.onMounted)((()=>{document.getElementById("app").addEventListener("scroll",s)})),(0,n.onUnmounted)((()=>{document.getElementById("app").removeEventListener("scroll",s)})),(t,a)=>{const s=(0,n.resolveComponent)("fura-command-bar");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(s,{class:"layoutDetails-commandBar",items:e.menuItem,"far-items":e.menuView},null,8,["items","far-items"]),i.value?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Ga),{key:0,fields:e.fields,data:e.data,orderby:e.orderby,"forced-order":e.forcedOrder,"selected-item-id":e.selectedItemId,compact:"",selection:e.selection,"sticky-header":"","sticky-header-offset":44,"page-size":e.pageSize,"first-item":e.firstItem,"data-count":e.dataCount,"pagination-position":e.paginationPosition,"onUpdate:selectedItemId":a[0]||(a[0]=e=>l("update:selectedItemId",e)),"onUpdate:orderby":a[1]||(a[1]=e=>l("update:orderby",e)),onClickCell:a[2]||(a[2]=e=>l("clickCell",e)),"onUpdate:firstItem":a[3]||(a[3]=e=>l("update:firstItem",e)),onContextmenuRow:u,onContextmenuCell:u},(0,n.createSlots)({_:2},[e.totals?{name:"bodyHeader",fn:(0,n.withCtx)((e=>[(0,n.createElementVNode)("span",za,(0,n.toDisplayString)(o(e)),1)])),key:"0"}:void 0]),1032,["fields","data","orderby","forced-order","selected-item-id","selection","page-size","first-item","data-count","pagination-position"])):(0,n.createCommentVNode)("v-if",!0),((0,n.openBlock)(),(0,n.createBlock)(n.Teleport,{to:"body"},[e.menuContextual&&e.menuContextualOpen?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(ja),{key:0,ref_key:"menuContextualElement",ref:r,items:e.menuContextual,"position-x":d.value.x,"position-y":d.value.y,onClose:a[4]||(a[4]=e=>l("menuContextualClose"))},null,8,["items","position-x","position-y"])):(0,n.createCommentVNode)("v-if",!0)]))],64)}}},Wa=(0,F.Z)(Ha,[["__scopeId","data-v-463b210f"]]);function Ya(e,{parse:t,stringify:a,handleLeave:l}={}){const i=(0,r.useRoute)(),o=(0,r.useRouter)(),d=(0,n.ref)(i.params[e]);return(0,r.onBeforeRouteUpdate)((t=>{d.value=t.params[e]})),l&&(0,r.onBeforeRouteLeave)((t=>{d.value=t.params[e]})),{[e]:(0,n.computed)({get:()=>"function"==typeof t?t(d.value):d.value,set:t=>{d.value!==t&&o.push({params:{[e]:"function"==typeof a?a(t)||void 0:t??void 0}})}})}}function Za(e,{parse:t,stringify:a,handleLeave:l}={}){const i=(0,r.useRoute)(),o=(0,r.useRouter)(),d=(0,n.ref)(i.query[e]);function u(t,n={}){n.value!==t&&o.push({path:i.path,query:{...i.query,...n,[e]:"function"==typeof a?a(t)||void 0:t??void 0}})}return(0,r.onBeforeRouteUpdate)((t=>{d.value=t.query[e]})),l&&(0,r.onBeforeRouteLeave)((t=>{d.value=t.query[e]})),{[e]:(0,n.computed)({get:()=>"function"==typeof t?t(d.value):d.value,set:e=>u(e)}),[`${e}Raw`]:(0,n.readonly)(d),[`update${Xa(e)}`]:u}}function Xa(e){return e[0].toUpperCase()+e.substring(1)}function Ja(){const e=(0,r.useRoute)(),t=(0,r.useRouter)();return{goBack(a,l,{reload:i=!1}={}){if(e.query.return)if(i){const a=e.query.return.includes("?")?"&":"?";t.push(`${e.query.return}${a}reload=true`)}else t.push(e.query.return);else t.push({path:(0,n.unref)(a),query:{...(0,n.unref)(l)||e.query||{},reload:!0}})}}}function Qa(e,t){return t?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase():e.toLowerCase()}function en(e,t){return t.split("/").reduce(((e,t)=>e[t]),e)??""}function tn(e,t){return{sortedData:(0,n.computed)((()=>{const a=Array.from((0,n.unref)(e)||[]),l=Array.from((0,n.unref)(t)||[]).reverse();for(const e of l)"asc"===e.direction?a.sort(((t,a)=>{const n=Qa(en(t,e.sentence),!0),l=Qa(en(a,e.sentence),!0);return n>l?1:n<l?-1:0})):"desc"===e.direction&&a.sort(((t,a)=>{const n=Qa(en(t,e.sentence),!0),l=Qa(en(a,e.sentence),!0);return n>l?-1:n<l?1:0}));return a}))}}const an={__name:"dictionary-details",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ue(),o=(0,n.computed)((()=>t.list.name)),{orderby:d,updateOrderby:u}=Za("orderby",{parse:$a,stringify:Ua,handleLeave:!0}),{selectedItemId:s}=Za("selectedItemId",{parse:e=>e?Number(e):null,stringify:e=>null!=e?String(e):void 0,handleLeave:!0}),{firstItem:c,updateFirstItem:m}=Za("firstItem",{parse:e=>e?Number(e):null,stringify:e=>null!=e?String(e):void 0});(0,n.watch)(o,(e=>i.loadDictionary(e)),{immediate:!0});const p=(0,n.computed)((()=>t.list?.pageSize?t.list.pageSize:10)),f=(0,n.computed)((()=>i.data[o.value]?.length||0)),y=(0,n.computed)((()=>i.data[o.value]||[])),{sortedData:v}=tn(y,d),A=(0,n.computed)((()=>t.list?.paginated?v.value.slice(c.value,c.value+p.value):v.value)),I=(0,n.computed)((()=>{const e=t.list?.fields.find((e=>e.primary))?.name;let a=null;return e&&y.value.length>0&&(a=y.value.find((t=>t[e]===s.value))??null),t.list.permissionDenied?.(a)??{}})),g=(0,n.computed)((()=>{const e=[];return I.value.create||e.push({text:"Nou",icon:"Add",action:()=>l.push({path:`/${o.value}/create`,query:{return:a.fullPath}})}),null!=s.value&&(I.value.edit||e.push({text:"Modificar",icon:"Edit",action:()=>l.push({path:`/${o.value}/edit/${s.value}`,query:{return:a.fullPath}})}),I.value.delete||e.push({text:"Esborrar",icon:"Delete",action:()=>l.push({path:`/${o.value}/delete/${s.value}`,query:{return:a.fullPath}})})),e})),T=(0,n.computed)((()=>{const e=[];return null!=s.value&&null!=s.value&&(I.value.edit||e.push({text:"Modificar",icon:"Edit",action:()=>l.push({path:`/${o.value}/edit/${s.value}`,query:{return:a.fullPath}})}),I.value.delete||e.push({text:"Esborrar",icon:"Delete",action:()=>l.push({path:`/${o.value}/delete/${s.value}`,query:{return:a.fullPath}})})),e})),b=(0,n.ref)(!1);function O(e){s.value=e,b.value=!0}function C(){b.value=!1}return(t,a)=>{const l=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)((0,n.unref)(V),{subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(Wa),{"menu-item":g.value,"menu-contextual":T.value,"menu-contextual-open":b.value,fields:e.list.fields,data:A.value,orderby:(0,n.unref)(d),"forced-order":"",selection:"simple","selected-item-id":(0,n.unref)(s),"page-size":p.value,"first-item":(0,n.unref)(c)??void 0,"data-count":f.value,"onUpdate:orderby":a[0]||(a[0]=e=>(0,n.unref)(u)(e,{selectedItemId:void 0})),"onUpdate:selectedItemId":a[1]||(a[1]=e=>s.value=e),"onUpdate:firstItem":a[2]||(a[2]=e=>(0,n.unref)(m)(e,{selectedItemId:void 0})),onMenuContextualOpen:O,onMenuContextualClose:C},null,8,["menu-item","menu-contextual","menu-contextual-open","fields","data","orderby","selected-item-id","page-size","first-item","data-count"])])),_:1},8,["subtitle"]),(0,n.createVNode)(l)],64)}}},nn={__name:"form-field-collection",props:{fields:{type:Array,required:!0},entity:{type:Object,required:!0},validations:{type:Object,required:!0},withClass:{type:[Boolean,Function],default:null},withAreaName:{type:[Boolean,Function],default:null},cacheName:{type:String,default:""}},emits:["change","focus","blur"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>a.fields.filter((e=>!e.primary&&e.type))));function o(e,t){return!0===a.withClass?`formField-${e.name}`:"function"==typeof a.withClass?a.withClass.call(null,e,t):void 0}function r(e){return!0===a.withAreaName?{gridArea:e.name}:"function"==typeof a.withAreaName?{gridArea:a.withAreaName.call(null,e)}:void 0}return(t,d)=>((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.value,(t=>((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[t.type].formField),{key:t.name,entity:e.entity,field:t,validations:e.validations,class:(0,n.normalizeClass)(o(t,e.entity)),style:(0,n.normalizeStyle)(r(t,e.entity)),"cache-name":e.cacheName,onChange:e=>async function(e,t){if(l("change",{field:e,action:t}),"function"==typeof e.onChange){const t=await e.onChange(a.entity);"function"==typeof t&&l("change",{field:e,action:t})}}(t,e),onFocus:e=>async function(e,t){if("function"==typeof e.onFocus){const n=await e.onFocus(a.entity,t);"function"==typeof n&&l("change",{field:e,action:n})}}(t,e),onBlur:e=>async function(e,t){if("function"==typeof e.onBlur){const n=await e.onBlur(a.entity,t);"function"==typeof n&&l("change",{field:e,action:n})}}(t,e)},null,40,["entity","field","validations","class","style","cache-name","onChange","onFocus","onBlur"])))),128))}},ln=[];function on(){ln.push([])}function rn(){ln.pop()}function dn(...e){if(ln.length>0){const t=ln[ln.length-1];for(const a of t)a(...e)}}const un={__name:"form-auto",props:{list:{type:Object,required:!0},form:{type:Object,required:!0},entity:{type:Object,required:!0},validations:{type:Object,required:!0}},emits:["change"],setup(e,{emit:t}){const a=e,l=t,i=At();(0,n.watch)((()=>a.list.name),(e=>i.load(e)),{immediate:!0});const o=(0,n.computed)((()=>La(a.list,a.form.fields(a.entity)))),{errorMessage:r,clean:d}=a.form.rules?a.validations.createValidation("formRules",{rules:a.form.rules}):{};function u({field:e,action:t}){d?.(),l("change",t)}var s;return s=(...e)=>a.form.onItemLoaded?.(...e),ln.length>0&&ln[ln.length-1].push(s),(t,a)=>{const l=(0,n.resolveComponent)("fura-message-bar");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(e.form.class)},[(0,n.createVNode)((0,n.unref)(nn),{"with-area-name":"",fields:o.value,entity:e.entity,"with-class":e.form.withClass,validations:e.validations,"cache-name":e.list.entityName||e.list.name,onChange:u},null,8,["fields","entity","with-class","validations","cache-name"]),(0,n.unref)(r)?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,style:{"grid-area":"errorMessage"},type:"error",dismiss:"",singleline:"",onDismiss:a[0]||(a[0]=e=>(0,n.unref)(d)?.())},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)((0,n.unref)(r)),1)])),_:1})):(0,n.createCommentVNode)("v-if",!0)],2)}}};async function sn(e,t){const a=Ve();try{const a=await e();return t&&t(),a}catch(e){t&&t(),a.alert({title:"Error",message:e.body||"Error inesperat."})}}const cn={__name:"dictionary-item-edit",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ve(),d=Ue(),u=(0,o.useValidations)(),{goBack:s}=Ja(),c=(0,n.computed)((()=>t.list.name)),{itemId:m}=Ya("itemId",{parse:e=>null!=e?Number(e):null,stringify:e=>null!=e?String(e):void 0,handleLeave:!0}),p=(0,n.computed)((()=>t.list.fields.find((e=>e.primary)))),f=(0,n.computed)((()=>t.list.fields.find((e=>e.defaultField)))),y=Xe({form:{entityName:c.value},...t.list}),v=(0,n.ref)(!1),A=(0,n.ref)("");function I(){const e=null!=m.value?d.data[c.value].find((e=>e[p.value.name]===m.value)):Object.fromEntries(t.list.fields.map((e=>[e.name,e.default])));(0,o.entitySyncData)(y,e),(0,o.entityConsolidate)(y)}function g({action:e}){e(y)}async function T(){await u.validate(y)&&(await Je(y),await d.loadDictionary(c,{force:!0}),s(`/${c.value}`))}async function b(){await u.validate(y)&&(await Je(y),await d.loadDictionary(c,{force:!0}),null===m.value?I():l.push({path:`/${c.value}/create`,query:a.query}))}function O(){i.confirm({title:"Alerta!",message:"Esteu segurs de que voleu esborrar aquest element?. Aquesta acció no es pot desfer.",accept:async()=>{await sn((async()=>{await Qe(y),await d.loadDictionary(c,{force:!0}),l.push({path:`/${c.value}`,query:{...a.query,selectedKey:void 0}})}))}})}return(0,n.watch)(m,I),(0,n.onMounted)((async()=>{v.value=!1,await d.loadDictionary(c),I(),A.value=null===m.value?"Entrada nou element":`Modificació: ${y[f.value.name]}`,v.value=!0})),(t,a)=>{const l=(0,n.resolveComponent)("fura-dialog"),i=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)(i,{class:"dictionaryItemEdit-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{class:"dictionaryItemEdit-dialog",header:A.value},{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(w),{"has-save":"","has-save-and-new":"","has-reset":"","has-remove":null!==(0,n.unref)(m),"has-go-back":"",onSave:T,onSaveAndNew:b,onReset:I,onRemove:O,onGoBack:a[0]||(a[0]=e=>(0,n.unref)(s)(`/${c.value}`))},{default:(0,n.withCtx)((()=>[e.list.form?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(un),{key:0,list:e.list,form:e.list.form,entity:(0,n.unref)(y),validations:(0,n.unref)(u),onChange:g},null,8,["list","form","entity","validations"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(nn),{key:1,fields:e.list.fields,entity:(0,n.unref)(y),validations:(0,n.unref)(u),"cache-name":e.list.name,onChange:g},null,8,["fields","entity","validations","cache-name"]))])),_:1},8,["has-remove"])])),_:1},8,["header"])])),_:1})}}},mn=(0,F.Z)(cn,[["__scopeId","data-v-1b60de7a"]]),pn={class:"dialogFooter"},fn={__name:"dictionary-item-delete",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ve(),o=Ue(),{goBack:d}=Ja(),u=(0,n.computed)((()=>t.list.name)),{itemId:s}=Ya("itemId",{parse:e=>null!=e?Number(e):null,stringify:e=>null!=e?String(e):void 0}),c=t.list.fields.find((e=>e.primary)),m=t.list.fields.find((e=>e.defaultField)),p=(0,n.ref)("");return(0,n.onMounted)((async()=>{i.loadStart("dictionary-form/load"),await o.loadDictionary(u);const e=o.data[u.value].find((e=>e[c.name]===s.value));p.value=`Esteu segurs que voleu esborrar l'element "${e?.[m.name]}"?`,i.loadEnd("dictionary-form/load")})),(e,t)=>{const i=(0,n.resolveComponent)("fura-button"),r=(0,n.resolveComponent)("fura-dialog"),c=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)(c,{class:"modalOverlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{class:"dialogMessage",type:"close",header:"Confirmació d'eliminació",text:p.value,onClick:t[2]||(t[2]=e=>(0,n.unref)(d)(`/${u.value}`))},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",pn,[(0,n.createVNode)(i,{primary:"",text:"Eliminar",onClick:t[0]||(t[0]=e=>async function(){await sn((async()=>{await Re(`${u.value}(${s.value})`),await o.loadDictionary(u,{force:!0}),l.push({path:`/${u.value}`,query:{...a.query,selectedKey:void 0}})}))}())}),(0,n.createVNode)(i,{text:"Cancel·lar",onClick:t[1]||(t[1]=e=>(0,n.unref)(d)(`/${u.value}`))})])])),_:1},8,["text"])])),_:1})}}};function yn(e){return[{path:`/${e.name}`,component:e.routes?.overrideControls?.DictionaryDetails??an,props:{list:e},children:[{path:"create",component:e.routes?.overrideControls?.DictionaryItemEdit??mn,props:{list:e}},{path:"edit/:itemId",component:e.routes?.overrideControls?.DictionaryItemEdit??mn,props:{list:e}},{path:"delete/:itemId",component:e.routes?.overrideControls?.DictionaryItemDelete??fn,props:{list:e}}]}]}const vn=(0,l.defineStore)({id:"view",state:()=>({listName:null,definitions:[]}),actions:{async loadViews(e,t){if(e&&(this.listName!==e||t)){const t=Ve();t.loadStart(`list-view/${e}/load`);const a=await xe(p,{$filter:`${y} eq '${e}'`,$orderby:`${I} desc,${v} asc`});this.listName=e,this.definitions=a.value.map((e=>({...e,[A]:JSON.parse(e[A]||"null")}))),t.loadEnd(`list-view/${e}/load`)}}}}),An={class:"listDetailsDefault-buttons"},In={__name:"list-details-default",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRouter)(),l=vn(),i=(0,n.computed)((()=>t.list.name)),o=(0,n.ref)(!1);function d(){a.push(`/${i.value}/view/create`)}return(0,n.watch)(i,(e=>{e&&l.loadViews(e).then((()=>{const t=l.definitions.find((e=>e[I]))||l.definitions[0],n=t?.[v];n&&a.push({path:`/${e}/view/query/${n}`,query:{orderby:t[A].orderby,filter:t[A].filter}}),o.value=!0}))}),{immediate:!0}),(t,a)=>{const l=(0,n.resolveComponent)("fura-button"),i=(0,n.resolveComponent)("fura-dialog"),r=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{class:"listDetailsDefault-overlay"},{default:(0,n.withCtx)((()=>[o.value?((0,n.openBlock)(),(0,n.createBlock)(i,{key:0,class:"listDetailsDefault-dialog",header:"Atencio",text:"No s'ha definit cap visualització. Creeu una visualització per començar."},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",An,[(0,n.createVNode)(l,{primary:"",text:"Crea una nova visualització",onClick:d})])])),_:1})):(0,n.createCommentVNode)("v-if",!0)])),_:1})])),_:1},8,["subtitle"])}}},gn=(0,F.Z)(In,[["__scopeId","data-v-0871c081"]]);function Tn(e,t,a,n){const l=O();return(0,o.useFetchGet)([m,e].flat(),t,{Authorization:l.jwt,...a},n)}const bn={__name:"list-details",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRouter)(),l=(0,r.useRoute)(),i=vn(),o=Ve(),d=(0,n.computed)((()=>t.list.name)),{viewName:u}=Ya("viewName"),{filter:s}=Za("filter"),{orderby:c,orderbyRaw:m,updateOrderby:p}=Za("orderby",{parse:$a,stringify:Ua}),{selectedItemId:f}=Za("selectedItemId",{parse:e=>e?Number(e):null,stringify:e=>null!=e?String(e):void 0}),{firstItem:y,updateFirstItem:I}=Za("firstItem",{parse:e=>e?Number(e):null,stringify:e=>null!=e?String(e):void 0}),{reload:g}=Za("reload",{parse:e=>Boolean(e)});(0,n.watch)(d,(async e=>{await i.loadViews(e),u.value&&!i.definitions.some((e=>e[v]===u.value))&&a.push(`/${e}`)}),{immediate:!0});const T=(0,n.computed)((()=>t.list?.fields.find((e=>e.primary)))),b=(0,n.computed)((()=>t.list?.fields.filter((e=>e.loadAlwaysInView))??[])),O=(0,n.computed)((()=>i.definitions.find((e=>e[v]===u.value)))),C=(0,n.computed)((()=>{const e=Array.from(O.value?.[A].fields||[]);return e.includes(T.value?.name)||e.unshift(T.value?.name),e.map((e=>t.list.fields.find((t=>t.name===e)))).filter((e=>e))})),N=(0,n.computed)((()=>O.value?.DEF_VIEW?.apply?`aggregate(${O.value.DEF_VIEW.apply})`:void 0)),h=(0,n.computed)((()=>t.list?.pageSize?t.list.pageSize:10)),_=(0,n.computed)((()=>{if("function"==typeof t.list.detailsFilter){const e=t.list.detailsFilter(),a="string"==typeof e?e:me(e);return s.value?`(${a}) and (${s.value})`:a}return s.value})),E=(0,n.computed)((()=>({...we([T.value,...C.value,...b.value.filter((e=>!C.value?.some((t=>e.name===t.name))))]),$filter:_.value||void 0,$orderby:m.value||void 0,$skip:y.value>0?y.value-1:void 0,$top:h.value,$count:!0}))),P=(0,n.computed)((()=>N.value?_.value?{$apply:`filter(${_.value})/${N.value}`}:{$apply:N.value}:null)),S=(0,n.computed)((()=>t.list.entityName||t.list.name)),{data:D,isLoading:F,load:M}=Tn(S,E,void 0,{wait:100}),{data:x,isLoading:R,load:w}=Tn(S,P,void 0,{manual:!0});(0,n.watch)(g,(e=>{e&&M(),a.replace({path:l.path,query:{...l.query,reload:void 0}})})),(0,n.watch)(P,(e=>{e?Promise.resolve().then(w):x.value=void 0}),{immediate:!0});const B=(0,n.computed)((()=>D.value?.value||[])),L=(0,n.computed)((()=>D.value?.["@odata.count"]));(0,n.watch)([F,R],(([e,t])=>e||t?o.loadStart(`list/${d.value}/load`):o.loadEnd(`list/${d.value}/load`)),{immediate:!0});const k=(0,n.computed)((()=>{if(T.value&&B.value.length>0){const e=T.value.name;return B.value.find((t=>t[e]===f.value))??null}return null})),$=(0,n.computed)((()=>t.list.permissionDenied?.(k.value)??{})),U=(0,n.computed)((()=>{const e=[];return $.value.create||e.push({text:"Nou",icon:"Add",action:()=>a.push({path:`/${d.value}/create`,query:{return:l.fullPath}})}),null!=f.value&&($.value.edit||e.push({text:"Modificar",icon:"Edit",action:()=>a.push({path:`/${d.value}/edit/${f.value}`,query:{return:l.fullPath}})}),$.value.delete||e.push({text:"Esborrar",icon:"Delete",action:()=>a.push({path:`/${d.value}/delete/${f.value}`,query:{...l.query,viewName:u.value}})})),$.value.edit||"auto"!==t.list.form?.component||e.push({text:"Editar valors",icon:"WindowEdit",action:()=>a.push({path:`/${d.value}/view/grid/${u.value}`,query:l.query})}),null==f.value&&u.value&&!$.value.export&&e.push({text:"Exportar",icon:"Export",children:[{text:"a PDF",icon:"PDF",action:()=>a.push({path:`/${d.value}/view/query/${u.value}/export`,query:{...l.query,format:"pdf"}})},{text:"a Excel",icon:"ExcelDocument",action:()=>a.push({path:`/${d.value}/view/query/${u.value}/export`,query:{...l.query,format:"excel"}})}]}),e})),q=(0,n.computed)((()=>t.list.menuUpdater?t.list.menuUpdater(U.value,k.value,{contextual:!1,$router:a,$route:l}):U.value)),G=(0,n.computed)((()=>{const e=[{text:u.value??"",children:[...i.definitions?.map((e=>({text:e[v],action:()=>a.push({path:`/${d.value}/view/query/${e[v]}`,query:{orderby:e[A].orderby,filter:e[A].filter}})})))??[],{type:"divider"},{text:"Crea una visualització",icon:"Add",action:()=>a.push({path:`/${d.value}/view/create`,query:{filter:l.query.filter,return:l.fullPath}})}]}];return u.value&&e[0].children.push({text:"Modifica",icon:"CSS",action:()=>a.push({path:`/${d.value}/view/edit/${u.value}`,query:{filter:l.query.filter,return:l.fullPath}})}),t.list.filter&&e.push({icon:"Filter",action:()=>a.push({path:`/${d.value}/view/query/${u.value}/filter`,query:{...l.query}})}),e})),K=(0,n.computed)((()=>{const e=[];return $.value.edit||e.push({text:"Modificar",icon:"Edit",action:()=>a.push({path:`/${S.value}/edit/${f.value}`,query:{return:l.fullPath}})}),$.value.delete||e.push({text:"Esborrar",icon:"Delete",action:()=>a.push({path:`/${S.value}/delete/${f.value}`,query:{...l.query,viewName:u.value}})}),e})),j=(0,n.computed)((()=>t.list.menuUpdater?t.list.menuUpdater(K.value,k.value,{contextual:!0}):K.value)),z=(0,n.ref)(!1);function H(e){f.value=e,z.value=!0}function W(){z.value=!1}return(t,a)=>{const l=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)((0,n.unref)(V),{subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(Wa),{"menu-item":q.value,"menu-view":G.value,"menu-contextual":j.value,"menu-contextual-open":z.value,fields:C.value,data:B.value,totals:(0,n.unref)(x)?.value?.[0],orderby:(0,n.unref)(c),selection:"simple","selected-item-id":(0,n.unref)(f),"page-size":h.value,"first-item":(0,n.unref)(y)??void 0,"data-count":L.value,"onUpdate:orderby":a[0]||(a[0]=e=>(0,n.unref)(p)(e,{selectedItemId:void 0})),"onUpdate:selectedItemId":a[1]||(a[1]=e=>f.value=e),"onUpdate:firstItem":a[2]||(a[2]=e=>(0,n.unref)(I)(e,{selectedItemId:void 0})),onMenuContextualOpen:H,onMenuContextualClose:W},null,8,["menu-item","menu-view","menu-contextual","menu-contextual-open","fields","data","totals","orderby","selected-item-id","page-size","first-item","data-count"])])),_:1},8,["subtitle"]),(0,n.createVNode)(l)],64)}}},On={class:"detailsGrid fura-stickyHeader"},Cn={class:"detailsGrid-headerTitle"},Nn=["textContent"],hn=(e=>((0,n.pushScopeId)("data-v-3c346872"),e=e(),(0,n.popScopeId)(),e))((()=>(0,n.createElementVNode)("th",{width:"88px"},null,-1))),_n={key:0},En=["colspan"],Pn={__name:"details-grid",props:{list:{type:Object,required:!0},columns:{type:Array,required:!0},elements:{type:Array,required:!0},stickyHeader:{type:Boolean,default:!1},stickyHeaderOffset:{type:[String,Number],default:null}},emits:["update","focus","blur","save","reset"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>"number"==typeof a.stickyHeaderOffset&&a.stickyHeaderOffset?{top:`${a.stickyHeaderOffset}px`}:"string"==typeof a.stickyHeaderOffset&&a.stickyHeaderOffset?{top:a.stickyHeaderOffset}:{})),o=a.elements.map((e=>(0,n.computed)((()=>{const t=La(a.list,a.list.form.fields(e.entity));return La({fields:t},a.columns.map((({field:e})=>e.name)))})))),r=a.elements.map(((e,t)=>o[t].value.map((t=>(0,n.computed)((()=>function(e,t){const{withClass:n}=a.list.form;return!0===n?`formField-${e.name}`:"function"==typeof n?n(e,t):void 0}(t,e.entity)))))));return(t,a)=>{const d=(0,n.resolveComponent)("fura-icon"),u=(0,n.resolveComponent)("fura-button"),s=(0,n.resolveComponent)("fura-message-bar");return(0,n.openBlock)(),(0,n.createElementBlock)("table",On,[(0,n.createElementVNode)("thead",null,[(0,n.createElementVNode)("tr",null,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.columns,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("th",{key:t,class:"detailsGrid-headerCell",style:(0,n.normalizeStyle)({width:e.field.gridColumn?.width,...i.value})},[(0,n.createElementVNode)("div",Cn,[(0,n.createElementVNode)("span",{textContent:(0,n.toDisplayString)(e.title)},null,8,Nn),e.icon?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,class:"detailsGrid-headerIcon",name:e.icon},null,8,["name"])):(0,n.createCommentVNode)("v-if",!0)])],4)))),128)),hn])]),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.elements,((t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)("tbody",{key:a},[(0,n.createElementVNode)("tr",null,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.columns,((i,d)=>((0,n.openBlock)(),(0,n.createElementBlock)("td",{key:d},[(0,n.unref)(wt)[(0,n.unref)(o)[a].value[d].type]?.gridField?((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[(0,n.unref)(o)[a].value[d].type].gridField),{key:0,class:(0,n.normalizeClass)((0,n.unref)(r)[a][d].value),entity:t.entity,field:(0,n.unref)(o)[a].value[d],validations:t.validations,"cache-name":e.list.entityName||e.list.name,onChange:e=>l("update",{index:a,field:(0,n.unref)(o)[a].value[d],action:e}),onFocus:e=>l("focus",{index:a,field:(0,n.unref)(o)[a].value[d],event:e}),onBlur:e=>l("blur",{index:a,field:(0,n.unref)(o)[a].value[d],event:e})},null,40,["class","entity","field","validations","cache-name","onChange","onFocus","onBlur"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[i.field.type].detailsCell),{key:1,field:i.field,row:t.entity},null,8,["field","row"]))])))),128)),(0,n.createElementVNode)("td",null,[t.hasPendingChanges?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[(0,n.createVNode)(u,{type:"icon",icon:"Save",onClick:e=>l("save",a)},null,8,["onClick"]),(0,n.createVNode)(u,{type:"icon",icon:"Reset",onClick:e=>l("reset",a)},null,8,["onClick"])],64)):(0,n.createCommentVNode)("v-if",!0)])]),t.errorMessage?((0,n.openBlock)(),(0,n.createElementBlock)("tr",_n,[(0,n.createElementVNode)("td",{colspan:e.columns.length+1},[(0,n.createVNode)(s,{type:"error",dismiss:"",singleline:"",onDismiss:e=>t.clean?.()},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(t.errorMessage),1)])),_:2},1032,["onDismiss"])],8,En)])):(0,n.createCommentVNode)("v-if",!0)])))),128))])}}},Sn=(0,F.Z)(Pn,[["__scopeId","data-v-3c346872"]]),Dn={__name:"layout-list-grid",props:{list:{type:Object,required:!0},menuItem:{type:Array,default:void 0},menuView:{type:Array,default:void 0},fields:{type:Array,default:void 0},elements:{type:Array,default:void 0},orderby:{type:Array,default:()=>[]},pageSize:{type:Number,default:null},currentPage:{type:Number,default:0},elementsCount:{type:Number,default:null},paginationPosition:{type:String,default:"bottomCenter"}},emits:["update","focus","blur","save","reset"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>a.fields.map(((e,t)=>({index:t,type:e.type,title:e.label,icon:ka(a.orderby.find((t=>t.sentence===Be(e)))),field:e}))))),o=(0,n.computed)((()=>{const{pageSize:e,elementsCount:t}=a;return"number"==typeof e&&"number"==typeof t})),r=(0,n.computed)((()=>Math.ceil(a.elementsCount/a.pageSize))),d=(0,n.computed)((()=>{switch(a.paginationPosition){case"topLeft":case"topCenter":case"topRight":return"layoutListGrid-navTop";case"bottomLeft":case"bottomCenter":case"bottomRight":return"layoutListGrid-navBottom";default:return}})),u=(0,n.computed)((()=>{switch(a.paginationPosition){case"topLeft":case"bottomLeft":return"layoutListGrid-left";case"topCenter":case"bottomCenter":return"layoutListGrid-center";case"topRight":case"bottomRight":return"layoutListGrid-right";default:return}}));return(t,a)=>{const s=(0,n.resolveComponent)("fura-command-bar"),c=(0,n.resolveComponent)("fura-spin-nav");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(s,{class:"layoutListGrid-commandBar",items:e.menuItem,"far-items":e.menuView},null,8,["items","far-items"]),(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(d.value)},[(0,n.createVNode)((0,n.unref)(Sn),{class:"layoutListGrid-details",list:e.list,columns:i.value,elements:e.elements,"sticky-header":"","sticky-header-offset":44,onUpdate:a[0]||(a[0]=e=>l("update",e)),onFocus:a[1]||(a[1]=e=>l("focus",e)),onBlur:a[2]||(a[2]=e=>l("blur",e)),onSave:a[3]||(a[3]=e=>l("save",e)),onReset:a[4]||(a[4]=e=>l("reset",e))},null,8,["list","columns","elements"]),o.value&&d.value&&u.value&&e.elements.length>0?((0,n.openBlock)(),(0,n.createBlock)(c,{key:0,class:(0,n.normalizeClass)(["layoutListGrid-navigation",u.value]),current:e.currentPage+1,total:r.value,"end-button":"","start-button":"","disable-prev":"","disable-next":"","disable-start":"","disable-end":""},null,8,["class","current","total"])):(0,n.createCommentVNode)("v-if",!0)],2)],64)}}},Fn=(0,F.Z)(Dn,[["__scopeId","data-v-7472afbe"]]),Vn={__name:"list-details-grid",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRouter)(),l=(0,r.useRoute)(),i=vn(),d=At(),u=Ve();d.setContextName(t.list.name),d.load(t.list.name);const s=(0,n.ref)(!0),c=l.params.viewName,p=l.query.page?Number(l.query.page)-1:null,f=t.list?.pageSize?t.list.pageSize:10,y=(0,n.shallowRef)([]),I=(0,n.shallowRef)(null),g=(0,o.useEntityCollection)(et(t.list,t.list.form)),T=(0,n.ref)(0),b=(0,n.reactive)([]),C=(0,n.getCurrentScope)();i.loadViews(t.list.name).then((async()=>{u.loadStart(`list/${t.list.name}/load`),c&&!i.definitions.some((e=>e[v]===c))&&a.push(`/${t.list.name}`);const e=i.definitions.find((e=>e[v]===c));y.value=e[A].fields.map((e=>t.list.fields.find((t=>t.name===e)))).filter((e=>e));let r=l.query.filter;if("function"==typeof t.list.detailsFilter){const e=t.list.detailsFilter(),a="string"==typeof e?e:me(e);r=l.query.filter?`(${a}) and (${l.query.filter})`:a}const d={$filter:r||void 0,$orderby:l.query.orderby||void 0,$skip:p>0?p*f:void 0,$top:f,$count:!0};I.value=await function(e,t){const a=O();return(0,o.entityLoadCollection)(e,m,{Authorization:a.jwt},t)}(g,d),T.value=I.value?.["@odata.count"];const N=t.list.fields.find((e=>e.primary)).name;for(const e of g.values()){const a=La(t.list,t.list.form.fields(e)).filter((e=>!y.value.some((t=>t.name===e.name))&&"function"==typeof wt[e.type]?.getEntityValue)),l=(0,o.useValidations)(),{errorMessage:i,clean:r}=t.list.form.rules?l.createValidation("formRules",{rules:t.list.form.rules}):{};C.run((()=>{l.createField(N,(0,n.computed)((()=>e[N])));for(const t of a)l.createField(t.name,(0,n.computed)((()=>wt[t.type].getEntityValue(t,e))))})),b.push({entity:e,hasPendingChanges:!1,validations:l,errorMessage:i,clean:r})}s.value=!1,u.loadEnd(`list/${t.list.name}/load`)}));const N=(0,n.computed)((()=>(0,o.entityHasPendingChanges)(g)?[{text:"Guardar",icon:"Save",action:E},{text:"Reiniciar",icon:"Refresh",action:()=>{(0,o.entitySyncData)(g,I.value.value);for(const e of b)e.clean(),e.hasPendingChanges=(0,o.entityHasPendingChanges)(e.entity)}},{text:"Tornar",icon:"Back",action:()=>{u.confirm({title:"Alerta!",message:"Hi han canvis sense guardar. Aquests canvis es perdràn. Voleu continuar?.",accept(){a.push({path:`/${t.list.name}/view/query/${c}`,query:l.query})}})}}]:[{text:"Tornar",icon:"Back",action:()=>{a.push({path:`/${t.list.name}/view/query/${c}`,query:l.query})}}])),h=(0,n.computed)((()=>{const e=[{text:c??"",disabled:!0}];return t.list.filter&&e.push({icon:"Filter",disabled:!0}),e}));async function _({index:e,field:t,action:a}){const n=b[e];if(a(n.entity),"function"==typeof t.onChange){const e=await t.onChange(n.entity);"function"==typeof e&&e(n.entity)}n.hasPendingChanges=(0,o.entityHasPendingChanges)(n.entity),n.clean()}function E(){return sn((async()=>await Promise.all(b.map((async(e,t)=>{e.hasPendingChanges&&await e.validations.validate(e.entity)&&(await Je(e.entity),(0,o.entityConsolidate)(e.entity),e.hasPendingChanges=!1,I.value.value[t]=(0,o.entityData)(e.entity))})))))}async function P(e){const t=b[e];await t.validations.validate(t.entity)&&await sn((async()=>{await Je(t.entity),(0,o.entityConsolidate)(t.entity),t.hasPendingChanges=!1,I.value.value[e]=(0,o.entityData)(t.entity)}))}function S(e){const t=b[e];t.clean(),(0,o.entitySyncData)(t.entity,I.value.value[e]),t.hasPendingChanges=(0,o.entityHasPendingChanges)(t.entity)}return(t,a)=>{const i=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)((0,n.unref)(V),{subtitle:e.list.label},{default:(0,n.withCtx)((()=>[s.value?(0,n.createCommentVNode)("v-if",!0):((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Fn),{key:0,list:e.list,"menu-item":N.value,"menu-view":h.value,fields:y.value,elements:b,orderby:(0,n.unref)($a)((0,n.unref)(l).query.orderby),"page-size":(0,n.unref)(f),"current-page":(0,n.unref)(p),"elements-count":T.value,onUpdate:_,onSave:P,onReset:S},null,8,["list","menu-item","menu-view","fields","elements","orderby","page-size","current-page","elements-count"]))])),_:1},8,["subtitle"]),(0,n.createVNode)(i)],64)}}},Mn={__name:"filter-form-combo",props:{field:{type:Object,required:!0},cacheName:{type:String,default:""},modelValue:{type:void 0,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,i=At(),o=(0,n.shallowRef)([]);return(0,n.watchEffect)((()=>{o.value=(i.data[a.cacheName]?.[a.field.name]||[]).map((e=>({value:e[a.field.valueKey||"value"],text:e[a.field.textKey||"text"]})))})),(t,a)=>{const i=(0,n.resolveComponent)("fura-combo-box");return(0,n.openBlock)(),(0,n.createBlock)(i,{label:e.field.label,options:o.value,multiple:e.field.multiple,"model-value":e.modelValue,"onUpdate:modelValue":a[0]||(a[0]=e=>l("update:modelValue",e))},null,8,["label","options","multiple","model-value"])}}},xn={__name:"filter-form-csv",props:{field:{type:Object,required:!0},cacheName:{type:String,default:""},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)({get:()=>Array.isArray(a.modelValue)?a.modelValue.join():"",set(e){const t=e.split(",");e.length>0?l("update:modelValue",t):l("update:modelValue",void 0)}});return(t,a)=>{const l=(0,n.resolveComponent)("fura-text-field");return(0,n.openBlock)(),(0,n.createBlock)(l,{label:e.field.label,modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e)},null,8,["label","modelValue"])}}},Rn={key:3},wn={key:6,class:"filterForm-multiple"},Bn={__name:"filter-form",props:{fields:{type:Array,required:!0},modelValue:{type:Array,required:!0},cacheName:{type:String,default:""}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t;function i(e){return a.modelValue.find((t=>t[0]===e.name))?.[1]}function o(e,t){if(null==t||""===t||Array.isArray(t)&&0===t.length)l("update:modelValue",a.modelValue.filter((t=>t[0]!==e.name)));else{const n=a.modelValue.findIndex((t=>t[0]===e.name));l("update:modelValue",-1===n?[...a.modelValue,[e.name,t]]:[...a.modelValue.slice(0,n),[e.name,t],...a.modelValue.slice(n+1)])}}return(t,a)=>{const r=(0,n.resolveComponent)("fura-text-field"),d=(0,n.resolveComponent)("fura-number-field"),u=(0,n.resolveComponent)("fura-date-picker"),s=(0,n.resolveComponent)("fura-checkbox"),c=(0,n.resolveComponent)("FilterForm",!0);return(0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.fields,(t=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:t.name},["text"===t.type?((0,n.openBlock)(),(0,n.createBlock)(r,{key:0,label:t.label,"model-value":i(t),"onUpdate:modelValue":e=>o(t,e)},null,8,["label","model-value","onUpdate:modelValue"])):"number"===t.type?((0,n.openBlock)(),(0,n.createBlock)(d,{key:1,label:t.label,"model-value":i(t),"onUpdate:modelValue":e=>o(t,e)},null,8,["label","model-value","onUpdate:modelValue"])):"date"===t.type?((0,n.openBlock)(),(0,n.createBlock)(u,{key:2,label:t.label,"model-value":i(t),"onUpdate:modelValue":e=>o(t,e)},null,8,["label","model-value","onUpdate:modelValue"])):"checkbox"===t.type?((0,n.openBlock)(),(0,n.createElementBlock)("div",Rn,[(0,n.createVNode)(s,{class:"filterForm-checkbox",label:t.label,"model-value":i(t),"onUpdate:modelValue":e=>o(t,!!e&&null),indeterminate:"boolean"!=typeof i(t),"onUpdate:indeterminate":e=>o(t,!0)},null,8,["label","model-value","onUpdate:modelValue","indeterminate","onUpdate:indeterminate"])])):"combo"===t.type?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(Mn),{key:4,field:t,"cache-name":e.cacheName,"model-value":i(t),"onUpdate:modelValue":e=>o(t,e)},null,8,["field","cache-name","model-value","onUpdate:modelValue"])):"csv"===t.type?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(xn),{key:5,field:t,"model-value":i(t),"onUpdate:modelValue":e=>o(t,e)},null,8,["field","model-value","onUpdate:modelValue"])):Array.isArray(t)?((0,n.openBlock)(),(0,n.createElementBlock)("div",wn,[(0,n.createVNode)(c,{fields:t,"model-value":e.modelValue,"onUpdate:modelValue":a[0]||(a[0]=e=>l("update:modelValue",e))},null,8,["fields","model-value"])])):(0,n.createCommentVNode)("v-if",!0)],64)))),128)}}},Ln=(0,F.Z)(Bn,[["__scopeId","data-v-3a975916"]]),kn={key:0,class:"filterGroups"},$n=["onClick"],Un={class:"content fura-slideDownIn20"},qn={class:"actions"},Gn={__name:"list-details-filter-panel",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=At(),{expanded:o,updateExpanded:d}=Za("expanded");i.setContextName(t.list.name),i.load(t.list.name);const u=La(t.list,t.list.filter),s=[],c=[],m=[];for(const e of u)if(e.type in wt){const t=wt[e.type],a=t.getFilterCondition?.(e,u);a&&s.push(a);const n=t.getFilterInterface?.(e,u);if(n)if(e.filterGroup){const t=m.find((t=>t.name===e.filterGroup));t?t.fields.push(n):m.push({name:e.filterGroup,fields:[n]})}else c.push(n)}const p=new ve(s,"and");console.log("filterManager",a.query.filter);const f=(0,n.ref)(a.query.filter?p.readFilter(a.query.filter):[]);function y(){l.push({path:`/${t.list.name}/view/query/${a.params.viewName}`,query:{...a.query,filter:p.writeFilter(f.value)||void 0,selectedItemId:void 0,page:void 0}})}function v(){l.push({path:`/${t.list.name}/view/query/${a.params.viewName}`,query:{...a.query,filter:void 0}})}function A(){l.push({path:`/${t.list.name}/view/query/${a.params.viewName}`,query:a.query})}function I(e){return Array.isArray(o.value)?o.value.includes(e.name):o.value===e.name}const g=(0,n.ref)();return(0,n.onMounted)((()=>{const e=g.value.querySelector('input, select, textarea, [tabindex]:not([tabindex="-1"])');e?.focus()})),(t,a)=>{const l=(0,n.resolveComponent)("fura-icon"),i=(0,n.resolveComponent)("fura-button"),r=(0,n.resolveComponent)("fura-panel"),u=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)(u,{fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("form",{onSubmit:(0,n.withModifiers)(y,["prevent"])},[(0,n.createVNode)(r,{type:"medium","header-text":`Filtrar ${e.list.label}`,onClick:A},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",qn,[(0,n.createVNode)(i,{primary:"",text:"Cerca",icon:"Filter","form-role":"submit"}),(0,n.createVNode)(i,{class:"clearFilter",primary:"",text:"Esborra el filtre",icon:"ClearFilter",onClick:v}),(0,n.createVNode)(i,{text:"Cancela",icon:"Cancel",onClick:A})])])),default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",{ref_key:"fieldsContainer",ref:g},[m.length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",kn,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(m,(t=>(0,n.createElementVNode)("div",{key:t.name,class:(0,n.normalizeClass)(["item",{expanded:I(t)}])},[t.name?((0,n.openBlock)(),(0,n.createElementBlock)("button",{key:0,class:"title",type:"button",onClick:(0,n.withModifiers)((e=>function(e){I(e)?Array.isArray(o.value)?d(o.value.filter((t=>t!==e.name))):d(null):Array.isArray(o.value)?d([...o.value,e.name]):o.value?d([o.value,e.name]):d(e.name)}(t)),["stop"])},[(0,n.createVNode)(l,{class:"expanderIcon",name:"ChevronDown"}),(0,n.createTextVNode)(" "+(0,n.toDisplayString)(t.name),1)],8,$n)):(0,n.createCommentVNode)("v-if",!0),(0,n.createElementVNode)("div",Un,[(0,n.createVNode)((0,n.unref)(Ln),{fields:t.fields,"cache-name":e.list.name,modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e)},null,8,["fields","cache-name","modelValue"])])],2))),64))])):(0,n.createCommentVNode)("v-if",!0),(0,n.createVNode)((0,n.unref)(Ln),{fields:c,"cache-name":e.list.name,modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e)},null,8,["cache-name","modelValue"])],512)])),_:1},8,["header-text"])],32)])),_:1})}}},Kn=(0,F.Z)(Gn,[["__scopeId","data-v-a75f6888"]]);function jn(e){const t=String(e??"");return t.includes('"')||t.includes(";")||t.includes("\n")?`"${t.replaceAll('"','""')}"`:t}async function zn(e,t){const a=[];for(const n of t){const t=[];for(const a of e)if("function"==typeof wt[a.type]?.getCsvValueFromEntity){const e=jn(await wt[a.type].getCsvValueFromEntity(a,n));t.push(e)}else t.push("");a.push(t)}return a}function Hn(){const e=(e,t=2)=>e.toString().padStart(t,"0"),t=new Date(Date.now());return`${e(t.getDate())}/${e(t.getMonth()+1)}/${e(t.getFullYear(),4)}`}const Wn={class:"dialogAlert-close"},Yn={__name:"list-details-export",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=vn(),o=(0,n.ref)(null),d=(0,n.ref)(),u=(0,n.computed)((()=>"pdf"===a.query.format?`${t.list.label}.pdf`:"excel"===a.query.format?`${t.list.label}.csv`:`${t.list.label}.txt`));function s(){l.back()}async function c(e,n){return"pdf"===a.query.format?await async function(e,t,{title:a}){Fa?.pdfMake&&(Da.vfs=Fa.pdfMake.vfs);const n=await async function(e,t){const a=[];for(const n of t){const t=[];for(const a of e)if("function"==typeof wt[a.type]?.getTextValueFromEntity){const e=await wt[a.type].getTextValueFromEntity(a,n);t.push(e)}else t.push("");a.push(t)}return a}(e,t),l={pageSize:"A4",pageMargins:[30,60,30,30],pageOrientation:"landscape",header:(e,t)=>({margin:[30,30,20,0],columns:[{text:"Assignació places NEE",width:165,alignment:"left"},{text:a,width:"*",style:"tableHeaderCenter"},{table:{widths:["auto","auto"],body:[[{text:"Pàg.",alignment:"left"},{text:e+" de "+t,alignment:"right"}],[{text:"Data",alignment:"left"},{text:Hn(),alignment:"right"}]]},layout:"noBorders",width:"80",style:"tableHeaderRight"}]}),content:[{table:{headerRows:1,dontBreakRows:!0,border:"none",body:[e.map((e=>({text:e.label,bold:!0,alignment:e.align||"left"}))),...n.map((t=>t.map(((t,a)=>({text:t,align:e[a].align||"left"})))))]},layout:"noBorders",margin:[0,5,0,5]}],styles:{tableHeader:{bold:!0},tableHeaderCenter:{bold:!0,alignment:"center"},tableHeaderRight:{bold:!0,alignment:"right"},boldFirst:{bold:!0,margin:[0,6,0,0]},bold:{bold:!0},normal:{bold:!1}},defaultStyle:{fontSize:9}};return await new Promise((e=>{Da.createPdf(l).getDataUrl(e)}))}(e,n,{title:t.list.label}):"excel"===a.query.format?await async function(e,t){const a=[e.map((e=>jn(e.label))),...await zn(e,t)].map((e=>e.join(";"))).join("\n");return"data:text/csv;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent("\ufeff"+a+"\n")))}(e,n):void 0}return(0,n.onMounted)((async()=>{await i.loadViews(t.list.name);const e=i.definitions.find((e=>e[v]===a.params.viewName)),l=Array.from(e[A].fields).map((e=>t.list.fields.find((t=>t.name===e)))).filter((e=>e)),r={...we(l),$filter:a.query.filter||void 0,$orderby:a.query.orderby||void 0},u=await xe(t.list.name,r);o.value=await c(l,u.value),await(0,n.nextTick)(),d.value.$el.click(),s()})),(e,t)=>{const a=(0,n.resolveComponent)("fura-button"),l=(0,n.resolveComponent)("fura-dialog"),i=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)(i,{class:"listExport-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{class:"listExport-dialog",header:"Exportació de dades",text:"Fitxer llest per descarregar."},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Wn,[o.value?((0,n.openBlock)(),(0,n.createBlock)(a,{key:0,ref_key:"download",ref:d,primary:"",text:"Descarrega",download:u.value,href:o.value,target:"_blank"},null,8,["download","href"])):(0,n.createCommentVNode)("v-if",!0),(0,n.createVNode)(a,{text:"Tancar",onClick:s})])])),_:1})])),_:1})}}},Zn=(0,F.Z)(Yn,[["__scopeId","data-v-392e43be"]]),Xn=e=>((0,n.pushScopeId)("data-v-33ad7bc8"),e=e(),(0,n.popScopeId)(),e),Jn={class:"list-view-fields"},Qn={class:"list-view-fields"},el=Xn((()=>(0,n.createElementVNode)("div",{class:"list-view-orderBy"},null,-1))),tl=Xn((()=>(0,n.createElementVNode)("div",{class:"list-view-aggregate"},null,-1))),al={__name:"list-view-simple-config",props:{fields:{type:Array,required:!0},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>{const{modelValue:e,fields:t}=a;return[{value:null,text:"",disabeld:!1},...t.map((t=>({value:t.name,text:t.label,disabled:e.some((e=>e.name===t.name))})))]}));function o(e){e&&l("update:modelValue",[...a.modelValue,{name:e,direction:null}])}function r(e){const t=a.fields.find((t=>t.name===e));return t&&t.orderby?t.orderby:[{value:"asc",text:"A -> Z"},{value:"desc",text:"Z -> A"}]}function d(e){const t=a.fields.find((t=>t.name===e)),n=wt[t.type];return n&&n.getAggregations?n.getAggregations(t).map((e=>({text:e.name,value:e.getExpression(t)}))):[]}return(t,u)=>{const s=(0,n.resolveComponent)("fura-dropdown"),c=(0,n.resolveComponent)("llesca-stack-draggable");return(0,n.openBlock)(),(0,n.createBlock)(c,{"primary-key":"name","model-value":e.modelValue,"onUpdate:modelValue":u[0]||(u[0]=e=>l("update:modelValue",e))},{default:(0,n.withCtx)((e=>[(0,n.createElementVNode)("div",Jn,[(0,n.createVNode)(s,{class:"list-view-field",options:i.value,"model-value":e.item.name,"onUpdate:modelValue":t=>function(e,t){const n=[...a.modelValue];t?n[e]={name:t,direction:n[e].direction}:n.splice(e,1),l("update:modelValue",n)}(e.index,t)},null,8,["options","model-value","onUpdate:modelValue"]),(0,n.createVNode)(s,{class:"list-view-orderBy",options:r(e.item.name),"model-value":e.item.direction,"onUpdate:modelValue":t=>function(e,t){const n=[...a.modelValue];n[e]={...n[e],direction:t},l("update:modelValue",n)}(e.index,t)},null,8,["options","model-value","onUpdate:modelValue"]),(0,n.createVNode)(s,{class:"list-view-aggregate",options:d(e.item.name),disabled:!d(e.item.name).length,"model-value":e.item.aggregation,"onUpdate:modelValue":t=>function(e,t){const n=[...a.modelValue];n[e]={...n[e],aggregation:t},l("update:modelValue",n)}(e.index,t)},null,8,["options","disabled","model-value","onUpdate:modelValue"])])])),footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Qn,[(0,n.createVNode)(s,{class:"list-view-field",options:i.value,"onUpdate:modelValue":o},null,8,["options"]),el,tl])])),_:1},8,["model-value"])}}},nl=(0,F.Z)(al,[["__scopeId","data-v-33ad7bc8"]]),ll={class:"layout"},il={class:"viewOptions"},ol={class:"actions"},rl={__name:"list-view-edit",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ve(),d=vn(),u=O(),s=(0,n.computed)((()=>a.params.viewName??null)),c=(0,n.computed)((()=>d.definitions.find((e=>e[v]===s.value))?.[f])),g=(0,n.computed)((()=>t.list.name));d.loadViews(g.value).then((()=>{if(s.value){const e=d.definitions.find((e=>e[v]===s.value));e||alert("error"),_(e)}}));const T=t.list.fields.filter((e=>e.label)),b=(0,n.reactive)({name:"",defaultView:!1,selectedFields:[],saveFilter:!1,nameErrorMessage:null,showErrorMessage:!1}),C=(0,n.computed)((()=>Ua(b.selectedFields.filter((e=>e.name)).map((e=>({sentence:Be(t.list.fields.find((t=>t.name===e.name))),direction:e.direction})))))),N=(0,n.computed)((()=>b.selectedFields.filter((e=>e.aggregation)).map((e=>e.aggregation)).join(","))),h=(0,n.computed)((()=>!d.definitions.some((e=>1===e[I]))||d.definitions[0][v]===b.name));function _(e={}){const a=e?.[A]?.fields??[],n=$a(e?.[A]?.orderby??"")??[],l=a.map((a=>{const l=t.list.fields.find((e=>e.name===a));return{name:a,direction:n.find((e=>e.sentence===Be(l)))?.direction,aggregation:ke(l,e?.[A]?.apply)}}));b.name=e?.[v]??"",b.defaultView=!!e?.[I],b.selectedFields=l,b.saveFilter=!1}async function E(){if(function(){let e=!0;return b.nameErrorMessage=null,b.showErrorMessage=!1,b.name?d.definitions.some((e=>e[f]!==c.value&&e[v]===b.name))&&(e=!1,b.nameErrorMessage="Ja existeix una visualització amb aquest nom."):(e=!1,b.nameErrorMessage="Cal posar un nom a la visualització,"),0===b.selectedFields.length&&(e=!1,b.showErrorMessage=!0),e}()){const e=b.defaultView?d.definitions.filter((e=>e[I])).map((e=>({atomicityGroup:"saveView",id:`saveView-patch${e[f]}`,method:"PATCH",url:`/${p}(${e[f]})`,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:u.jwt},body:{[I]:0}}))):[];e.push(function(){const e=d.definitions.find((e=>e[v]===s.value));if(null!==s.value&&!e)throw new Error("La vista a actualitzar no s'ha trobat.");const[t,n,l]=void 0===e?["saveView-post","POST",`/${p}`]:[`saveView-put-${e[f]}`,"PUT",`/${p}(${e[f]})`];return{atomicityGroup:"saveView",id:t,method:n,url:l,headers:{"Content-Type":"application/json",Authorization:u.jwt},body:{[f]:e?.[f],[y]:g.value,[v]:b.name,VIEWTYPE:"list",[A]:JSON.stringify({fields:b.selectedFields.filter((e=>e.name)).map((e=>e.name)),orderby:C.value,filter:b.saveFilter?a.query.filter||void 0:e?.[A].filter,apply:N.value}),[I]:h.value||b.defaultView?1:0}}}()),await async function(e){let t=!0;i.loadStart(`list/${g.value}/list-edit/save`);const{responses:a}=await function(e,t,a,n={},{withoutDialog:l=!1}={}){return Me(Symbol("requestPost"),(()=>o.odata.requestPost([m,e].flat(),t,a,{Authorization:O().jwt,...n})),l)}("$batch",{requests:e});return a.some((e=>201!==e.status&&204!==e.status))&&(i.alert({title:"Error",message:"Error inesperat"}),t=!1),i.loadEnd(`list/${g.value}/list-edit/save`),t}(e)&&(await d.loadViews(g.value,!0),l.push({path:`/${g.value}/view/query/${b.name}`,query:{orderby:C.value,filter:d.definitions.find((e=>e[v]===b.name))?.[A].filter,apply:N.value}}))}}function P(){i.confirm({title:"Alerta!",message:"Esteu segurs de que voleu esborrar aquesta visualització?. Aquesta acció no es pot desfer.",accept:async()=>{await Re(`${p}(${c.value})`),await d.loadViews(g.value,!0),l.push(`/${g.value}`)}})}function S(){_(d.definitions.find((e=>e[v]===s.value)))}function D(){a.query.return?l.push(a.query.return):l.push(`/${g.value}/view/query/${b.name}`)}return(t,a)=>{const l=(0,n.resolveComponent)("fura-label"),i=(0,n.resolveComponent)("fura-separator"),o=(0,n.resolveComponent)("fura-text-field"),r=(0,n.resolveComponent)("fura-checkbox"),d=(0,n.resolveComponent)("fura-button"),u=(0,n.resolveComponent)("fura-message-bar");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"baseLayout",subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",ll,[(0,n.createVNode)(i,{class:"separatorLlista","align-content":"center"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Llista")])),_:1})])),_:1}),(0,n.createVNode)(o,{required:"",name:"name",class:"name",label:"Nom de la visualització","error-message":b.nameErrorMessage,modelValue:b.name,"onUpdate:modelValue":[a[0]||(a[0]=e=>b.name=e),a[1]||(a[1]=e=>b.nameErrorMessage=null)]},null,8,["error-message","modelValue"]),(0,n.createElementVNode)("div",il,[(0,n.createVNode)(r,{name:"defaultView",label:"Visualització per defecte",disabled:h.value,"model-value":h.value||b.defaultView,"onUpdate:modelValue":a[2]||(a[2]=e=>b.defaultView=e)},null,8,["disabled","model-value"]),(0,n.createVNode)(r,{name:"saveFilter",label:"Guardar el filtre actual",modelValue:b.saveFilter,"onUpdate:modelValue":a[3]||(a[3]=e=>b.saveFilter=e)},null,8,["modelValue"])]),(0,n.createVNode)(i,{class:"separatorColumnes","align-content":"center"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Columnes")])),_:1})])),_:1}),(0,n.createVNode)((0,n.unref)(nl),{class:"fields",fields:(0,n.unref)(T),modelValue:b.selectedFields,"onUpdate:modelValue":[a[4]||(a[4]=e=>b.selectedFields=e),a[5]||(a[5]=e=>b.showErrorMessage=!1)]},null,8,["fields","modelValue"]),(0,n.createElementVNode)("div",ol,[(0,n.createVNode)(d,{primary:"",text:"Guardar",icon:"Save",onClick:E}),(0,n.createVNode)(d,{text:"Tornar",icon:"Back",onClick:D}),(0,n.createVNode)(d,{text:"Reiniciar",icon:"Refresh",onClick:S}),null!==s.value?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,primary:"",class:"remove",text:"Eliminar",icon:"Delete",onClick:P})):(0,n.createCommentVNode)("v-if",!0)]),b.showErrorMessage?((0,n.openBlock)(),(0,n.createBlock)(u,{key:0,class:"errorMessage",type:"error",dismiss:"",onDismiss:a[6]||(a[6]=e=>b.showErrorMessage=!1)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Cal seleccionar alguna columna. ")])),_:1})):(0,n.createCommentVNode)("v-if",!0)])])),_:1},8,["subtitle"])}}},dl=(0,F.Z)(rl,[["__scopeId","data-v-42048c76"]]);function ul(e,t){const a=(0,n.ref)(!1),l=Xe((0,n.unref)(e)),i=(0,n.ref)();return(0,n.watch)((()=>(0,n.unref)(t)),(async t=>{a.value=!1,null!=t?await function(e,t){const a=O();return(0,o.entityLoad)(e,m,{Authorization:a.jwt},t)}(l,t):Le((0,n.unref)(e),l),i.value=(0,o.entityData)(l,{depth:0}),a.value=!0}),{immediate:!0}),{entityLoaded:a,entity:l,initialData:i,resetEntity(){for(const e in i.value)l[e]=i.value[e]},entitySave(){Je(l)},entityDelete(){Qe(l)}}}const sl={__name:"list-item-edit",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ve(),d=(0,o.useValidations)(),u=At(),{goBack:s}=Ja(),{sendMessage:c,close:m}=ha(),{itemId:p}=Ya("itemId",{parse:e=>null!=e?Number(e):null,stringify:e=>null!=e?String(e):void 0}),{tabName:f}=Ya("tabName"),{popup:y}=Za("popup");u.setContextName(t.list.name),u.load(t.list.name);const{entityLoaded:v,entity:A,resetEntity:I}=ul(t.list,p);let g=!1;const T=(0,n.ref)({});(0,n.watch)(v,(e=>{e&&(T.value=t.list.permissionDenied?.(A)??{},g&&(0,n.nextTick)((()=>{g=!1,dn(A)})))}),{immediate:!0});const b=(0,n.computed)((()=>null==p.value?!T.value.create:!T.value.edit));on(),(0,n.onMounted)((()=>{v.value?dn(A):g=!0})),(0,n.onUnmounted)(rn);const O=t.list.fields.find((e=>e.primary)).name,C=(0,n.computed)((()=>A[O]));d.createField(O,C);const N=(0,n.computed)((()=>t.list.form.tabs?.map((e=>({text:e.title,value:e.name,icon:e.icon,count:e.count})))??[]));function h(e){e(A)}function _(e){l.push({path:null==p.value?`/${t.list.name}/create/tab/${e}`:`/${t.list.name}/edit/${p.value}/tab/${e}`,query:{return:a.query.return,popup:y.value}})}async function E(){await d.validate(A)&&await sn((async()=>{await Je(A),s(`/${t.list.name}`,null,{reload:!0})}))}async function P(){await d.validate(A)&&await sn((async()=>{await Je(A),c({action:"save"}),m()}))}function S(){i.confirm({title:"Alerta!",message:"Esteu segurs de que voleu desfer els canvis realitzats?.",accept(){I(),(0,n.nextTick)((()=>dn(A)))}})}function D(){i.confirm({title:"Alerta!",message:"Esteu segurs de que voleu esborrar aquest element?. Aquesta acció no es pot desfer.",async accept(){await sn((async()=>{await Qe(A),s(`/${t.list.name}`,null,{reload:!0})}))}})}return(t,a)=>{const l=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"itemListEdit-container",subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.unref)(v)?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(w),{key:0,tabs:N.value,"current-tab":(0,n.unref)(f),"max-width":e.list.form.maxWidth,"self-aling":e.list.form.selfAlign,"has-save":b.value&&void 0===(0,n.unref)(y),"has-save-and-close":b.value&&void 0!==(0,n.unref)(y),"has-reset":"","has-remove":null!==(0,n.unref)(p)&&!T.value.delete,"has-go-back":void 0===(0,n.unref)(y),"has-close":void 0!==(0,n.unref)(y),"onUpdate:currentTab":_,onSave:E,onSaveAndClose:P,onReset:S,onRemove:D,onGoBack:a[0]||(a[0]=t=>(0,n.unref)(s)(`/${e.list.name}`)),onClose:(0,n.unref)(m)},{default:(0,n.withCtx)((()=>["auto"===e.list.form.component?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(un),{key:0,list:e.list,form:e.list.form,entity:(0,n.unref)(A),validations:(0,n.unref)(d),onChange:h},null,8,["list","form","entity","validations"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(e.list.form.component),{key:1,entity:(0,n.unref)(A),validations:(0,n.unref)(d),onChange:h},null,40,["entity","validations"]))])),child:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{entity:(0,n.unref)(A),validations:(0,n.unref)(d),onChange:h},null,8,["entity","validations"])])),_:1},8,["tabs","current-tab","max-width","self-aling","has-save","has-save-and-close","has-remove","has-go-back","has-close","onClose"])):(0,n.createCommentVNode)("v-if",!0)])),_:1},8,["subtitle"])}}},cl=(0,F.Z)(sl,[["__scopeId","data-v-e1f6c376"]]),ml={__name:"list-item-tab-subform",props:{list:{type:Object,required:!0},subform:{type:Object,required:!0},entity:{type:Object,required:!0},validations:{type:Object,required:!0}},emits:["change"],setup(e){const t=e,a=(0,n.computed)((()=>t.list.entityName||t.list.name)),l=(0,n.computed)((()=>La(t.list,t.subform.fields(t.entity))));return(t,i)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(e.subform.class)},[(0,n.createVNode)((0,n.unref)(nn),{"with-area-name":"",fields:l.value,entity:e.entity,validations:e.validations,"cache-name":a.value,onChange:i[0]||(i[0]=e=>t.$emit("change",e.action))},null,8,["fields","entity","validations","cache-name"])],2))}},pl={key:0},fl={class:"cellactions"},yl={key:0},vl={key:1},Al={__name:"details-view-edit",props:{fields:{type:Array,default:()=>[]},data:{type:Array,required:!0},orderby:{type:Array,default:()=>[]},forcedOrder:{type:Boolean,default:!1},autoLayout:{type:String,default:null},compact:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1}},emits:["edit","create","update:orderby","clickCell"],setup(e,{emit:t}){const a=e,l=t,i=(0,n.computed)((()=>[...a.readonly?[]:[{key:"actions",width:"25px"}],...a.fields.map(((e,t)=>{if(e.primary)return null;{const n=Be(e),l=a.orderby.find((e=>e.sentence===n));return{index:t,type:e.type,title:e.label,icon:ka(l),width:e.detailsColumn?.width,align:e.detailsColumn?.align}}}))]));function o(e){const{index:t}=i.value[e];if(null!=t){const n=Be(a.fields[t]);if(n){const t=a.orderby.map((e=>({...e}))),i=t.findIndex((e=>e.sentence===n));if(i>-1){const e=t[i];"asc"===e.direction?e.direction="desc":"desc"===e.direction?a.forcedOrder?e.direction="asc":t.splice(i,1):"none"===e.direction&&(e.direction="asc")}else{const l=t.map((e=>a.fields.findIndex((t=>Be(t)===e.sentence))));if(l.every((e=>-1===e)))t.push({sentence:n,direction:"asc"});else{const a=[...l.entries()].filter((e=>e[1]>-1)).reduce(((t,a)=>!t||Math.abs(e-a[1])<Math.abs(e-t[1])?a:t),null),i=a[1]<e?a[0]+1:a[0];t.splice(i,0,{sentence:n,direction:"asc"})}}l("update:orderby",t)}}}return(t,a)=>{const r=(0,n.resolveComponent)("fura-button"),d=(0,n.resolveComponent)("fura-details-list");return(0,n.openBlock)(),(0,n.createBlock)(d,{columns:i.value,data:e.data,"auto-layout":e.autoLayout,compact:e.compact,onClickHeader:o,onClickCell:a[1]||(a[1]=e=>l("clickCell",e))},{default:(0,n.withCtx)((a=>[(0,n.createCommentVNode)("\n        @slot Contenido de una celda.\n        @binding {number} rowIndex Índice de la fila.\n        @binding {number} columnIndex Índice de la definición de la columna.\n        @binding {string} content Contenido de la celda.\n        @binding {object} column Referencia a la definición de la columna.\n      "),(0,n.renderSlot)(t.$slots,"default",{rowIndex:a.rowIndex,row:e.data[a.rowIndex],columnIndex:a.columnIndex,column:a.column,content:a.content},(()=>["actions"===a.column.key?((0,n.openBlock)(),(0,n.createElementBlock)("div",pl,[(0,n.createElementVNode)("div",fl,[(0,n.createVNode)(r,{type:"icon",icon:"Edit",onClick:e=>l("edit",a.rowIndex)},null,8,["onClick"])])])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)((0,n.unref)(wt)[a.column.type].detailsCell),{key:1,field:e.fields[a.column.index],row:e.data[a.rowIndex]},null,8,["field","row"]))]))])),header:(0,n.withCtx)((e=>[(0,n.createCommentVNode)("\n        @slot Contenido de una cabecera.\n        @binding {object} column Referencia a la definición de la columna.\n        @binding {number} index Índice de la definición de la columna.\n      "),(0,n.renderSlot)(t.$slots,"header",{column:e.column,index:e.index})])),bodyHeader:(0,n.withCtx)((e=>[(0,n.createCommentVNode)("\n        @slot Contenido de una celda de un encabezado de cuerpo.\n        @binding {number} groupIndex Índice de la definición del grupo.\n        @binding {object} group Referencia a la definición del grupo.\n        @binding {number} columnIndex Índice de la definición de la columna.\n        @binding {object} column Referencia a la definición de la columna.\n        @binding {Array} data Datos del grupo.\n      "),(0,n.renderSlot)(t.$slots,"bodyHeader",{groupIndex:e?.groupIndex,group:e?.group,columnIndex:e?.columnIndex,column:e?.column,data:e?.data})])),bodyFooter:(0,n.withCtx)((i=>[(0,n.createCommentVNode)("\n        @slot Contenido de una celda de un pie de cuerpo.\n        @binding {number} groupIndex Índice de la definición del grupo.\n        @binding {object} group Referencia a la definición del grupo.\n        @binding {number} columnIndex Índice de la definición de la columna.\n        @binding {object} column Referencia a la definición de la columna.\n        @binding {Array} data Datos del grupo.\n      "),(0,n.renderSlot)(t.$slots,"bodyFooter",{groupIndex:i?.groupIndex,group:i?.group,columnIndex:i?.columnIndex,column:i?.column,data:i?.data},(()=>["actions"!==i?.column?.key||e.readonly?((0,n.openBlock)(),(0,n.createElementBlock)("div",vl)):((0,n.openBlock)(),(0,n.createElementBlock)("div",yl,[(0,n.createVNode)(r,{type:"icon",icon:"Add",onClick:a[0]||(a[0]=e=>l("create"))})]))]))])),_:3},8,["columns","data","auto-layout","compact"])}}},Il={__name:"list-item-tab-details",props:{list:{type:Object,required:!0},child:{type:Object,required:!0},entity:{type:Object,required:!0}},emits:["change"],setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),{orderby:i,updateOrderby:o}=Za("orderby",{parse:$a,stringify:Ua}),d=(0,n.computed)((()=>Ba(t.child.listName))),u=(0,n.computed)((()=>t.child.fields.map((e=>d.value.fields.find((t=>t.name===e)))).filter((e=>e)))),s=(0,n.computed)((()=>t.entity[t.child.navigationKey||t.child.listName])),{sortedData:c}=tn(s,i);function m(){const e=a.params.itemId,n=a.params.tabName;l.push({path:null==e?`/${t.list.name}/create/tab/${n}/create`:`/${t.list.name}/edit/${e}/tab/${n}/create`,query:a.query})}function p(e){const n=a.params.itemId,i=a.params.tabName;l.push({path:null==n?`/${t.list.name}/create/tab/${i}/edit/${e}`:`/${t.list.name}/edit/${n}/tab/${i}/edit/${e}`,query:a.query})}return(a,l)=>{const r=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)((0,n.unref)(Al),{fields:u.value,data:(0,n.unref)(c),orderby:(0,n.unref)(i),"auto-layout":e.child.autoLayout,readonly:e.child.readonly||!e.child.form,compact:"",onCreate:m,onEdit:p,"onUpdate:orderby":l[0]||(l[0]=e=>(0,n.unref)(o)(e))},null,8,["fields","data","orderby","auto-layout","readonly"]),(0,n.createVNode)(r,{list:e.list,entity:t.entity,onChange:l[1]||(l[1]=e=>a.$emit("change",e))},null,8,["list","entity"])],64)}}},gl={__name:"list-item-tab",props:{list:{type:Object,required:!0},entity:{type:Object,required:!0},validations:{type:Object,required:!0}},emits:["change"],setup(e,{emit:t}){const a=e,l=t,{tabName:i}=Ya("tabName"),o=(0,n.computed)((()=>a.list.form.tabs.find((e=>e.name===i.value))));return(t,a)=>"child"===o.value.type?((0,n.openBlock)(),(0,n.createBlock)(Il,{key:0,list:e.list,child:o.value,entity:e.entity,onChange:a[0]||(a[0]=e=>l("change",e))},null,8,["list","child","entity"])):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},["auto"===o.value.component?((0,n.openBlock)(),(0,n.createBlock)(ml,{key:0,list:e.list,subform:o.value,entity:e.entity,validations:e.validations,onChange:a[1]||(a[1]=e=>l("change",e))},null,8,["list","subform","entity","validations"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(o.value.component),{key:1,list:e.list,child:o.value,entity:e.entity,validations:e.validations,onChange:a[2]||(a[2]=e=>l("change",e))},null,40,["list","child","entity","validations"]))],64))}},Tl={__name:"list-item-tab-child",props:{list:{type:Object,required:!0},entity:{type:Object,required:!0},splitted:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){(0,n.useCssVars)((e=>({"4c00a527":E.value})));const a=e,l=t,i=(0,r.useRoute)(),d=(0,r.useRouter)(),u=Ve(),s=(0,o.useValidations)(),{sendMessage:c}=ha(),m=(0,n.ref)(!1),{itemId:p}=Ya("itemId",{parse:e=>null!=e?Number(e):null}),{childId:f}=Ya("childId",{parse:e=>e?Number(e):null,handleLeave:!0}),{tabName:y}=Ya("tabName"),{popup:v}=Za("popup"),A=(0,n.computed)((()=>a.list.permissionDenied?.(a.entity)??{})),I=(0,n.computed)((()=>null==p.value?!A.value.create:!A.value.edit)),g=(0,n.computed)((()=>a.list.form.tabs.find((e=>e.name===y.value)))),T=(0,n.computed)((()=>Ba(g.value.listName))),b=(0,n.ref)({}),O=(0,n.getCurrentScope)();function C(e){const t=g.value.navigationKey||g.value.listName;null==e?(b.value=a.entity[t].create(),Le(T.value,b.value,{notOverwrite:!0})):b.value=(0,o.entityClone)(a.entity[t][e],{scope:O}),m.value&&(0,n.nextTick)((()=>dn(b.value)))}on(),(0,n.onMounted)((()=>{m.value=!0,C(f.value)})),(0,n.onUnmounted)(rn);const N=a.list.fields.find((e=>e.primary)).name,h=(0,n.computed)((()=>b.value[N]));s.createField(N,h);const _=(0,n.computed)((()=>null===f.value?"Entrada nou element":"Modificació")),E=(0,n.computed)((()=>g.value.form.maxWidth));function P(e){e(b.value)}async function S(){if(await s.validate(b.value)){const e=g.value.navigationKey||g.value.listName;return a.splitted?await sn((async()=>{if(await Je(b.value),null==f.value){const e=g.value.navigationKey||g.value.listName;a.entity[e].add(b.value)}void 0!==v.value&&c({action:"save"})})):null==f.value?l("change",(t=>{t[e].add(b.value)})):l("change",(t=>{(0,o.entitySyncState)(t[e][f.value],b.value)})),!0}return!1}function D(){m.value=!1,(0,n.nextTick)((()=>d.push({path:null===p.value?`/${a.list.name}/create/tab/${y.value}`:`/${a.list.name}/edit/${p.value}/tab/${y.value}`,query:i.query})))}async function F(){await S()&&D()}async function V(){await S()&&(d.push({path:null===p.value?`/${a.list.name}/create/tab/${y.value}/create`:`/${a.list.name}/edit/${p.value}/tab/${y.value}/create`,query:i.query}),C())}function M(){u.confirm({title:"Alerta!",message:"Esteu segurs de que voleu desfer els canvis realitzats?.",accept(){C(f.value)}})}function x(){u.confirm({title:"Alerta!",message:"Esteu segurs de que voleu esborrar aquest element?. Aquesta acció no es pot desfer.",async accept(){const e=g.value.navigationKey||g.value.listName;a.splitted?await sn((async()=>{await Qe(b.value)})):l("change",(t=>{t[e].delete(f.value)})),D()}})}return(e,t)=>{const a=(0,n.resolveComponent)("fura-dialog"),l=(0,n.resolveComponent)("fura-overlay"),i=(0,n.resolveComponent)("fura-modal");return(0,n.openBlock)(),(0,n.createBlock)(i,{open:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{class:"listItemEditTabChild-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[m.value?((0,n.openBlock)(),(0,n.createBlock)(a,{key:0,class:"listItemEditTabChild-dialog",header:_.value},{default:(0,n.withCtx)((()=>[(0,n.createVNode)((0,n.unref)(w),{"max-width":E.value,"self-aling":g.value.form.selfAlign,"has-save":I.value,"has-save-and-new":I.value,"has-reset":"","has-remove":null!==(0,n.unref)(f)&&(I.value||!A.value.delete),"has-go-back":"",onSave:F,onSaveAndNew:V,onReset:M,onRemove:x,onGoBack:D},{default:(0,n.withCtx)((()=>["auto"===g.value.form.component?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(un),{key:0,list:T.value,form:g.value.form,entity:b.value,validations:(0,n.unref)(s),onChange:P},null,8,["list","form","entity","validations"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(g.value.form.component),{key:1,entity:b.value,validations:(0,n.unref)(s),onChange:P},null,40,["entity","validations"]))])),_:1},8,["max-width","self-aling","has-save","has-save-and-new","has-remove"])])),_:1},8,["header"])):(0,n.createCommentVNode)("v-if",!0)])),_:1})])),_:1})}}},bl=(0,F.Z)(Tl,[["__scopeId","data-v-5697d378"]]),Ol={class:"dialogFooter"},Cl={__name:"list-item-delete",props:{list:{type:Object,required:!0}},setup(e){const t=e,a=(0,r.useRouter)(),l=(0,r.useRoute)(),{itemId:i}=Ya("itemId",{parse:e=>null!=e?Number(e):null,stringify:e=>null!=e?String(e):void 0});function o(){a.push({path:`/${t.list.name}/view/query/${l.query.viewName}`,query:{...l.query,viewName:void 0}})}return(r,d)=>{const u=(0,n.resolveComponent)("fura-button"),s=(0,n.resolveComponent)("fura-dialog"),c=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"itemListEdit-container","hide-menu":"",subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(c,{class:"modalOverlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(s,{class:"dialogMessage",type:"close",header:"Confirmació d'eliminació",text:"Esteu segurs que voleu esborrar l'element?",onClick:o},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ol,[(0,n.createVNode)(u,{primary:"",text:"Eliminar",onClick:d[0]||(d[0]=e=>async function(){await sn((async()=>{await Re(`${t.list.name}(${i.value})`),a.push({path:`/${t.list.name}/view/query/${l.query.viewName}`,query:{...l.query,selectedItemId:void 0,viewName:void 0}})}))}())}),(0,n.createVNode)(u,{text:"Cancel·lar",onClick:o})])])),_:1})])),_:1})])),_:1},8,["subtitle"])}}};function Nl(e){return[{path:`/${e.name}`,component:e.routes?.overrideControls?.ListDetailsDefault??gn,props:{list:e}},{path:`/${e.name}/view/query/:viewName`,component:e.routes?.overrideControls?.ListDetails??bn,props:{list:e},children:[{path:"filter",component:e.routes?.overrideControls?.ListDetailsFilterPanel??Kn,props:{list:e}},{path:"export",component:e.routes?.overrideControls?.ListDetailsExport??Zn,props:{list:e}},...e.routes?.detailsListChildRoutes??[]]},{path:`/${e.name}/view/grid/:viewName`,component:e.routes?.overrideControls?.ListDetailsGrid??Vn,props:{list:e}},{path:`/${e.name}/view/create`,component:e.routes?.overrideControls?.ListViewEdit??dl,props:{list:e}},{path:`/${e.name}/view/edit/:viewName`,component:e.routes?.overrideControls?.ListViewEdit??dl,props:{list:e}},{path:`/${e.name}/create`,component:e.routes?.overrideControls?.ListItemEdit??cl,props:{list:e},children:[{path:"tab/:tabName",component:e.routes?.overrideControls?.ListItemTab??gl,props:{list:e},children:[{path:"create",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e}},{path:"edit/:childId",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e}}]}]},{path:`/${e.name}/edit/:itemId`,component:e.routes?.overrideControls?.ListItemEdit??cl,props:{list:e},children:[{path:"tab/:tabName",component:e.routes?.overrideControls?.ListItemTab??gl,props:{list:e},children:[{path:"create",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e}},{path:"edit/:childId",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e}}]}]},{path:`/${e.name}/delete/:itemId`,component:e.routes?.overrideControls?.ListItemDelete??Cl,props:{list:e}},...e.routes?.cusomRoutes??[]]}const hl={__name:"list-item-create",props:{list:{type:Object,required:!0},splitted:{type:Boolean,default:!1}},setup(e){const t=e,a=(0,r.useRoute)(),l=(0,r.useRouter)(),i=Ve(),d=(0,o.useValidations)(),u=At(),{goBack:s}=Ja(),{sendMessage:c,close:m}=ha(),{tabName:p}=Ya("tabName"),{popup:f}=Za("popup");u.setContextName(t.list.name),u.load(t.list.name);const{entityLoaded:y,entity:v,resetEntity:A}=ul(t.list);on(),(0,n.onMounted)((()=>dn(v))),(0,n.onUnmounted)(rn);const I=t.list.fields.find((e=>e.primary)).name,g=(0,n.computed)((()=>v[I]));d.createField(I,g);const T=(0,n.computed)((()=>t.list.permissionDenied?.()??{})),b=(0,n.computed)((()=>t.list.form.tabs?.filter((e=>"child"!==e.type))?.map((e=>({text:e.title,value:e.name,icon:e.icon,count:e.count})))??[]));function O(e){e(v)}function C(e){l.push({path:`/${t.list.name}/create/tab/${e}`,query:{return:a.query.return,popup:f.value}})}async function N(){await d.validate(v)&&await sn((async()=>{await Je(v),s(`/${t.list.name}`,null,{reload:!0})}))}async function h(){await d.validate(v)&&await sn((async()=>{await Je(v),c({action:"save"}),m()}))}function _(){i.confirm({title:"Alerta!",message:"Esteu segurs de que voleu desfer els canvis realitzats?.",accept(){A(),(0,n.nextTick)((()=>dn(v)))}})}return(t,a)=>{const l=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"itemListEdit-container",subtitle:e.list.label},{default:(0,n.withCtx)((()=>[(0,n.unref)(y)?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(w),{key:0,tabs:b.value,"current-tab":(0,n.unref)(p),"max-width":e.list.form.maxWidth,"self-aling":e.list.form.selfAlign,"has-save":!T.value.create&&void 0===(0,n.unref)(f),"has-save-and-close":!T.value.create&&void 0!==(0,n.unref)(f),"has-reset":"","has-go-back":void 0===(0,n.unref)(f),"has-close":void 0!==(0,n.unref)(f),"onUpdate:currentTab":C,onSave:N,onSaveAndClose:h,onReset:_,onGoBack:a[0]||(a[0]=t=>(0,n.unref)(s)(`/${e.list.name}`)),onClose:(0,n.unref)(m)},{default:(0,n.withCtx)((()=>["auto"===e.list.form.component?((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(un),{key:0,list:e.list,form:e.list.form,entity:(0,n.unref)(v),validations:(0,n.unref)(d),onChange:O},null,8,["list","form","entity","validations"])):((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(e.list.form.component),{key:1,entity:(0,n.unref)(v),validations:(0,n.unref)(d),onChange:O},null,40,["entity","validations"]))])),child:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{entity:(0,n.unref)(v),validations:(0,n.unref)(d),onChange:O},null,8,["entity","validations"])])),_:1},8,["tabs","current-tab","max-width","self-aling","has-save","has-save-and-close","has-go-back","has-close","onClose"])):(0,n.createCommentVNode)("v-if",!0)])),_:1},8,["subtitle"])}}},_l=(0,F.Z)(hl,[["__scopeId","data-v-a1813330"]]);function El(e){return[{path:`/${e.name}`,component:e.routes?.overrideControls?.ListDetailsDefault??gn,props:{list:e}},{path:`/${e.name}/view/query/:viewName`,component:e.routes?.overrideControls?.ListDetails??bn,props:{list:e},children:[{path:"filter",component:e.routes?.overrideControls?.ListDetailsFilterPanel??Kn,props:{list:e}},{path:"export",component:e.routes?.overrideControls?.ListDetailsExport??Zn,props:{list:e}},...e.routes?.detailsListChildRoutes??[]]},{path:`/${e.name}/view/grid/:viewName`,component:e.routes?.overrideControls?.ListDetailsGrid??Vn,props:{list:e}},{path:`/${e.name}/view/create`,component:e.routes?.overrideControls?.ListViewEdit??dl,props:{list:e}},{path:`/${e.name}/view/edit/:viewName`,component:e.routes?.overrideControls?.ListViewEdit??dl,props:{list:e}},{path:`/${e.name}/create`,component:e.routes?.overrideControls?.ListItemCreate??_l,props:{list:e},children:[{path:"tab/:tabName",component:e.routes?.overrideControls?.ListItemTab??gl,props:{list:e},children:[{path:"create",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e,splitted:!0}},{path:"edit/:childId",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e,splitted:!0}}]}]},{path:`/${e.name}/edit/:itemId`,component:e.routes?.overrideControls?.ListItemEdit??cl,props:{list:e,splitted:!0},children:[{path:"tab/:tabName",component:e.routes?.overrideControls?.ListItemTab??gl,props:{list:e},children:[{path:"create",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e,splitted:!0}},{path:"edit/:childId",component:e.routes?.overrideControls?.ListItemTabChild??bl,props:{list:e,splitted:!0}}]}]},{path:`/${e.name}/delete/:itemId`,component:e.routes?.overrideControls?.ListItemDelete??Cl,props:{list:e}},...e.routes?.cusomRoutes??[]]}const Pl={dictionary:e,listJoined:t,listSplitted:a},Sl={class:"layout"},Dl={class:"form"},Fl={class:"logo"},Vl=["src"],Ml={class:"label"},xl={style:{"font-weight":"600"}},Rl=(e=>((0,n.pushScopeId)("data-v-6fd09a82"),e=e(),(0,n.popScopeId)(),e))((()=>(0,n.createElementVNode)("br",null,null,-1))),wl={class:"buttons"},Bl={class:"recovery"},Ll={__name:"user-login",setup(e){const t=(0,r.useRouter)(),a=O(),l=Ve(),i=(0,n.reactive)({username:"",password:""});async function o(e){l.loadStart("user-login");const n=await fetch(`${m}/authenticator/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(200===n.status){const e=await n.text();a.setJwt(e),t.push(g)}else if(401===n.status){const e=await n.text();l.alert({title:"Error:",message:e})}else l.alert({title:"Error:",message:"Error inesperat."});l.loadEnd("user-login")}return(0,n.onMounted)((()=>{a.jwt&&t.push(g)})),(e,a)=>{const l=(0,n.resolveComponent)("fura-text-field"),r=(0,n.resolveComponent)("fura-button"),s=(0,n.resolveComponent)("fura-link");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Sl,[(0,n.createElementVNode)("div",Dl,[(0,n.createElementVNode)("div",Fl,[(0,n.createElementVNode)("img",{src:`/${(0,n.unref)(d)}/images/logo.png`,width:"160"},null,8,Vl)]),(0,n.createElementVNode)("form",{onSubmit:(0,n.withModifiers)(o,["prevent"])},[(0,n.createElementVNode)("div",Ml,[(0,n.createElementVNode)("span",xl,(0,n.toDisplayString)((0,n.unref)(u)),1),Rl,(0,n.createTextVNode)(" Entrada al sistema ")]),(0,n.createVNode)(l,{label:"Nom d'usuari",icon:"Contact",modelValue:i.username,"onUpdate:modelValue":a[0]||(a[0]=e=>i.username=e)},null,8,["modelValue"]),(0,n.createVNode)(l,{label:"Clau d'acces",password:"",icon:"Permissions",modelValue:i.password,"onUpdate:modelValue":a[1]||(a[1]=e=>i.password=e)},null,8,["modelValue"]),(0,n.createElementVNode)("div",wl,[(0,n.createVNode)(r,{primary:"",text:"Entra","form-role":"submit"}),(0,n.createElementVNode)("div",Bl,[(0,n.createVNode)(s,{onClick:a[2]||(a[2]=e=>(0,n.unref)(t).push("/password-reset-request"))},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Recupera la clau d'acces ")])),_:1})])])],32)])])}}},kl=(0,F.Z)(Ll,[["__scopeId","data-v-6fd09a82"]]),$l=e=>((0,n.pushScopeId)("data-v-b0180da2"),e=e(),(0,n.popScopeId)(),e),Ul={class:"layout"},ql={class:"form"},Gl={class:"logo"},Kl=["src"],jl={class:"label"},zl={style:{"font-weight":"600"}},Hl=$l((()=>(0,n.createElementVNode)("br",null,null,-1))),Wl=$l((()=>(0,n.createElementVNode)("br",null,null,-1))),Yl={class:"buttons"},Zl={__name:"user-password-reset-request",setup(e){const t=(0,r.useRouter)(),a=Ve(),l=(0,n.ref)("");async function i(e){a.loadStart("password-reset"),200===(await fetch(`${m}/authenticator/requestResetPassword`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Username:l.value})})).status?a.alert({title:"Acceptat!",message:"Sol·licitud acceptada, en breu rebrà un correu electronic amb les instruccions.",close:()=>t.push(g)}):a.alert({title:"Error",message:"No s'ha trobat l'usuari."}),a.loadEnd("password-reset")}return(e,t)=>{const a=(0,n.resolveComponent)("fura-text-field"),o=(0,n.resolveComponent)("fura-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Ul,[(0,n.createElementVNode)("div",ql,[(0,n.createElementVNode)("div",Gl,[(0,n.createElementVNode)("img",{src:`/${(0,n.unref)(d)}/images/logo.png`,width:"160"},null,8,Kl)]),(0,n.createElementVNode)("form",{onSubmit:(0,n.withModifiers)(i,["prevent"])},[(0,n.createElementVNode)("div",jl,[(0,n.createElementVNode)("span",zl,(0,n.toDisplayString)((0,n.unref)(u)),1),Hl,(0,n.createTextVNode)(" Sol·licitar una nova clau d'accés "),Wl]),(0,n.createVNode)(a,{label:"Nom d'usuari o adreça de correu electronic",icon:"Contact",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e)},null,8,["modelValue"]),(0,n.createElementVNode)("div",Yl,[(0,n.createVNode)(o,{primary:"",text:"Sol·licitar canvi de clau d'acces","form-role":"submit"})])],32)])])}}},Xl=(0,F.Z)(Zl,[["__scopeId","data-v-b0180da2"]]),Jl=e=>((0,n.pushScopeId)("data-v-833874ce"),e=e(),(0,n.popScopeId)(),e),Ql={class:"layout"},ei={class:"form"},ti={class:"logo"},ai=["src"],ni={class:"label"},li={style:{"font-weight":"600"}},ii=Jl((()=>(0,n.createElementVNode)("br",null,null,-1))),oi=Jl((()=>(0,n.createElementVNode)("br",null,null,-1))),ri={class:"showChars"},di={class:"buttons"},ui={__name:"user-password-reset",setup(e){const t=(0,r.useRoute)(),a=(0,r.useRouter)(),l=Ve(),i=(0,n.ref)(""),o=(0,n.ref)(""),s=(0,n.ref)(!1);async function c(e){l.loadStart("password-reset");const n=await fetch(`${m}/authenticator/resetPassword`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:t.query.token},body:JSON.stringify({password:i.value})});if(200===n.status)l.alert({title:"Atenció!",message:"S'ha actualitzat la clau d'acces.",close:()=>a.push(g)});else if(401===n.status){const e=await n.text();l.alert({title:"Error",message:e})}else l.alert({title:"Error",message:"Error inesperat"});l.loadEnd("password-reset")}return(0,n.onMounted)((()=>{t.query.token||a.push(g)})),(e,t)=>{const a=(0,n.resolveComponent)("fura-text-field"),l=(0,n.resolveComponent)("fura-toggle"),r=(0,n.resolveComponent)("fura-button");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Ql,[(0,n.createElementVNode)("div",ei,[(0,n.createElementVNode)("div",ti,[(0,n.createElementVNode)("img",{src:`/${(0,n.unref)(d)}/images/logo.png`,width:"160"},null,8,ai)]),(0,n.createElementVNode)("form",{onSubmit:(0,n.withModifiers)(c,["prevent"])},[(0,n.createElementVNode)("div",ni,[(0,n.createElementVNode)("span",li,(0,n.toDisplayString)((0,n.unref)(u)),1),ii,(0,n.createTextVNode)(" Establir la clau d'accés "),oi]),(0,n.createVNode)(a,{label:"Clau d'acces",password:!s.value,icon:"Permissions",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e)},null,8,["password","modelValue"]),(0,n.createVNode)(a,{label:"Repetir clau d'acces",password:!s.value,icon:"RepeatAll",modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e)},null,8,["password","modelValue"]),(0,n.createElementVNode)("div",ri,[(0,n.createVNode)(l,{inline:"",label:"Mostrar caracters ",modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e)},null,8,["modelValue"])]),(0,n.createElementVNode)("div",di,[(0,n.createVNode)(r,{primary:"",text:"Canviar clau",disabled:!i.value||i.value!==o.value,"form-role":"submit"},null,8,["disabled"])])],32)])])}}},si=(0,F.Z)(ui,[["__scopeId","data-v-833874ce"]]),ci={class:"layout"},mi={class:"form"},pi={class:"logo"},fi=["src"],yi={class:"label"},vi=["textContent"],Ai=(e=>((0,n.pushScopeId)("data-v-b4240742"),e=e(),(0,n.popScopeId)(),e))((()=>(0,n.createElementVNode)("br",null,null,-1))),Ii={class:"showChars"},gi={class:"buttons"},Ti={__name:"user-password-change",setup(e){const t=(0,r.useRouter)(),a=O(),l=Ve(),i=(0,n.ref)(""),o=(0,n.ref)(""),s=(0,n.ref)(""),c=(0,n.ref)(!1);async function p(e){l.loadStart("password-reset");const n=await fetch(`${m}/authenticator/changePassword`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a.jwt},body:JSON.stringify({oldPassword:i.value,newPassword:o.value})});if(406===n.status)l.alert({title:"Error",message:"Antiga clau d'acces incorrecte."});else if(200===n.status)l.alert({title:"Atenció!",message:"S'ha actualitzat la clau d'acces.",close:()=>{a.setJwt(),t.push(g)}});else if(401===n.status){const e=await n.text();l.alert({title:"Error",message:e})}else l.alert({title:"Error",message:"Error inesperat"});l.loadEnd("password-reset")}return(e,t)=>{const a=(0,n.resolveComponent)("fura-text-field"),l=(0,n.resolveComponent)("fura-toggle"),r=(0,n.resolveComponent)("fura-button");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{class:"baseLayout",subtitle:"Canvi de clau d'acces"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",ci,[(0,n.createElementVNode)("div",mi,[(0,n.createElementVNode)("div",pi,[(0,n.createElementVNode)("img",{src:`/${(0,n.unref)(d)}/images/logo.png`,width:"160"},null,8,fi)]),(0,n.createElementVNode)("form",{onSubmit:(0,n.withModifiers)(p,["prevent"])},[(0,n.createElementVNode)("div",yi,[(0,n.createElementVNode)("span",{style:{"font-weight":"600"},textContent:(0,n.toDisplayString)((0,n.unref)(u))},null,8,vi),Ai,(0,n.createTextVNode)(" Canviar la paraula clau ")]),(0,n.createVNode)(a,{class:"oldPassword",label:"Antiga clau d'acces",password:!c.value,icon:"Permissions",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e)},null,8,["password","modelValue"]),(0,n.createVNode)(a,{label:"Nova clau d'acces",password:!c.value,icon:"PasswordField",modelValue:o.value,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e)},null,8,["password","modelValue"]),(0,n.createVNode)(a,{label:"Repetir nova clau d'acces",password:!c.value,icon:"RepeatAll",modelValue:s.value,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value=e)},null,8,["password","modelValue"]),(0,n.createElementVNode)("div",Ii,[(0,n.createVNode)(l,{inline:"",label:"Mostrar caracters ",modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=e=>c.value=e)},null,8,["modelValue"])]),(0,n.createElementVNode)("div",gi,[(0,n.createVNode)(r,{primary:"",text:"Canviar clau",disabled:!o.value||o.value!==s.value,"form-role":"submit"},null,8,["disabled"])])],32)])])])),_:1})}}},bi=(0,F.Z)(Ti,[["__scopeId","data-v-b4240742"]]),Oi={__name:"home-view",setup:e=>(e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{subtitle:"Inici"}))},Ci={class:"notFound-buttons"},Ni={__name:"not-found",setup:e=>(e,t)=>{const a=(0,n.resolveComponent)("fura-button"),l=(0,n.resolveComponent)("fura-dialog"),i=(0,n.resolveComponent)("fura-overlay");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{subtitle:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(i,{class:"notFound-overlay"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{class:"notFound-dialog",header:"Error!",text:"Aquesta pàgina no esta definida."},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Ci,[(0,n.createVNode)(a,{icon:"Home",text:"Ves al inci",onClick:t[0]||(t[0]=t=>e.$router.push((0,n.unref)(g)))}),(0,n.createVNode)(a,{icon:"Back",text:"Torna enrere.",onClick:t[1]||(t[1]=t=>e.$router.go(-1))})])])),_:1})])),_:1})])),_:1})}},hi=(0,F.Z)(Ni,[["__scopeId","data-v-5023a390"]]),_i={class:"facturar-layout"},Ei={__name:"facturar",setup(e){const t=(0,r.useRouter)(),a=(0,r.useRoute)(),l=O(),i=Ue(),o=(0,n.reactive)({formesPagament:[],ID_FORMAPAGAMENT1:null,ID_FORMAPAGAMENT2:null,NET:0,PAGAT1:0,PAGAT2:0,CATALA:!1});async function d(){const e=await xe("VISITA",{$select:"FACTURA,DATA_FACTURA",$filter:`FACTURA ne null and year(DATA_FACTURA) eq ${(new Date).getFullYear()}`,$top:1,$orderby:"FACTURA desc"}),n=0!==e.value.length?e.value[0].FACTURA+1:(new Date).getFullYear()%100*1e3+1;(await fetch(`${m}/VISITA(${a.query.id})`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:l.jwt},body:JSON.stringify({FACTURA:n,DATA_FACTURA:new Date,ID_FORMAPAGAMENT1:o.ID_FORMAPAGAMENT1,PAGAT1:o.PAGAT1,ID_FORMAPAGAMENT2:o.ID_FORMAPAGAMENT2,PAGAT2:o.PAGAT2,CATALA:o.CATALA})})).status<=400?(Ea(a.query.id),t.push({path:"/VISITA",query:{...a.query.return,reload:!0},reload:!0})):alert("Error de comuncació amb el servidor")}function u(){o.PAGAT2=o.NET-o.PAGAT1}function s(){t.push(a.query.return)}return(0,n.onMounted)((async()=>{i.loadDictionary("FORMAPAGAMENT");const e=await xe(`VISITA(${a.query.id})`,{$select:"PACIENT,NET,ID_FORMAPAGAMENT1,PAGAT1,ID_FORMAPAGAMENT2,PAGAT2,CATALA"});o.formesPagament=i.data.FORMAPAGAMENT.map((e=>({value:e.ID,text:e.NOM_FORMAPAGAMENT}))),o.ID_FORMAPAGAMENT1=e.ID_FORMAPAGAMENT1,o.ID_FORMAPAGAMENT2=e.ID_FORMAPAGAMENT2,o.NET=e.NET||0,o.PAGAT1=e.PAGAT1||0,o.PAGAT2=e.PAGAT2||0,o.CATALA=e.CATALA})),(e,t)=>{const a=(0,n.resolveComponent)("fura-label"),l=(0,n.resolveComponent)("fura-combo-box"),i=(0,n.resolveComponent)("fura-number-field"),r=(0,n.resolveComponent)("fura-checkbox"),c=(0,n.resolveComponent)("fura-button");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{subtitle:"Facturar visita"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",_i,[(0,n.createVNode)(a,{style:{"grid-area":"labelFormaPagament"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Forma de pagament ")])),_:1}),(0,n.createVNode)(a,{style:{"grid-area":"labelImport"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Import ")])),_:1}),(0,n.createVNode)(l,{style:{"grid-area":"ID_FORMAPAGAMENT1"},label:" ",options:o.formesPagament,modelValue:o.ID_FORMAPAGAMENT1,"onUpdate:modelValue":t[0]||(t[0]=e=>o.ID_FORMAPAGAMENT1=e)},null,8,["options","modelValue"]),(0,n.createVNode)(i,{style:{"grid-area":"PAGAT1"},label:" ",modelValue:o.PAGAT1,"onUpdate:modelValue":t[1]||(t[1]=e=>o.PAGAT1=e),align:"right",decimals:2,accept:".csv",onChange:u},null,8,["modelValue"]),(0,n.createVNode)(l,{style:{"grid-area":"ID_FORMAPAGAMENT2"},label:" ",disabled:o.NET===o.PAGAT1,options:o.formesPagament,modelValue:o.ID_FORMAPAGAMENT2,"onUpdate:modelValue":t[2]||(t[2]=e=>o.ID_FORMAPAGAMENT2=e)},null,8,["disabled","options","modelValue"]),(0,n.createVNode)(i,{style:{"grid-area":"PAGAT2"},disabled:"",label:" ",modelValue:o.PAGAT2,"onUpdate:modelValue":t[3]||(t[3]=e=>o.PAGAT2=e),align:"right",decimals:2},null,8,["modelValue"]),(0,n.createVNode)(a,{style:{"grid-area":"labelNeto","margin-top":"12px"}},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Net ")])),_:1}),(0,n.createVNode)(i,{style:{"grid-area":"NET"},disabled:"",label:" ",modelValue:o.NET,"onUpdate:modelValue":t[4]||(t[4]=e=>o.NET=e),align:"right",decimals:2},null,8,["modelValue"]),(0,n.createVNode)(r,{style:{"grid-area":"CATALA","margin-top":"24px"},label:"Factura en català",modelValue:o.CATALA,"onUpdate:modelValue":t[5]||(t[5]=e=>o.CATALA=e)},null,8,["modelValue"]),(0,n.createVNode)(c,{style:{"grid-area":"FACTURAR","margin-top":"24px"},text:"Fer factura",icon:"Invoice",disabled:!o.ID_FORMAPAGAMENT1||0!==o.PAGAT2&&!o.ID_FORMAPAGAMENT2||o.NET!==o.PAGAT1+o.PAGAT2,onClick:d},null,8,["disabled"]),(0,n.createVNode)(c,{style:{"grid-area":"CANCELAR","margin-top":"24px"},text:"Cancel·lar",icon:"ReturnToSession",onClick:s})])])),_:1})}}},Pi={class:"RESUM_MUTUA"},Si={__name:"resum-mutua",setup(e){const t=(0,r.useRouter)(),a=(0,r.useRoute)(),l=(0,n.ref)([]),i=new Date,o=(0,n.reactive)({mutues:[],factures:[],idMutua:null,inici:new Date(i.getFullYear(),i.getMonth()-1,1),final:new Date(i.getFullYear(),i.getMonth(),0)}),d=[{key:"FACTURA",align:"right",title:"Factura"},{key:"DATA",align:"center",title:"Data visita"},{key:"COGNOMSINOM",title:"Pacient"},{key:"AUTORITZACIO",title:"Autorización"},{key:"IMPORTt",title:"Base",align:"right"},{key:"IRPFt",title:"IRPF",align:"right"},{key:"NETt",title:"Neto",align:"right"}];function u(e,t,a,n,l){n&&(l&&e.setFont("helvetica",l),e.text(a,t,n))}function s(e,t,a,n,l,i){if(n){const o=n.toLocaleString("IT",{minimumFractionDigits:l||0,maximumFractionDigits:l||0});i&&e.setFont("helvetica",i);const r=a-parseInt(e.getStringUnitWidth(o)*e.internal.getFontSize()/e.internal.scaleFactor);u(e,t,r,o)}}function c(){t.push(a.query.return)}return(0,n.onMounted)((async()=>{const e=await xe("MUTUA",{$select:"ID,NOM",$orderby:"NOM"});e.value?o.mutues=e.value.map((e=>({value:e.ID,text:e.NOM}))):(o.mutues=[],alert("Error de comuncació amb el servidor"))})),(e,t)=>{const i=(0,n.resolveComponent)("fura-combo-box"),r=(0,n.resolveComponent)("fura-date-picker"),m=(0,n.resolveComponent)("fura-button"),p=(0,n.resolveComponent)("fura-details-list");return(0,n.openBlock)(),(0,n.createBlock)((0,n.unref)(V),{subtitle:"Resum mútua"},{default:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",Pi,[(0,n.createVNode)(i,{label:"Mútua",style:{"grid-area":"ID_MUTUA"},options:o.mutues,"clear-value-on-disabled":"",modelValue:o.idMutua,"onUpdate:modelValue":t[0]||(t[0]=e=>o.idMutua=e)},null,8,["options","modelValue"]),(0,n.createVNode)(r,{style:{"grid-area":"INICI"},label:"Des de",required:"",modelValue:o.inici,"onUpdate:modelValue":t[1]||(t[1]=e=>o.inici=e)},null,8,["modelValue"]),(0,n.createVNode)(r,{style:{"grid-area":"FINAL"},label:"fins",required:"",modelValue:o.final,"onUpdate:modelValue":t[2]||(t[2]=e=>o.final=e)},null,8,["modelValue"]),(0,n.createVNode)(m,{style:{"grid-area":"CERCA","margin-top":"28px"},class:"boto",icon:"Search",onClick:t[3]||(t[3]=e=>async function(){const e=await xe("VISITA",{$select:"DATA,DATA_FACTURA,FACTURA,CONCEPTE1,IMPORT,TIPUSIRPF,IRPF,NET,AUTORITZACIO,ENVIATPER",$expand:"PACIENT($select=COGNOMSINOM),MUTUA($select=ID,NOM,NOM2,ADRECA,CODIPOSTAL,POBLACIO,NIF)",$filter:`ID_MUTUA eq ${o.idMutua} and FACTURA ne null and DATA ge ${o.inici.toISOString()} and DATA le ${o.final.toISOString()}`,$orderby:"DATA,FACTURA"});e.value?(o.factures=e.value,o.factures.forEach((function(e){e.COGNOMSINOM=e.PACIENT?.COGNOMSINOM,e.DATA=wt.date.getTextValueFromEntity({name:"DATA"},e),e.DATA_FACTURA=wt.date.getTextValueFromEntity({name:"DATA_FACTURA"},e),e.FACTURA=wt.number.getTextValueFromEntity({name:"FACTURA",decimals:0,useGrouping:!0},e),e.IMPORTt=wt.number.getTextValueFromEntity({name:"IMPORT",decimals:2,minimumFractionDigits:2,useGrouping:!0},e),e.IRPFt=wt.number.getTextValueFromEntity({name:"IRPF",decimals:2,minimumFractionDigits:2,useGrouping:!0},e),e.NETt=wt.number.getTextValueFromEntity({name:"NET",decimals:2,minimumFractionDigits:2,useGrouping:!0},e)})),l.value=Array.from({length:o.factures.length},((e,t)=>t))):alert("Error de comuncació amb el servidor")}())}),(0,n.createVNode)(p,{style:{"grid-area":"FACTURES"},compact:"",selection:"multiple",columns:d,data:o.factures,"selected-indices":l.value,"onUpdate:selectedIndices":t[4]||(t[4]=e=>l.value=e),"auto-layout":"auto"},null,8,["data","selected-indices"]),(0,n.createVNode)(m,{style:{"grid-area":"IMPRIMIR"},disabled:0===l.value.length,class:"boto",icon:"Print","text-left":"Imprimir resum",onClick:t[5]||(t[5]=e=>async function(){const e=C(),t=new zt.jsPDF,n=l.value.map((e=>o.factures[e]));t.addImage(e.LOGO,"JPEG",20,24,40,12),t.setFontSize(10),u(t,44,96,n[0].MUTUA.NOM||"","bold"),n[0].MUTUA.NOM2?(u(t,48,96,n[0].MUTUA.NOM2,"normal"),u(t,52,96,n[0].MUTUA.ADRECA||"","normal"),u(t,56,96,(n[0].MUTUA.CODIPOSTAL||"")+" "+(n[0].MUTUA.POBLACIO||"")),u(t,60,96,"Nif:","normal"),u(t,60,104,n[0].MUTUA.NIF||"","bold"),u(t,60,20,"Fecha:","normal"),u(t,60,32,(new Date).toLocaleDateString("en-GB"),"bold")):(u(t,48,96,n[0].MUTUA.ADRECA||"","normal"),u(t,52,96,(n[0].MUTUA.CODIPOSTAL||"")+" "+(n[0].MUTUA.POBLACIO||"")),u(t,56,96,"Nif:","normal"),u(t,56,104,n[0].MUTUA.NIF||"","bold"),u(t,56,20,"Fecha:","normal"),u(t,56,32,(new Date).toLocaleDateString("en-GB"),"bold")),u(t,70,20,"Apreciados señores:","normal"),u(t,78,20,"En el período comprendido entre "+o.inici.toLocaleDateString("en-GB")+" y "+o.final.toLocaleDateString("en-GB")+" se practicaron visitas, pruebas funcionales"),u(t,82,20,"de voz y vídeo-laringo-estroboscopia a los siguientes pacientes:"),t.setFontSize(10),u(t,92,20,"Fecha","bold"),s(t,92,55,"Factura",0,"bold"),u(t,92,58,"Paciente (Enviado por )","bold"),s(t,92,189,"Importe",0,"normal"),t.line(20,93,190,93);let i=93,r=0,d=0,c=0,m=0;for(let e=0;e<n.length;e++)i+=5,r+=n[e].IMPORT||0,c+=n[e].IRPF||0,m+=n[e].NET||0,d=n[e].TIPUSIRPF,0!==e&&n[e].DATA===n[e-1].DATA||u(t,i,20,n[e].DATA,"bold"),s(t,i,55,n[e].FACTURA,0,"normal"),n[e].ENVIATPER?u(t,i,58,(n[e].COGNOMSINOM||"")+" ("+n[e].ENVIATPER+")"):u(t,i,58,n[e].COGNOMSINOM),s(t,i,189,n[e].IMPORT,2,"normal");t.setFontSize(10),t.line(20,255,190,255),u(t,260,20,e.NOM_CONSULTA,"bold"),u(t,265,20,e.ADRECA,"normal"),u(t,270,20,e.POBLACIO),u(t,275,20,"NIF: "+e.NIF),t.setFontSize(7),u(t,279,20,"Colegiado Nº: "+e.COLLEGIAT),t.setFontSize(10),u(t,260,150,"Base","normal"),s(t,260,190,r,2,"bold"),u(t,265,150,"IRPF "+d+" %","normal"),s(t,265,190,c,2,"bold"),u(t,270,150,"Neto","normal"),s(t,270,190,m,2,"bold"),t.save(`Resumen-${a.query.mutua}.pdf`)}())},null,8,["disabled"]),(0,n.createVNode)(m,{style:{"grid-area":"TORNAR"},class:"boto","text-left":"Tornar",icon:"ReturnToSession",onClick:c})])])),_:1})}}},Di=Si,Fi=[];for(const e of Ba()){const t=Pl[e.type];t&&t.getRoutes&&Fi.push(...t.getRoutes(e))}const Vi=(0,r.createRouter)({history:(0,r.createWebHistory)(d),routes:Fi.concat([{path:"/",component:kl,meta:{anonymousAccess:!0}},{path:"/password-reset-request",component:Xl,meta:{anonymousAccess:!0}},{path:"/password-reset",component:si,meta:{anonymousAccess:!0}},{path:"/password-change",component:bi},{path:"/home",component:Oi},{path:"/facturar",component:Ei},{path:"/resumMutua",component:Di},{path:"/configuracion",component:kt},{path:"/:catchAll(.*)",component:hi}])});Vi.beforeEach((e=>{const t=O();if(!e.meta.anonymousAccess&&!t.jwt)return{path:"/",query:{redirect:e.fullPath}}}));const Mi=Vi,xi={__name:"dialog-loading",setup(e){const t=Ve();return(e,a)=>{const l=(0,n.resolveComponent)("fura-spinner"),i=(0,n.resolveComponent)("fura-dialog"),o=(0,n.resolveComponent)("fura-overlay"),r=(0,n.resolveComponent)("fura-modal");return(0,n.openBlock)(),(0,n.createBlock)(r,{open:(0,n.unref)(t).loading.size>0},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(o,{class:"dialogLoading-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(i,{class:"dialogLoading-loading"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{label:"Carregant..."})])),_:1})])),_:1})])),_:1},8,["open"])}}},Ri=(0,F.Z)(xi,[["__scopeId","data-v-69be9a34"]]),wi={class:"dialogAlert-close"},Bi={__name:"dialog-alert",setup(e){const t=Ve(),a=(0,n.computed)((()=>t.alertList.length>0)),l=(0,n.computed)((()=>t.alertList[0]));return(e,i)=>{const o=(0,n.resolveComponent)("fura-button"),r=(0,n.resolveComponent)("fura-dialog"),d=(0,n.resolveComponent)("fura-overlay"),u=(0,n.resolveComponent)("fura-modal");return(0,n.openBlock)(),(0,n.createBlock)(u,{open:a.value},{default:(0,n.withCtx)((()=>[a.value?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,class:"dialogAlert-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{class:"dialogAlert-dialog",type:"close",header:l.value.title,text:l.value.message,onClick:i[1]||(i[1]=e=>(0,n.unref)(t).alertClose())},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",wi,[(0,n.createVNode)(o,{text:"Tancar",onClick:i[0]||(i[0]=e=>(0,n.unref)(t).alertClose())})])])),_:1},8,["header","text"])])),_:1})):(0,n.createCommentVNode)("v-if",!0)])),_:1},8,["open"])}}},Li=(0,F.Z)(Bi,[["__scopeId","data-v-69b9f90a"]]),ki={class:"dialogConfirm-close"},$i={__name:"dialog-confirm",setup(e){const t=Ve(),a=(0,n.computed)((()=>t.confirmList.length>0)),l=(0,n.computed)((()=>t.confirmList[0]));return(e,i)=>{const o=(0,n.resolveComponent)("fura-button"),r=(0,n.resolveComponent)("fura-dialog"),d=(0,n.resolveComponent)("fura-overlay"),u=(0,n.resolveComponent)("fura-modal");return(0,n.openBlock)(),(0,n.createBlock)(u,{open:a.value},{default:(0,n.withCtx)((()=>[a.value?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,class:"dialogConfirm-overlay",fixed:"",dark:""},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(r,{class:"dialogConfirm-dialog",header:l.value.title,text:l.value.message},{footer:(0,n.withCtx)((()=>[(0,n.createElementVNode)("div",ki,[(0,n.createVNode)(o,{primary:"",text:l.value.confirmButton||"Si",onClick:i[0]||(i[0]=e=>(0,n.unref)(t).confirmAccept())},null,8,["text"]),(0,n.createVNode)(o,{text:l.value.cancelButton||"No",onClick:i[1]||(i[1]=e=>(0,n.unref)(t).confirmCancel())},null,8,["text"])])])),_:1},8,["header","text"])])),_:1})):(0,n.createCommentVNode)("v-if",!0)])),_:1},8,["open"])}}},Ui=(0,F.Z)($i,[["__scopeId","data-v-0cb2bae0"]]),qi={__name:"app",setup:e=>((0,n.onMounted)((async function(){const e=C(),t=await xe("CONFIG(1)");e.saveConfig(t)})),(e,t)=>{const a=(0,n.resolveComponent)("router-view");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createVNode)(a),(0,n.createVNode)((0,n.unref)(Ri)),(0,n.createVNode)((0,n.unref)(Li)),(0,n.createVNode)((0,n.unref)(Ui))],64)})},Gi=(0,n.createApp)(qi);Gi.use((0,l.createPinia)()),Gi.use(i),Gi.use(o),Gi.use(Mi),Gi.mount("#app");const Ki=Gi})(),c.default})()));